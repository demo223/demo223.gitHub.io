<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>软件安装文档 | 周岐的个人博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="logo.jpg">
    <meta name="description" content="个人技术博客">
    
    <link rel="preload" href="/assets/css/0.styles.8c53e149.css" as="style"><link rel="preload" href="/assets/js/app.a19eb3cb.js" as="script"><link rel="preload" href="/assets/js/2.34fff606.js" as="script"><link rel="preload" href="/assets/js/1.16393a26.js" as="script"><link rel="preload" href="/assets/js/32.ed5593a9.js" as="script"><link rel="prefetch" href="/assets/js/10.717bd423.js"><link rel="prefetch" href="/assets/js/100.c5cd47b0.js"><link rel="prefetch" href="/assets/js/101.7151b423.js"><link rel="prefetch" href="/assets/js/102.6b36385a.js"><link rel="prefetch" href="/assets/js/103.d3861779.js"><link rel="prefetch" href="/assets/js/104.9578b311.js"><link rel="prefetch" href="/assets/js/105.aae477dc.js"><link rel="prefetch" href="/assets/js/106.1d5215a7.js"><link rel="prefetch" href="/assets/js/107.3c330c2f.js"><link rel="prefetch" href="/assets/js/108.cefc2802.js"><link rel="prefetch" href="/assets/js/109.541aa22e.js"><link rel="prefetch" href="/assets/js/11.e0bfb9a4.js"><link rel="prefetch" href="/assets/js/110.60e0b929.js"><link rel="prefetch" href="/assets/js/111.45058523.js"><link rel="prefetch" href="/assets/js/112.d10d50d0.js"><link rel="prefetch" href="/assets/js/113.4a3deb35.js"><link rel="prefetch" href="/assets/js/114.b917d1a1.js"><link rel="prefetch" href="/assets/js/115.50e3fa0f.js"><link rel="prefetch" href="/assets/js/116.78f04bf7.js"><link rel="prefetch" href="/assets/js/117.b5372645.js"><link rel="prefetch" href="/assets/js/118.f990eb5b.js"><link rel="prefetch" href="/assets/js/119.f178eabd.js"><link rel="prefetch" href="/assets/js/12.bdf46c02.js"><link rel="prefetch" href="/assets/js/120.d98a3aa8.js"><link rel="prefetch" href="/assets/js/121.abcdf60f.js"><link rel="prefetch" href="/assets/js/122.ed3550a9.js"><link rel="prefetch" href="/assets/js/123.8ef421f8.js"><link rel="prefetch" href="/assets/js/124.1adba2c7.js"><link rel="prefetch" href="/assets/js/125.6706c196.js"><link rel="prefetch" href="/assets/js/126.1e50c7b4.js"><link rel="prefetch" href="/assets/js/127.be9df6e0.js"><link rel="prefetch" href="/assets/js/128.9e68fe60.js"><link rel="prefetch" href="/assets/js/129.f9313e6a.js"><link rel="prefetch" href="/assets/js/13.05b00624.js"><link rel="prefetch" href="/assets/js/130.87d4d918.js"><link rel="prefetch" href="/assets/js/131.b7ab0bc3.js"><link rel="prefetch" href="/assets/js/132.4bf1103a.js"><link rel="prefetch" href="/assets/js/133.2bda9aa2.js"><link rel="prefetch" href="/assets/js/134.e6631028.js"><link rel="prefetch" href="/assets/js/135.5b78aed3.js"><link rel="prefetch" href="/assets/js/136.377fd687.js"><link rel="prefetch" href="/assets/js/137.623e1a9d.js"><link rel="prefetch" href="/assets/js/138.c2e1c9a1.js"><link rel="prefetch" href="/assets/js/139.6263f657.js"><link rel="prefetch" href="/assets/js/14.092a5584.js"><link rel="prefetch" href="/assets/js/140.a54c064d.js"><link rel="prefetch" href="/assets/js/141.0de2ed45.js"><link rel="prefetch" href="/assets/js/142.61ea0663.js"><link rel="prefetch" href="/assets/js/143.24d35022.js"><link rel="prefetch" href="/assets/js/144.196d7653.js"><link rel="prefetch" href="/assets/js/145.223f0fcf.js"><link rel="prefetch" href="/assets/js/146.a09f8d1b.js"><link rel="prefetch" href="/assets/js/147.62d69c7c.js"><link rel="prefetch" href="/assets/js/148.d46a05d0.js"><link rel="prefetch" href="/assets/js/149.467faf3d.js"><link rel="prefetch" href="/assets/js/15.758ee11b.js"><link rel="prefetch" href="/assets/js/150.0443932e.js"><link rel="prefetch" href="/assets/js/151.0879c074.js"><link rel="prefetch" href="/assets/js/152.4d08f8a9.js"><link rel="prefetch" href="/assets/js/153.ce46c4fa.js"><link rel="prefetch" href="/assets/js/154.fd65dd72.js"><link rel="prefetch" href="/assets/js/155.b975728f.js"><link rel="prefetch" href="/assets/js/156.61194924.js"><link rel="prefetch" href="/assets/js/157.97e4f54e.js"><link rel="prefetch" href="/assets/js/158.5290a2f0.js"><link rel="prefetch" href="/assets/js/159.3613e64b.js"><link rel="prefetch" href="/assets/js/16.2569be64.js"><link rel="prefetch" href="/assets/js/160.87d90e6b.js"><link rel="prefetch" href="/assets/js/161.a2a67f25.js"><link rel="prefetch" href="/assets/js/162.b51ccce1.js"><link rel="prefetch" href="/assets/js/163.85d33d23.js"><link rel="prefetch" href="/assets/js/164.5504b77f.js"><link rel="prefetch" href="/assets/js/165.be283131.js"><link rel="prefetch" href="/assets/js/166.8d0352c5.js"><link rel="prefetch" href="/assets/js/167.89c23a71.js"><link rel="prefetch" href="/assets/js/168.aa736b2c.js"><link rel="prefetch" href="/assets/js/169.296ccc1d.js"><link rel="prefetch" href="/assets/js/17.5b873df7.js"><link rel="prefetch" href="/assets/js/170.c706da49.js"><link rel="prefetch" href="/assets/js/171.6f79aeb1.js"><link rel="prefetch" href="/assets/js/172.ddcae302.js"><link rel="prefetch" href="/assets/js/173.f308eb43.js"><link rel="prefetch" href="/assets/js/174.b5ece966.js"><link rel="prefetch" href="/assets/js/175.538e3125.js"><link rel="prefetch" href="/assets/js/176.d54091dd.js"><link rel="prefetch" href="/assets/js/177.2ee0aa3d.js"><link rel="prefetch" href="/assets/js/178.667b3c59.js"><link rel="prefetch" href="/assets/js/179.07595c3e.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/180.300e0b70.js"><link rel="prefetch" href="/assets/js/181.89473dcd.js"><link rel="prefetch" href="/assets/js/182.ea6036d1.js"><link rel="prefetch" href="/assets/js/183.647f8d55.js"><link rel="prefetch" href="/assets/js/184.2e79dd55.js"><link rel="prefetch" href="/assets/js/185.bf4d6269.js"><link rel="prefetch" href="/assets/js/186.7a7ceaa7.js"><link rel="prefetch" href="/assets/js/187.09bb0f21.js"><link rel="prefetch" href="/assets/js/188.3604ce73.js"><link rel="prefetch" href="/assets/js/189.49b47b33.js"><link rel="prefetch" href="/assets/js/19.a45744ea.js"><link rel="prefetch" href="/assets/js/190.88e59ff4.js"><link rel="prefetch" href="/assets/js/191.a4b3e5c7.js"><link rel="prefetch" href="/assets/js/192.7527e6ed.js"><link rel="prefetch" href="/assets/js/193.c44a652d.js"><link rel="prefetch" href="/assets/js/194.6aaca2ce.js"><link rel="prefetch" href="/assets/js/195.64837df2.js"><link rel="prefetch" href="/assets/js/196.e1bd3d69.js"><link rel="prefetch" href="/assets/js/197.2b01de81.js"><link rel="prefetch" href="/assets/js/198.d1496fd2.js"><link rel="prefetch" href="/assets/js/199.27ab1442.js"><link rel="prefetch" href="/assets/js/20.4cb27e25.js"><link rel="prefetch" href="/assets/js/200.996d49f4.js"><link rel="prefetch" href="/assets/js/201.b71a4422.js"><link rel="prefetch" href="/assets/js/202.0ea49eaa.js"><link rel="prefetch" href="/assets/js/203.8ebb1f77.js"><link rel="prefetch" href="/assets/js/204.c8d10533.js"><link rel="prefetch" href="/assets/js/205.0b8c4d0d.js"><link rel="prefetch" href="/assets/js/206.cce9bcce.js"><link rel="prefetch" href="/assets/js/207.8130e9ba.js"><link rel="prefetch" href="/assets/js/208.871753be.js"><link rel="prefetch" href="/assets/js/209.757eda19.js"><link rel="prefetch" href="/assets/js/21.445690e6.js"><link rel="prefetch" href="/assets/js/210.983cae1d.js"><link rel="prefetch" href="/assets/js/211.8e4ddaf8.js"><link rel="prefetch" href="/assets/js/212.6412fc61.js"><link rel="prefetch" href="/assets/js/213.656a6a73.js"><link rel="prefetch" href="/assets/js/214.befcd199.js"><link rel="prefetch" href="/assets/js/215.2c292e81.js"><link rel="prefetch" href="/assets/js/216.78cc7e8b.js"><link rel="prefetch" href="/assets/js/217.4fa8b1da.js"><link rel="prefetch" href="/assets/js/218.4c8cce7c.js"><link rel="prefetch" href="/assets/js/219.d041d013.js"><link rel="prefetch" href="/assets/js/22.bc7c4cdb.js"><link rel="prefetch" href="/assets/js/220.10a9ed88.js"><link rel="prefetch" href="/assets/js/221.bc25f391.js"><link rel="prefetch" href="/assets/js/222.dfdd15b7.js"><link rel="prefetch" href="/assets/js/223.1afa90d8.js"><link rel="prefetch" href="/assets/js/224.69bb037f.js"><link rel="prefetch" href="/assets/js/225.94590311.js"><link rel="prefetch" href="/assets/js/226.d1818961.js"><link rel="prefetch" href="/assets/js/227.2a969459.js"><link rel="prefetch" href="/assets/js/228.e3f5706b.js"><link rel="prefetch" href="/assets/js/229.0e6df830.js"><link rel="prefetch" href="/assets/js/23.b7994ecf.js"><link rel="prefetch" href="/assets/js/230.6bc93aa6.js"><link rel="prefetch" href="/assets/js/231.9b7cc0ec.js"><link rel="prefetch" href="/assets/js/232.80b7488d.js"><link rel="prefetch" href="/assets/js/233.302790de.js"><link rel="prefetch" href="/assets/js/234.68b70723.js"><link rel="prefetch" href="/assets/js/235.1b3c3110.js"><link rel="prefetch" href="/assets/js/236.e536b7bb.js"><link rel="prefetch" href="/assets/js/237.cca351a3.js"><link rel="prefetch" href="/assets/js/238.f4d0edb0.js"><link rel="prefetch" href="/assets/js/239.4f57e73d.js"><link rel="prefetch" href="/assets/js/24.26e26a07.js"><link rel="prefetch" href="/assets/js/240.1e76f670.js"><link rel="prefetch" href="/assets/js/241.8795d427.js"><link rel="prefetch" href="/assets/js/242.c72205cb.js"><link rel="prefetch" href="/assets/js/243.d7105431.js"><link rel="prefetch" href="/assets/js/244.361b2ea5.js"><link rel="prefetch" href="/assets/js/245.055fa0a3.js"><link rel="prefetch" href="/assets/js/246.0dee7b05.js"><link rel="prefetch" href="/assets/js/247.c13fc7d7.js"><link rel="prefetch" href="/assets/js/248.4e481dba.js"><link rel="prefetch" href="/assets/js/25.626c2c33.js"><link rel="prefetch" href="/assets/js/26.c4aa6beb.js"><link rel="prefetch" href="/assets/js/27.b1a828b7.js"><link rel="prefetch" href="/assets/js/28.f9133ade.js"><link rel="prefetch" href="/assets/js/29.54e09df1.js"><link rel="prefetch" href="/assets/js/3.4db2e19a.js"><link rel="prefetch" href="/assets/js/30.d2654359.js"><link rel="prefetch" href="/assets/js/31.c57cf20e.js"><link rel="prefetch" href="/assets/js/33.05f050d1.js"><link rel="prefetch" href="/assets/js/34.6d7f5b2f.js"><link rel="prefetch" href="/assets/js/35.67cc577c.js"><link rel="prefetch" href="/assets/js/36.0bbc204a.js"><link rel="prefetch" href="/assets/js/37.8ac35368.js"><link rel="prefetch" href="/assets/js/38.50bd8dba.js"><link rel="prefetch" href="/assets/js/39.38b783ce.js"><link rel="prefetch" href="/assets/js/4.66c035fd.js"><link rel="prefetch" href="/assets/js/40.cd3ee2ff.js"><link rel="prefetch" href="/assets/js/41.f4bec9a4.js"><link rel="prefetch" href="/assets/js/42.27fa7fec.js"><link rel="prefetch" href="/assets/js/43.2af4a015.js"><link rel="prefetch" href="/assets/js/44.8e48aaf4.js"><link rel="prefetch" href="/assets/js/45.d41c0319.js"><link rel="prefetch" href="/assets/js/46.de5cb880.js"><link rel="prefetch" href="/assets/js/47.cc7c8048.js"><link rel="prefetch" href="/assets/js/48.22c69558.js"><link rel="prefetch" href="/assets/js/49.cdd62276.js"><link rel="prefetch" href="/assets/js/5.632744e8.js"><link rel="prefetch" href="/assets/js/50.a7eebe42.js"><link rel="prefetch" href="/assets/js/51.a447aa90.js"><link rel="prefetch" href="/assets/js/52.c0f076a5.js"><link rel="prefetch" href="/assets/js/53.3564c5b0.js"><link rel="prefetch" href="/assets/js/54.c5c6e6be.js"><link rel="prefetch" href="/assets/js/55.0fcb916b.js"><link rel="prefetch" href="/assets/js/56.2812bd7d.js"><link rel="prefetch" href="/assets/js/57.4f95d22a.js"><link rel="prefetch" href="/assets/js/58.d9baba05.js"><link rel="prefetch" href="/assets/js/59.371bd0d7.js"><link rel="prefetch" href="/assets/js/6.85f26be6.js"><link rel="prefetch" href="/assets/js/60.a715876a.js"><link rel="prefetch" href="/assets/js/61.6b1a782b.js"><link rel="prefetch" href="/assets/js/62.11484b5e.js"><link rel="prefetch" href="/assets/js/63.7b92573e.js"><link rel="prefetch" href="/assets/js/64.98aee69e.js"><link rel="prefetch" href="/assets/js/65.aa40eacd.js"><link rel="prefetch" href="/assets/js/66.67703170.js"><link rel="prefetch" href="/assets/js/67.392b86af.js"><link rel="prefetch" href="/assets/js/68.9610b8e9.js"><link rel="prefetch" href="/assets/js/69.6277fc7a.js"><link rel="prefetch" href="/assets/js/7.b775b056.js"><link rel="prefetch" href="/assets/js/70.b47adb04.js"><link rel="prefetch" href="/assets/js/71.0051199b.js"><link rel="prefetch" href="/assets/js/72.fa131834.js"><link rel="prefetch" href="/assets/js/73.fd8d275f.js"><link rel="prefetch" href="/assets/js/74.82095aed.js"><link rel="prefetch" href="/assets/js/75.41fad4ea.js"><link rel="prefetch" href="/assets/js/76.36bb1714.js"><link rel="prefetch" href="/assets/js/77.83c409c1.js"><link rel="prefetch" href="/assets/js/78.ca197ebf.js"><link rel="prefetch" href="/assets/js/79.9f0de524.js"><link rel="prefetch" href="/assets/js/80.7dd0f8a1.js"><link rel="prefetch" href="/assets/js/81.a5d44424.js"><link rel="prefetch" href="/assets/js/82.03d59f96.js"><link rel="prefetch" href="/assets/js/83.43da9399.js"><link rel="prefetch" href="/assets/js/84.e9ab171d.js"><link rel="prefetch" href="/assets/js/85.523fe07f.js"><link rel="prefetch" href="/assets/js/86.90aac9c6.js"><link rel="prefetch" href="/assets/js/87.1af6082d.js"><link rel="prefetch" href="/assets/js/88.3d7d10f0.js"><link rel="prefetch" href="/assets/js/89.69f4fbaf.js"><link rel="prefetch" href="/assets/js/90.30407e67.js"><link rel="prefetch" href="/assets/js/91.94355f67.js"><link rel="prefetch" href="/assets/js/92.8247a2fb.js"><link rel="prefetch" href="/assets/js/93.245ee436.js"><link rel="prefetch" href="/assets/js/94.a212b15e.js"><link rel="prefetch" href="/assets/js/95.dec85448.js"><link rel="prefetch" href="/assets/js/96.77ebb7ae.js"><link rel="prefetch" href="/assets/js/97.0a615ee3.js"><link rel="prefetch" href="/assets/js/98.9d539c75.js"><link rel="prefetch" href="/assets/js/99.270c2389.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.b7a3ab4f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8c53e149.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">周岐的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java SE/guide.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/项目总结/Mybatis使用/Mybatis分页实现.html" class="nav-link">
  项目总结
</a></div><div class="nav-item"><a href="/Java面试题/Java基础面试题/==和equals的区别.html" class="nav-link">
  Java面试题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/demo223" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/zhouqi-5zipq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java SE/guide.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/项目总结/Mybatis使用/Mybatis分页实现.html" class="nav-link">
  项目总结
</a></div><div class="nav-item"><a href="/Java面试题/Java基础面试题/==和equals的区别.html" class="nav-link">
  Java面试题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/demo223" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/zhouqi-5zipq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/java SE/guide" class="sidebar-heading clickable"><span>java SE</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>java web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docker/Docker安装.html" class="sidebar-link">Docker安装</a></li><li><a href="/Docker/Docker安装nginx容器.html" class="sidebar-link">Docker安装nginx容器</a></li><li><a href="/Docker/Docker创建容器.html" class="sidebar-link">Docker创建容器</a></li><li><a href="/Docker/Docker挂载nginx容器.html" class="sidebar-link">Docker挂载nginx容器</a></li><li><a href="/Docker/Dockerfile自定义镜像.html" class="sidebar-link">Dockerfile自定义镜像</a></li><li><a href="/Docker/基于Docker常用软件安装.html" class="active sidebar-link">基于Docker常用软件安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#虚拟机安装" class="sidebar-link">虚拟机安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#系统死锁问题" class="sidebar-link">系统死锁问题</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#jdk11安装" class="sidebar-link">JDK11安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#docker安装" class="sidebar-link">Docker安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#docker-compose安装" class="sidebar-link">Docker-Compose安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#mysql安装" class="sidebar-link">MySQL安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#nacos安装" class="sidebar-link">Nacos安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#openresty安装" class="sidebar-link">OpenResty安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#redis安装" class="sidebar-link">Redis安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#docker-compose安装kafka集群" class="sidebar-link">Docker-Compose安装Kafka集群</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#elasticsearch安装" class="sidebar-link">ElasticSearch安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#skywalking安装" class="sidebar-link">Skywalking安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#minio安装" class="sidebar-link">MinIO安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#fastdfs安装" class="sidebar-link">FastDFS安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#canal安装" class="sidebar-link">Canal安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#git安装" class="sidebar-link">Git安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#seata1-4-2安装" class="sidebar-link">Seata1.4.2安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#mongodb安装" class="sidebar-link">MongoDB安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#rabbitmq安装" class="sidebar-link">RabbitMQ安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#rocketmq安装" class="sidebar-link">RocketMQ安装</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#dockerfile-springboot" class="sidebar-link">Dockerfile-SpringBoot</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#镜像上传dockerhub" class="sidebar-link">镜像上传Dockerhub</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#jar包安装到本地仓库" class="sidebar-link">jar包安装到本地仓库</a></li><li class="sidebar-sub-header"><a href="/Docker/基于Docker常用软件安装.html#idea运行程序无法启动" class="sidebar-link">Idea运行程序无法启动</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mybatis-Plus</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用工具类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java面试题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/SpringBoot文档/01-Spring-IOC" class="sidebar-heading clickable"><span>SpringBoot文档</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/微服务文档/SpringCloud介绍" class="sidebar-heading clickable"><span>微服务文档</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="软件安装文档"><a href="#软件安装文档" class="header-anchor">#</a> 软件安装文档</h1> <h2 id="虚拟机安装"><a href="#虚拟机安装" class="header-anchor">#</a> 虚拟机安装</h2> <p>虚拟机账号root密码123456</p> <p>安装完成后，我们把IP设置为<code>192.168.211.130</code>，此时需要修改网卡配置：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#编辑文件</span>
<span class="token key attr-name">vi</span> <span class="token value attr-value">/etc/sysconfig/network-scripts/ifcfg-ens33</span>

<span class="token comment">#修改配置如下：</span>
<span class="token key attr-name">TYPE</span><span class="token punctuation">=</span><span class="token value attr-value">Ethernet</span>
<span class="token key attr-name">PROXY_METHOD</span><span class="token punctuation">=</span><span class="token value attr-value">none</span>
<span class="token key attr-name">BROWSER_ONLY</span><span class="token punctuation">=</span><span class="token value attr-value">no</span>
<span class="token key attr-name">BOOTPROTO</span><span class="token punctuation">=</span><span class="token value attr-value">static</span>
<span class="token key attr-name">DEFROUTE</span><span class="token punctuation">=</span><span class="token value attr-value">yes</span>
<span class="token key attr-name">IPV4_FAILURE_FATAL</span><span class="token punctuation">=</span><span class="token value attr-value">no</span>
<span class="token key attr-name">IPV6INIT</span><span class="token punctuation">=</span><span class="token value attr-value">yes</span>
<span class="token key attr-name">IPV6_AUTOCONF</span><span class="token punctuation">=</span><span class="token value attr-value">yes</span>
<span class="token key attr-name">IPV6_DEFROUTE</span><span class="token punctuation">=</span><span class="token value attr-value">yes</span>
<span class="token key attr-name">IPV6_FAILURE_FATAL</span><span class="token punctuation">=</span><span class="token value attr-value">no</span>
<span class="token key attr-name">IPV6_ADDR_GEN_MODE</span><span class="token punctuation">=</span><span class="token value attr-value">stable-privacy</span>
<span class="token key attr-name">NAME</span><span class="token punctuation">=</span><span class="token value attr-value">ens33</span>
<span class="token key attr-name">UUID</span><span class="token punctuation">=</span><span class="token value attr-value">17a66726-0303-4d70-bf76-545ff501191b</span>
<span class="token key attr-name">DEVICE</span><span class="token punctuation">=</span><span class="token value attr-value">ens33</span>
<span class="token key attr-name">ONBOOT</span><span class="token punctuation">=</span><span class="token value attr-value">yes</span>
<span class="token key attr-name">IPADDR</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.211.130</span>
<span class="token key attr-name">GATEWAY</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.211.2</span>
<span class="token key attr-name">DNS1</span><span class="token punctuation">=</span><span class="token value attr-value">114.114.114.114</span>

<span class="token comment">#重启服务或者重启网卡</span>
reboot
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>开发环境一般建议关闭防火墙：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#关闭防火墙</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">stop firewalld.service</span>

<span class="token comment">#禁止防火墙开机启动</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">disable firewalld.service</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="系统死锁问题"><a href="#系统死锁问题" class="header-anchor">#</a> 系统死锁问题</h2> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">kernel</span><span class="token punctuation">:</span><span class="token value attr-value">NMI watchdog: BUG: soft lockup - CPU#4 stuck for 35s! [kworker/4:2:530]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>出现如上问题，其实是一种死锁问题，大概是这个意思：这个bug没有让系统彻底死机，但是若干个进程(或者kernel thread)被锁死在了某个状态(一般在内核区域)，很多情况下这个是由于内核锁的使用的问题。</p> <p>这个会导致系统卡顿甚至连不上，这个问题解决也简单，执行如下命令即可解决：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">echo</span> <span class="token value attr-value">30 &gt; /proc/sys/kernel/watchdog_thresh</span>
<span class="token key attr-name">echo</span> <span class="token value attr-value">&quot;kernel.watchdog_thresh=30&quot; &gt;&gt; /etc/sysctl.conf</span>
<span class="token key attr-name">sysctl</span> <span class="token value attr-value">-w kernel.watchdog_thresh=30</span>
<span class="token key attr-name">sysctl</span> <span class="token value attr-value">-q vm.swappiness</span>
<span class="token key attr-name">sysctl</span> <span class="token value attr-value">-p</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="jdk11安装"><a href="#jdk11安装" class="header-anchor">#</a> JDK11安装</h2> <p>下载地址：https://www.oracle.com/java/technologies/downloads/#java11</p> <p>安装包：<code>jdk-11.0.15.1_linux-x64_bin.tar.gz</code>上传至虚拟机<code>/usr/local/server</code>目录下，并解压，改名为jdk即可。</p> <p>修改配置文件/etc/profile添加环境变量配置：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#修改</span>
<span class="token key attr-name">vi</span> <span class="token value attr-value">/etc/profile</span>

<span class="token comment">#添加配置</span>
<span class="token key attr-name">JAVA_HOME</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/server/jdk</span>
<span class="token key attr-name">CLASSPATH</span><span class="token punctuation">=</span><span class="token value attr-value">.:$JAVA_HOME/lib</span>
<span class="token key attr-name">PATH</span><span class="token punctuation">=</span><span class="token value attr-value">$JAVA_HOME/bin:$PATH</span>
<span class="token key attr-name">export</span> <span class="token value attr-value">JAVA_HOME CLASSPATH PATH</span>

<span class="token comment">#保存退出并让文件立即生效</span>
<span class="token key attr-name">source</span> <span class="token value attr-value">/etc/profile</span>

<span class="token comment">#查看JDK版本</span>
<span class="token key attr-name">[root@localhost</span> <span class="token value attr-value">server]# java --version</span>
<span class="token key attr-name">java</span> <span class="token value attr-value">11.0.15.1 2022-04-22 LTS</span>
<span class="token key attr-name">Java(TM)</span> <span class="token value attr-value">SE Runtime Environment 18.9 (build 11.0.15.1+2-LTS-10)</span>
<span class="token key attr-name">Java</span> <span class="token value attr-value">HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.15.1+2-LTS-10, mixed mode)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="docker安装"><a href="#docker安装" class="header-anchor">#</a> Docker安装</h2> <p>Docker安装:</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#更新至最新的库</span>
<span class="token key attr-name">yum</span> <span class="token value attr-value">update</span>

<span class="token comment">#安装Docker</span>
<span class="token key attr-name">yum</span> <span class="token value attr-value">install docker</span>

<span class="token comment">#启动Docker</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">start docker</span>

<span class="token comment">#开机启动Docker</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">enable docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Docker默认镜像源下载太慢，可以调整为国内镜像源，</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#编辑配置文件</span>
<span class="token key attr-name">vi</span> <span class="token value attr-value">/etc/docker/daemon.json</span>

<span class="token comment">#添加镜像地址信息</span>
{
<span class="token key attr-name">    &quot;registry-mirrors&quot;</span><span class="token punctuation">:</span> <span class="token value attr-value">[</span>
<span class="token key attr-name">        &quot;http</span><span class="token punctuation">:</span><span class="token value attr-value">//hub-mirror.c.163.com&quot;,</span>
<span class="token key attr-name">        &quot;https</span><span class="token punctuation">:</span><span class="token value attr-value">//docker.mirrors.ustc.edu.cn&quot;,</span>
<span class="token key attr-name">        &quot;https</span><span class="token punctuation">:</span><span class="token value attr-value">//registry.docker-cn.com&quot;</span>
    ]
}

<span class="token comment">#重启Docker</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">restart docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>为了验证是否切换成功，可以使用<code>docker info</code>查看，会显示如下信息：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">Registry</span> <span class="token value attr-value">Mirrors:</span>
<span class="token key attr-name"> http</span><span class="token punctuation">:</span><span class="token value attr-value">//hub-mirror.c.163.com</span>
<span class="token key attr-name"> https</span><span class="token punctuation">:</span><span class="token value attr-value">//docker.mirrors.ustc.edu.cn</span>
<span class="token key attr-name"> https</span><span class="token punctuation">:</span><span class="token value attr-value">//registry.docker-cn.com</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="docker-compose安装"><a href="#docker-compose安装" class="header-anchor">#</a> Docker-Compose安装</h2> <p>安装Docker-Compose，这里下载的是最新版本v2.5.0，安装流程如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#下载安装文件，其中uname -s是获取系统内核，uname -m获取系统版本，所以最后其实是下载docker-compose-Linux-x86_64</span>
<span class="token key attr-name">sudo</span> <span class="token value attr-value">curl -L https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span>

<span class="token comment">#添加可执行权限</span>
<span class="token key attr-name">sudo</span> <span class="token value attr-value">chmod +x /usr/local/bin/docker-compose</span>

<span class="token comment">#检查版本，是否安装成功</span>
<span class="token key attr-name">docker-compose</span> <span class="token value attr-value">--version</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="mysql安装"><a href="#mysql安装" class="header-anchor">#</a> MySQL安装</h2> <p>这里提供MySQL8安装、MySQL7安装，同时讲解基于Docker安装和Docker-Compose安装。</p> <h3 id="mysql8安装"><a href="#mysql8安装" class="header-anchor">#</a> MySQL8安装</h3> <p>安装命令：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -d -i \
--name mysql \
-v /usr/local/server/mysql/datadir:/var/lib/mysql \
-v /usr/local/server/mysql/conf.d:/etc/mysql/conf.d \
-v /etc/localtime:/etc/localtime \
--privileged=true \
-p 3306:3306 \
-e MYSQL_ROOT_PASSWORD=123456 \
--restart=always \
mysql:8.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>修改密码:</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#进入容器</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">exec -it mysql /bin/bash</span>
<span class="token comment">#登录mysql</span>
<span class="token key attr-name">mysql</span> <span class="token value attr-value">-u root -p</span>
<span class="token comment">#修改登录权限</span>
<span class="token key attr-name">ALTER</span> <span class="token value attr-value">USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><ul><li><code>ALTER USER</code>: 这是用于修改用户属性的 MySQL 命令。</li> <li><code>'root'@'%'</code>: 这指定了要修改的用户，其中 'root' 是用户名，'%' 代表任意远程主机。</li> <li><code>IDENTIFIED WITH mysql_native_password</code>: 使用 mysql_native_password 身份验证插件进行用户身份验证。</li> <li><code>BY '123456'</code>: 设置新密码为 '123456'。</li></ul></blockquote> <p><code>select NOW()</code>时间如果小了8小时，执行如下操作同步时区即可：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">cp /usr/share/zoneinfo/Asia/Shanghai mysql:/usr/share/zoneinfo/Asia</span>

<span class="token key attr-name">docker</span> <span class="token value attr-value">exec -it mysql bash</span>

<span class="token key attr-name">cp</span> <span class="token value attr-value">/usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>

<span class="token key attr-name">docker</span> <span class="token value attr-value">restart mysql</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="docker-compose安装mysql8"><a href="#docker-compose安装mysql8" class="header-anchor">#</a> Docker-Compose安装MySQL8</h3> <p>创建mysql-compose.yml文件，配置如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">version</span><span class="token punctuation">:</span> <span class="token value attr-value">'3.0'</span>
<span class="token key attr-name">services</span><span class="token punctuation">:</span>
<span class="token key attr-name">  mysql</span><span class="token punctuation">:</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">mysql:8.0</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">mysql</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    environment</span><span class="token punctuation">:</span>
<span class="token comment">      # 当您的配置需要文字美元符号时，您可以使用$$（双美元符号）。</span>
<span class="token key attr-name">      MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token value attr-value">123456</span>
<span class="token key attr-name">    command</span><span class="token punctuation">:</span>
<span class="token key attr-name">      --default-authentication-plugin</span><span class="token punctuation">=</span><span class="token value attr-value">mysql_native_password</span>
<span class="token key attr-name">      --character-set-server</span><span class="token punctuation">=</span><span class="token value attr-value">utf8mb4</span>
<span class="token key attr-name">      --collation-server</span><span class="token punctuation">=</span><span class="token value attr-value">utf8mb4_general_ci</span>
<span class="token key attr-name">      --explicit_defaults_for_timestamp</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">      --lower_case_table_names</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">3306:3306</span>
<span class="token key attr-name">    volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/mysql:/var/lib/mysql</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>参数说明：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">default-authentication-plugin</span><span class="token punctuation">:</span>
<span class="token key attr-name">	mysql8</span> <span class="token value attr-value">版本默认的认证方式是 caching_sha2_password ，客户端不支持，之前是采用 mysql_native_password，可以在启动容器时添加参数</span>

<span class="token key attr-name">character-set-server</span><span class="token punctuation">:</span>
<span class="token key attr-name">	编码设置，mb4就是most</span> <span class="token value attr-value">bytes 4的意思，专门用来兼容四字节的unicode。utf8mb4是utf8的超集，除了将编码改为utf8mb4外不需要做其他转换。</span>

collation-server：
	服务器的字符集设置。

explicit_defaults_for_timestamp：
	默认情况下，timestamp类型字段所在数据行被更新时，该字段会自动更新为当前时间，而参数explicit_defaults_for_timestamp控制这一种行为。
<span class="token key attr-name">	explicit_defaults_for_timestamp</span><span class="token punctuation">=</span><span class="token value attr-value">false，数据行更新时，timestamp类型字段更新为当前时间。</span>
<span class="token key attr-name">	explicit_defaults_for_timestamp</span><span class="token punctuation">=</span><span class="token value attr-value">true，数据行更新时，timestamp类型字段不更新为当前时间。</span>

<span class="token key attr-name">lower_case_table_names</span><span class="token punctuation">:</span>
<span class="token key attr-name">	lower_case_table_names</span><span class="token punctuation">=</span><span class="token value attr-value">0 表名存储为给定的大小和比较是区分大小写的</span>
<span class="token key attr-name">	lower_case_table_names</span> <span class="token punctuation">=</span> <span class="token value attr-value">1 表名存储在磁盘是小写的，但是比较的时候是不区分大小写</span>
<span class="token key attr-name">	lower_case_table_names</span><span class="token punctuation">=</span><span class="token value attr-value">2 表名存储为给定的大小写但是比较的时候是小写的</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>安装命令：docker-compose -f mysql-compose.yml up -d</p> <h3 id="mysql5-7安装"><a href="#mysql5-7安装" class="header-anchor">#</a> MySQL5.7安装</h3> <p>如果要安装MySQL5.7，可按照如下安装流程执行：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -it --name mysql -d \
-p 3306:3306 --restart=always \
-e MYSQL_ROOT_PASSWORD=123456 \
mysql:5.7</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>MySQL修改权限：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token constant">GRANT</span> <span class="token constant">ALL</span> <span class="token constant">PRIVILEGES</span> <span class="token constant">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span>* <span class="token constant">TO</span> <span class="token char">'root'</span>@'localhost' <span class="token constant">IDENTIFIED</span> <span class="token constant">BY</span> <span class="token char">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="nacos安装"><a href="#nacos安装" class="header-anchor">#</a> Nacos安装</h2> <p>这里讲解Docker安装Nacos单节点，同时讲解基于Docker-Compose安装Nacos集群。</p> <h3 id="docker安装nacos单机"><a href="#docker安装nacos单机" class="header-anchor">#</a> Docker安装Nacos单机</h3> <p>安装Nacos，默认采用的是Derby数据库存储，如果想用MySQL存储，需要先获取SQL脚本，并创建数据库，我们可以下载安装包获取SQL脚本,将<code>conf/nacos_config.sql</code>导入数据库即可。</p> <p><img src="C:%5CUsers%5CASUS%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230203200105255.png" alt="image-20230203200105255"></p> <p>下载地址：https://github.com/alibaba/nacos/releases</p> <p>安装脚本：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -d \
-e MODE=standalone \
-e SPRING_DATASOURCE_PLATFORM=mysql \
-e MYSQL_SERVICE_HOST=192.168.33.31 \
-e MYSQL_SERVICE_PORT=3306 \
-e MYSQL_SERVICE_USER=root \
-e MYSQL_SERVICE_PASSWORD=123456 \
-e MYSQL_SERVICE_DB_NAME=nacos_config \
-p 8848:8848 \
--restart=always \
--name nacos nacos/nacos-server:v2.1.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>参数说明：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">SPRING_DATASOURCE_PLATFORM</span><span class="token punctuation">=</span><span class="token value attr-value">mysql   使用MySQL存储数据</span>
<span class="token key attr-name">MYSQL_SERVICE_HOST</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.33.31   存储数据的MySQL的IP</span>
<span class="token key attr-name">MYSQL_SERVICE_PORT</span><span class="token punctuation">=</span><span class="token value attr-value">3306            MySQL的端口号</span>
<span class="token key attr-name">MYSQL_SERVICE_USER</span><span class="token punctuation">=</span><span class="token value attr-value">root            MySQL的账号</span>
<span class="token key attr-name">MYSQL_SERVICE_PASSWORD</span><span class="token punctuation">=</span><span class="token value attr-value">123456      MySQL的密码</span>
<span class="token key attr-name">MYSQL_SERVICE_DB_NAME</span><span class="token punctuation">=</span><span class="token value attr-value">nacos_config 存储数据的数据库名字</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="docker-compose安装nacos集群"><a href="#docker-compose安装nacos集群" class="header-anchor">#</a> Docker-Compose安装Nacos集群</h3> <p>这里实现集群的节点如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">节点1</span> <span class="token value attr-value">        192.168.33.31          8818</span>
<span class="token key attr-name">节点2</span> <span class="token value attr-value">        192.168.33.31          8828</span>
<span class="token key attr-name">节点3</span> <span class="token value attr-value">        192.168.33.31          8838</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>创建nacos-cluster.yml，配置如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">version</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;3&quot;</span>
<span class="token key attr-name">services</span><span class="token punctuation">:</span>
<span class="token key attr-name">  nacos1</span><span class="token punctuation">:</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos/nacos-server:v2.1.0</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos1</span>
<span class="token key attr-name">    environment</span><span class="token punctuation">:</span>
<span class="token key attr-name">      PREFER_HOST_MODE</span><span class="token punctuation">:</span> <span class="token value attr-value">ip</span>
<span class="token key attr-name">      MODE</span><span class="token punctuation">:</span> <span class="token value attr-value">cluster</span>
<span class="token key attr-name">      NACOS_SERVER_IP</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.33.31</span>
<span class="token key attr-name">      NACOS_SERVERS</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;192.168.33.31:8818 192.168.33.31:8828 192.168.33.31:8838&quot;</span>
<span class="token key attr-name">      SPRING_DATASOURCE_PLATFORM</span><span class="token punctuation">:</span> <span class="token value attr-value">mysql</span>
<span class="token key attr-name">      MYSQL_SERVICE_HOST</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.33.31</span>
<span class="token key attr-name">      MYSQL_SERVICE_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">3306</span>
<span class="token key attr-name">      MYSQL_SERVICE_DB_NAME</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos_config</span>
<span class="token key attr-name">      MYSQL_SERVICE_USER</span><span class="token punctuation">:</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">      MYSQL_SERVICE_PASSWORD</span><span class="token punctuation">:</span> <span class="token value attr-value">123456</span>
<span class="token key attr-name">      JVM_XMS</span><span class="token punctuation">:</span> <span class="token value attr-value">256m</span>
<span class="token key attr-name">      JVM_XMX</span><span class="token punctuation">:</span> <span class="token value attr-value">512m</span>
<span class="token key attr-name">      JVM_XMN</span><span class="token punctuation">:</span> <span class="token value attr-value">256m</span>
<span class="token key attr-name">      SERVER_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">8818</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">&quot;8818:8818&quot;</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    build</span><span class="token punctuation">:</span>
<span class="token key attr-name">      context</span><span class="token punctuation">:</span> <span class="token value attr-value">.</span>
<span class="token key attr-name">      network</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
 
<span class="token key attr-name">  nacos2</span><span class="token punctuation">:</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos/nacos-server:v2.1.0</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos2</span>
<span class="token key attr-name">    environment</span><span class="token punctuation">:</span>
<span class="token key attr-name">      PREFER_HOST_MODE</span><span class="token punctuation">:</span> <span class="token value attr-value">ip</span>
<span class="token key attr-name">      MODE</span><span class="token punctuation">:</span> <span class="token value attr-value">cluster</span>
<span class="token key attr-name">      NACOS_SERVER_IP</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.33.31</span>
<span class="token key attr-name">      NACOS_SERVERS</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;192.168.33.31:8818 192.168.33.31:8828 192.168.33.31:8838&quot;</span>
<span class="token key attr-name">      SPRING_DATASOURCE_PLATFORM</span><span class="token punctuation">:</span> <span class="token value attr-value">mysql</span>
<span class="token key attr-name">      MYSQL_SERVICE_HOST</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.33.31</span>
<span class="token key attr-name">      MYSQL_SERVICE_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">3306</span>
<span class="token key attr-name">      MYSQL_SERVICE_DB_NAME</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos_config</span>
<span class="token key attr-name">      MYSQL_SERVICE_USER</span><span class="token punctuation">:</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">      MYSQL_SERVICE_PASSWORD</span><span class="token punctuation">:</span> <span class="token value attr-value">123456</span>
<span class="token key attr-name">      JVM_XMS</span><span class="token punctuation">:</span> <span class="token value attr-value">256m</span>
<span class="token key attr-name">      JVM_XMX</span><span class="token punctuation">:</span> <span class="token value attr-value">512m</span>
<span class="token key attr-name">      JVM_XMN</span><span class="token punctuation">:</span> <span class="token value attr-value">256m</span>
<span class="token key attr-name">      SERVER_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">8828</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">&quot;8828:8828&quot;</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    build</span><span class="token punctuation">:</span>
<span class="token key attr-name">      context</span><span class="token punctuation">:</span> <span class="token value attr-value">.</span>
<span class="token key attr-name">      network</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
 
 
<span class="token key attr-name">  nacos3</span><span class="token punctuation">:</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos/nacos-server:v2.1.0</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos3</span>
<span class="token key attr-name">    environment</span><span class="token punctuation">:</span>
<span class="token key attr-name">      PREFER_HOST_MODE</span><span class="token punctuation">:</span> <span class="token value attr-value">ip</span>
<span class="token key attr-name">      MODE</span><span class="token punctuation">:</span> <span class="token value attr-value">cluster</span>
<span class="token key attr-name">      NACOS_SERVER_IP</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.33.31</span>
<span class="token key attr-name">      NACOS_SERVERS</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;192.168.33.31:8818 192.168.33.31:8828 192.168.33.31:8838&quot;</span>
<span class="token key attr-name">      SPRING_DATASOURCE_PLATFORM</span><span class="token punctuation">:</span> <span class="token value attr-value">mysql</span>
<span class="token key attr-name">      MYSQL_SERVICE_HOST</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.33.31</span>
<span class="token key attr-name">      MYSQL_SERVICE_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">3306</span>
<span class="token key attr-name">      MYSQL_SERVICE_DB_NAME</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos_config</span>
<span class="token key attr-name">      MYSQL_SERVICE_USER</span><span class="token punctuation">:</span> <span class="token value attr-value">root</span>
<span class="token key attr-name">      MYSQL_SERVICE_PASSWORD</span><span class="token punctuation">:</span> <span class="token value attr-value">123456</span>
<span class="token key attr-name">      JVM_XMS</span><span class="token punctuation">:</span> <span class="token value attr-value">256m</span>
<span class="token key attr-name">      JVM_XMX</span><span class="token punctuation">:</span> <span class="token value attr-value">512m</span>
<span class="token key attr-name">      JVM_XMN</span><span class="token punctuation">:</span> <span class="token value attr-value">256m</span>
<span class="token key attr-name">      SERVER_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">8838</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">&quot;8838:8838&quot;</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    build</span><span class="token punctuation">:</span>
<span class="token key attr-name">      context</span><span class="token punctuation">:</span> <span class="token value attr-value">.</span>
<span class="token key attr-name">      network</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p>参数列表说明：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">PREFER_HOST_MODE</span><span class="token punctuation">:</span> <span class="token value attr-value">Nacos会以什么方式来寻找自己的集群节点，一共有两种方式:</span>
<span class="token key attr-name">	1)如果指定为</span> <span class="token value attr-value">ip，那么 NACOS_SERVERS 也必须指定的是一组 ip（所有Nacos的集群节点）</span>
<span class="token key attr-name">	2)如果指定为</span> <span class="token value attr-value">hostname，那么 NACOS_SERVERS 也必须指定的是一组 hostname（所有Nacos的集群节点），所以还需要配置docker-compose中service的 hostname 用来显示指定主机名</span>

<span class="token key attr-name">NACOS_SERVERS</span><span class="token punctuation">:</span> <span class="token value attr-value">服务集群的节点列表，以IP1:Port1,IP2:Port2的方式编写</span>

<span class="token key attr-name">NACOS_SERVER_IP</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.33.31   节点的IP，如果不指定，在多网卡环境下，会出现多IP问题</span>

<span class="token key attr-name">SERVER_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">8838  每个节点的容器中Nacos的IP，如果是非8848端口，一定要指定，否则集群会多出一个无效的8848节点</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>安装命令：docker-compose -f nacos-cluster.yml up -d</p> <p>访问任意一个节点，集群节点列表如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1670081125644-537350b3-2e58-4dd5-9a27-ba33b075cf53.png" alt="img"></p> <h2 id="openresty安装"><a href="#openresty安装" class="header-anchor">#</a> OpenResty安装</h2> <p>安装OpenResty需要先安装相关依赖库：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">yum</span> <span class="token value attr-value">install libtermcap-devel ncurses-devel libevent-devel readline-devel pcre-devel gcc openssl openssl-devel per perl wget</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装OpenResty</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#下载OpenResty</span>
<span class="token key attr-name">wget</span> <span class="token value attr-value">https://openresty.org/download/openresty-1.11.2.5.tar.gz</span>

<span class="token comment">#解压OpenResty</span>
<span class="token key attr-name">tar</span> <span class="token value attr-value">-xf openresty-1.11.2.5.tar.gz</span>

<span class="token comment">#配置 OpenResty</span>
<span class="token key attr-name">./configure</span> <span class="token value attr-value">--prefix=/usr/local/openresty --with-luajit --without-http_redis2_module --with-http_stub_status_module --with-http_v2_module --with-http_gzip_static_module --with-http_sub_module</span>

<span class="token comment">#编译安装</span>
<span class="token key attr-name">make</span> <span class="token value attr-value">&amp;&amp; make install</span>

<span class="token comment">#在profile中添加环境配置</span>
<span class="token key attr-name">vi</span> <span class="token value attr-value">/etc/profile</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Nginx服务自启</p> <p>创建<code>/etc/systemd/system/nginx.service</code>，添加如下配置：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>[Unit]
<span class="token key attr-name"> Description</span><span class="token punctuation">=</span><span class="token value attr-value">nginx service</span>
<span class="token key attr-name"> After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span>

 [Service]
<span class="token key attr-name"> Type</span><span class="token punctuation">=</span><span class="token value attr-value">forking</span>
<span class="token key attr-name"> ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/openresty/nginx/sbin/nginx</span>
<span class="token key attr-name"> ExecReload</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/openresty/nginx/sbin/nginx -s reload</span>
<span class="token key attr-name"> ExecStop</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/openresty/nginx/sbin/nginx -s quit</span>

<span class="token key attr-name"> PrivateTmp</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>

 [Install]
<span class="token key attr-name"> WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>保存退出后，然后执行服务配置加载，并设置开机启动，同时可以验证一下命令是否生效，操作如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#重新加载服务配置</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">daemon-reload</span>

<span class="token comment">#Nginx开机启动</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">enable nginx</span>

<span class="token comment">#nginx启动:</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">start nginx</span>

<span class="token comment">#nginx停止:</span>
<span class="token key attr-name">systemctl</span> <span class="token value attr-value">stop nginx</span>

<span class="token comment">#重启 验证是否开机自启</span>
reboot
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="redis安装"><a href="#redis安装" class="header-anchor">#</a> Redis安装</h2> <p>这里将实现Docker安装单机版的Redis以及Docker-Compose安装Redis集群。</p> <h3 id="docker安装单机redis"><a href="#docker安装单机redis" class="header-anchor">#</a> Docker安装单机Redis</h3> <p>安装Redis，这里固定版本为6.2.4，操作如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -itd --name redis -p 6379:6379 \
--privileged=true \
-v /usr/local/docker/redis/data:/data \
-v /usr/local/docker/redis/conf/redis.conf:/usr/local/etc/redis/redis.conf \
--restart=always \
redis:6.2.4 --requirepass 123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="docker-compose安装redis集群"><a href="#docker-compose安装redis集群" class="header-anchor">#</a> Docker-Compose安装Redis集群</h3> <p>这里准备6个节点，节点信息如下：</p> <table><thead><tr><th>节点</th> <th>IP</th> <th>Port</th> <th>类型</th></tr></thead> <tbody><tr><td>redis1</td> <td>192.168.33.31</td> <td>7001</td> <td>Master</td></tr> <tr><td>redis2</td> <td>192.168.33.31</td> <td>7002</td> <td>Master</td></tr> <tr><td>redis3</td> <td>192.168.33.31</td> <td>7003</td> <td>Master</td></tr> <tr><td>redis4</td> <td>192.168.33.31</td> <td>7004</td> <td>Slave</td></tr> <tr><td>redis5</td> <td>192.168.33.31</td> <td>7005</td> <td>Slave</td></tr> <tr><td>redis6</td> <td>192.168.33.31</td> <td>7006</td> <td>Slave</td></tr></tbody></table> <p>创建6个目录存储每个节点的配置：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#创建文件目录，分别存储每个节点的配置和数据</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis1/conf</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis1/data</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis2/conf</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis2/data</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis3/conf</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis3/data</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis4/conf</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis4/data</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis5/conf</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis5/data</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis6/conf</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p /usr/local/server/redis-cluster/redis6/data</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>为每个节点创建配置：/usr/local/server/redis-cluster/redis1/conf/redis.conf</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">port</span> <span class="token value attr-value">7001</span>
<span class="token key attr-name">bind</span> <span class="token value attr-value">0.0.0.0</span>
<span class="token key attr-name">databases</span> <span class="token value attr-value">1</span>
<span class="token comment">#开启集群</span>
<span class="token key attr-name">cluster-enabled</span> <span class="token value attr-value">yes</span>
<span class="token key attr-name">cluster-config-file</span> <span class="token value attr-value">nodes.conf</span>
<span class="token key attr-name">cluster-node-timeout</span> <span class="token value attr-value">15000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这里要把redis1~redis6的conf目录下都创建该配置，端口修改成7001/7002/7003/7004/7005/7006即可。</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1670082512855-eb414f16-42ee-42fd-9d95-34d339f6ed5b.png" alt="img"></p> <p>创建redis-cluster.yml:</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">version</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;3&quot;</span>
<span class="token key attr-name">services</span><span class="token punctuation">:</span>
<span class="token key attr-name">  redis1</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">redis1</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">redis:6.2.4</span>
<span class="token key attr-name">    network_mode</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis1/conf/redis.conf:/etc/redis/redis.conf</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis1/data:/data</span>
<span class="token key attr-name">    command</span><span class="token punctuation">:</span> <span class="token value attr-value">[ &quot;redis-server&quot;, /etc/redis/redis.conf ]</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">  redis2</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">redis2</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">redis:6.2.4</span>
<span class="token key attr-name">    network_mode</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis2/conf/redis.conf:/etc/redis/redis.conf</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis2/data:/data</span>
<span class="token key attr-name">    command</span><span class="token punctuation">:</span> <span class="token value attr-value">[ &quot;redis-server&quot;, /etc/redis/redis.conf ]</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">  redis3</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">redis3</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">redis:6.2.4</span>
<span class="token key attr-name">    network_mode</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis3/conf/redis.conf:/etc/redis/redis.conf</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis3/data:/data</span>
<span class="token key attr-name">    command</span><span class="token punctuation">:</span> <span class="token value attr-value">[ &quot;redis-server&quot;, /etc/redis/redis.conf ]</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">  redis4</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">redis4</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">redis:6.2.4</span>
<span class="token key attr-name">    network_mode</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis4/conf/redis.conf:/etc/redis/redis.conf</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis4/data:/data</span>
<span class="token key attr-name">    command</span><span class="token punctuation">:</span> <span class="token value attr-value">[ &quot;redis-server&quot;, /etc/redis/redis.conf ]</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">  redis5</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">redis5</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">redis:6.2.4</span>
<span class="token key attr-name">    network_mode</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis5/conf/redis.conf:/etc/redis/redis.conf</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis5/data:/data</span>
<span class="token key attr-name">    command</span><span class="token punctuation">:</span> <span class="token value attr-value">[ &quot;redis-server&quot;, /etc/redis/redis.conf ]</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">  redis6</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">redis6</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">redis:6.2.4</span>
<span class="token key attr-name">    network_mode</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis6/conf/redis.conf:/etc/redis/redis.conf</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/redis-cluster/redis6/data:/data</span>
<span class="token key attr-name">    command</span><span class="token punctuation">:</span> <span class="token value attr-value">[ &quot;redis-server&quot;, /etc/redis/redis.conf ]</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>安装命令：docker-compose -f redis-cluster.yml up -d，效果如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1670082854512-4955162b-f0fd-4532-8608-07cf11822562.png" alt="img"></p> <p>创建集群：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 进入容器内部</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">exec -it redis1 /bin/bash</span>

<span class="token comment">#执行Redis集群创建命令，注意要修改所有的192.168.33.31为自己设备的实际IP，如果使用云服务器，则使用公网IP</span>
<span class="token key attr-name">redis-cli</span> <span class="token value attr-value">--cluster create 192.168.33.31:7001 \
192.168.33.31:7002 192.168.33.31:7003 \
192.168.33.31:7004 192.168.33.31:7005 \
192.168.33.31:7006 --cluster-replicas 1</span>

<span class="token comment">#集群节点信息</span>
<span class="token key attr-name">redis-cli</span> <span class="token value attr-value">-p 7001 cluster nodes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>效果如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1670083060408-6d5a9f36-d699-484d-bbc3-9bf012951925.png" alt="img"></p> <h2 id="docker-compose安装kafka集群"><a href="#docker-compose安装kafka集群" class="header-anchor">#</a> Docker-Compose安装Kafka集群</h2> <p>Kafka集群需要使用Zookeeper实现分布式管理，我们先拉去Zookeeper镜像，再实现安装：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">pull zookeeper:3.7.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建脚本文件kafka.yml</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">version</span><span class="token punctuation">:</span> <span class="token value attr-value">'3.8'</span>
<span class="token key attr-name">services</span><span class="token punctuation">:</span>
<span class="token key attr-name">  zookeeper</span><span class="token punctuation">:</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">zookeeper:3.7.0</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    hostname</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168。211.130</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">zookeeper</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">2181:2181</span>
<span class="token key attr-name">    volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">/usr/local/server/zookeeper/data/:/data</span>
<span class="token key attr-name">    build</span><span class="token punctuation">:</span>
<span class="token key attr-name">      context</span><span class="token punctuation">:</span> <span class="token value attr-value">.</span>
<span class="token key attr-name">      network</span><span class="token punctuation">:</span> <span class="token value attr-value">host</span>

<span class="token key attr-name">  kafka1</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">kafka1</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">wurstmeister/kafka:2.12-2.5.0</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">9092:9092</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">19092:19092</span>
<span class="token key attr-name">    environment</span><span class="token punctuation">:</span>
<span class="token key attr-name">      KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token value attr-value">1</span>
<span class="token key attr-name">      HOST_IP</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130</span>
<span class="token key attr-name">      KAFKA_LISTENERS</span><span class="token punctuation">:</span> <span class="token value attr-value">PLAINTEXT://0.0.0.0:9092</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> <span class="token value attr-value">PLAINTEXT://192.168.211.130:9092    ## 宿主机IP</span>
<span class="token key attr-name">      KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130:2181</span>
<span class="token comment">      #docker部署必须设置外部可访问ip和端口，否则注册进zk的地址将不可达造成外部无法连接</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">9092</span>
<span class="token key attr-name">      KAFKA_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">9092</span>
<span class="token key attr-name">      KAFKA_delete_topic_enable</span><span class="token punctuation">:</span> <span class="token value attr-value">'true'</span>
<span class="token key attr-name">      KAFKA_JMX_OPTS</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.211.130 -Dcom.sun.management.jmxremote.rmi.port=19092&quot;</span>
<span class="token key attr-name">      JMX_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">19092</span>
<span class="token key attr-name">      volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">        /etc/localtime</span><span class="token punctuation">:</span><span class="token value attr-value">/etc/localtime</span>
<span class="token key attr-name">      depends_on</span><span class="token punctuation">:</span>
        zookeeper
<span class="token key attr-name">  kafka2</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">kafka2</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">wurstmeister/kafka:2.12-2.5.0</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">9093:9093</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">19093:19093</span>
<span class="token key attr-name">    environment</span><span class="token punctuation">:</span>
<span class="token key attr-name">      KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token value attr-value">2</span>
<span class="token key attr-name">      HOST_IP</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130</span>
<span class="token key attr-name">      KAFKA_LISTENERS</span><span class="token punctuation">:</span> <span class="token value attr-value">PLAINTEXT://0.0.0.0:9093</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> <span class="token value attr-value">PLAINTEXT://192.168.211.130:9093    ## 宿主机IP</span>
<span class="token key attr-name">      KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130:2181</span>
<span class="token comment">      #docker部署必须设置外部可访问ip和端口，否则注册进zk的地址将不可达造成外部无法连接</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">9093</span>
<span class="token key attr-name">      KAFKA_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">9093</span>
<span class="token key attr-name">      KAFKA_delete_topic_enable</span><span class="token punctuation">:</span> <span class="token value attr-value">'true'</span>
<span class="token key attr-name">      KAFKA_JMX_OPTS</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.211.130 -Dcom.sun.management.jmxremote.rmi.port=19093&quot;</span>
<span class="token key attr-name">      JMX_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">19093</span>
<span class="token key attr-name">      volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">        /etc/localtime</span><span class="token punctuation">:</span><span class="token value attr-value">/etc/localtime</span>
<span class="token key attr-name">      depends_on</span><span class="token punctuation">:</span>
        zookeeper
<span class="token key attr-name">  kafka3</span><span class="token punctuation">:</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">kafka3</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">wurstmeister/kafka:2.12-2.5.0</span>
<span class="token key attr-name">    privileged</span><span class="token punctuation">:</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">9094:9094</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">19094:19094</span>
<span class="token key attr-name">    environment</span><span class="token punctuation">:</span>
<span class="token key attr-name">      KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token value attr-value">3</span>
<span class="token key attr-name">      HOST_IP</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130</span>
<span class="token key attr-name">      KAFKA_LISTENERS</span><span class="token punctuation">:</span> <span class="token value attr-value">PLAINTEXT://0.0.0.0:9094</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> <span class="token value attr-value">PLAINTEXT://192.168.211.130:9094    ## 宿主机IP</span>
<span class="token key attr-name">      KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130:2181</span>
<span class="token comment">      #docker部署必须设置外部可访问ip和端口，否则注册进zk的地址将不可达造成外部无法连接</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> <span class="token value attr-value">192.168.211.130</span>
<span class="token key attr-name">      KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">9094</span>
<span class="token key attr-name">      KAFKA_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">9094</span>
<span class="token key attr-name">      KAFKA_delete_topic_enable</span><span class="token punctuation">:</span> <span class="token value attr-value">'true'</span>
<span class="token key attr-name">      KAFKA_JMX_OPTS</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.211.130 -Dcom.sun.management.jmxremote.rmi.port=19094&quot;</span>
<span class="token key attr-name">      JMX_PORT</span><span class="token punctuation">:</span> <span class="token value attr-value">19094</span>
<span class="token key attr-name">      volumes</span><span class="token punctuation">:</span>
<span class="token key attr-name">        /etc/localtime</span><span class="token punctuation">:</span><span class="token value attr-value">/etc/localtime</span>
<span class="token key attr-name">      depends_on</span><span class="token punctuation">:</span>
        zookeeper

<span class="token key attr-name">  eagle</span><span class="token punctuation">:</span>
<span class="token key attr-name">    image</span><span class="token punctuation">:</span> <span class="token value attr-value">gui66497/kafka_eagle</span>
<span class="token key attr-name">    container_name</span><span class="token punctuation">:</span> <span class="token value attr-value">eagle_monitor</span>
<span class="token key attr-name">    restart</span><span class="token punctuation">:</span> <span class="token value attr-value">always</span>
<span class="token key attr-name">    depends_on</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">kafka1</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">kafka2</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">kafka3</span>
<span class="token key attr-name">    ports</span><span class="token punctuation">:</span>
<span class="token key attr-name">      -</span> <span class="token value attr-value">&quot;8048:8048&quot;</span>
<span class="token key attr-name">    environment</span><span class="token punctuation">:</span>
<span class="token key attr-name">      ZKSERVER</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;192.168.211.130:2181&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><p>执行安装;</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#执行命令</span>
<span class="token key attr-name">docker-compose</span> <span class="token value attr-value">-f kafka.yml up -d</span>

<span class="token comment">#效果如下</span>
<span class="token key attr-name">[root@localhost</span> <span class="token value attr-value">kafka]# docker-compose -f kafka.yml up -d</span>
<span class="token key attr-name">[+]</span> <span class="token value attr-value">Running 5/5</span>
<span class="token key attr-name"> ⠿</span> <span class="token value attr-value">Container kafka2         Started    1.1s</span>
<span class="token key attr-name"> ⠿</span> <span class="token value attr-value">Container kafka3         Started    1.2s</span>
<span class="token key attr-name"> ⠿</span> <span class="token value attr-value">Container zookeeper      Started    1.0s</span>
<span class="token key attr-name"> ⠿</span> <span class="token value attr-value">Container kafka1         Started    1.1s</span>
<span class="token key attr-name"> ⠿</span> <span class="token value attr-value">Container eagle_monitor  Started    3.0s</span>
<span class="token key attr-name">[root@localhost</span> <span class="token value attr-value">kafka]#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>访问控制台<code>http://192.168.211.130:8048/ke/</code>，输入账号密码<code>admin / 123456</code>登录，效果如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399836741-ed750ba2-82e7-48a5-b5f4-db0e6f8cc03c.png" alt="img"></p> <h2 id="elasticsearch安装"><a href="#elasticsearch安装" class="header-anchor">#</a> ElasticSearch安装</h2> <p>采用Docker方式安装ElasticSearch：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -i --name elasticsearch -d \
--restart=always -p 9200:9200 -p 9300:9300 \
--privileged=true \
-v /usr/local/server/elasticsearch/plugins:/usr/share/elasticsearch/plugins \
-e &quot;discovery.type=single-node&quot; \
elasticsearch:7.12.1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>IK分词器安装，下载地址：https://github.com/medcl/elasticsearch-analysis-ik/releases?page=4 下载后，将压缩包拷贝到 <code>/usr/local/server/elasticsearch/plugins</code>目录下，在<code>资料\软件\elasticsearch-analysis-ik-7.12.1.zip</code>已经下载好了该文件，可以直接上传到服务器上，操作如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#解压需要用到unzip，如果没有安装它，可以先安装</span>
<span class="token key attr-name">yum</span> <span class="token value attr-value">install unzip</span>

<span class="token comment">#解压文件</span>
<span class="token key attr-name">unzip</span> <span class="token value attr-value">elasticsearch-analysis-ik-7.12.1.zip -d ./ik</span>

<span class="token comment">#重新启动elasticsearch，IK分词器就生效</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">restart elasticsearch</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>elasticsearch-hq</code>是一个非常方便的Elasticsearch可视化管理工具，我们可以安装一个：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -id -p 5000:5000 --restart=always elastichq/elasticsearch-hq</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装完成后，访问http://192.168.211.130:5000/即可。</p> <p>Kibana也是一款非常不错的Elasticsearch管理工具，我们也可以安装它：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -d \
--name kibana \
--restart=always \
-e ELASTICSEARCH_HOSTS=http://192.168.33.31:9200 \
-p 5601:5601  \
kibana:7.12.1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>安装完成后，界面都是英文，我们可以把它换成中文：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#进入容器 </span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">exec -it kibana /bin/bash</span>

<span class="token comment">#编辑config/kibana.yml，修改中文，添加下面配置即可</span>
<span class="token key attr-name">i18n.locale</span><span class="token punctuation">:</span> <span class="token value attr-value">&quot;zh-CN&quot;</span>

<span class="token comment">#重启容器</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">restart kibana</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="skywalking安装"><a href="#skywalking安装" class="header-anchor">#</a> Skywalking安装</h2> <p>安装OAP</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run \
--name skywalking-oap \
--restart always \
-p 11800:11800 \
-p 12800:12800 -d \
--privileged=true \
-e TZ=Asia/Shanghai \
-e SW_STORAGE=elasticsearch7 \
-e SW_STORAGE_ES_CLUSTER_NODES=192.168.211.131:9200 \
-v /etc/localtime:/etc/localtime:ro \
apache/skywalking-oap-server:8.6.0-es7</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>安装Skywalking UI</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run \
--name skywalking-ui \
--restart always \
-p 8080:8080 -d \
--privileged=true \
--link skywalking-oap:skywalking-oap \
-e TZ=Asia/Shanghai \
-e SW_OAP_ADDRESS=192.168.211.131:12800 \
-v /etc/localtime:/etc/localtime:ro \
apache/skywalking-ui:8.6.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>访问SkywalkingUI http://192.168.211.131:8080</p> <p><strong>1)ES分片数量上限</strong></p> <p>如果此时访问http://192.168.211.136:8080/ 出现500错误，错误如下，此时其实是Elasticsearch出了问题：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">&quot;com.netflix.zuul.exception.ZuulException&quot;,&quot;message&quot;</span><span class="token punctuation">:</span><span class="token value attr-value">&quot;GENERAL&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们可以查看<code>skywalking</code>的日志<code>docker logs --since 30m skywalking</code>，会报如下错误：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">Failed</span><span class="token punctuation">:</span> <span class="token value attr-value">1: this action would add [2] total shards, but this cluster currently has [1000]/[1000] maximum shards open;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这种错误一般是生产环境中Elasticsearch分片数量达到了峰值，es集群的默认最大分片数是1000，我们需要调整Elasticsearch的默认分片数量，修改方式有多种，最常用的是直接修改<code>elasticsearch.yml</code>配置文件：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#进入elasticsearch容器</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">exec -it elasticsearch /bin/bash</span>

<span class="token comment">#编辑</span>
<span class="token key attr-name">vi</span> <span class="token value attr-value">/usr/share/elasticsearch/config/elasticsearch.yml</span>

<span class="token comment">#添加如下配置</span>
<span class="token key attr-name">cluster.max_shards_per_node</span><span class="token punctuation">:</span> <span class="token value attr-value">10000000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>保存配置后，记得删除<code>data/nodes</code>数据包，再重启elasticsearch，此时就可以正常访问了。</p> <p><strong>2)磁盘清理</strong></p> <p>如果此时能打开<code>skywalking-ui</code>界面，但是没有数据，则需要清理磁盘空间，可能是磁盘空间满了，如果是docker容器，可以使用<code>docker system prune</code>命令实现清理，<code>docker system prune</code>命令可以用于清理磁盘，删除关闭的容器、无用的数据卷和网络，以及dangling镜像（即无tag的镜像）。<code>docker system prune -a</code>命令清理得更加彻底，可以将没有容器使用Docker镜像都删掉。</p> <p>探针下载https://archive.apache.org/dist/skywalking/</p> <h2 id="minio安装"><a href="#minio安装" class="header-anchor">#</a> MinIO安装</h2> <p>MinIO基于Apache License v2.0开源协议的对象存储服务，可以做为云存储的解决方案用来保存海量的图片，视频，文档。由于采用Golang实现，服务端可以工作在Windows,Linux, OS X和FreeBSD上。配置简单，基本是复制可执行程序，单行命令可以运行起来。</p> <p>关于MinIOn使用参考文档 http://docs.minio.org.cn/docs/</p> <p>我们可以使用docker进行环境部署和启动</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -i -d \
  -p 9000:9000 \
  -p 9001:9001 \
  --restart=always \
  --name minio1 \
  --network=host \
  --privileged=true \
  -v /etc/localtime:/etc/localtime \
  -v ~/minio/data:/data \
  -e &quot;MINIO_ROOT_USER=minio&quot; \
  -e &quot;MINIO_ROOT_PASSWORD=minio123&quot; \
  quay.io/minio/minio server /data --console-address &quot;:9001&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>访问：http://192.168.211.130:9000/login  输入账号  minio / minio123即可登录。</p> <p>创建Buckets：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399871949-19ddf804-7f77-45d1-807a-9f9f3eb64a85.png" alt="img"></p> <p>Buckets权限管理</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399888510-3b855faa-9e89-41b5-8d83-e59fb1acbf4b.png" alt="img"></p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399932392-126d7c01-aa82-4859-bb09-ddcf60498602.png" alt="img"></p> <p>上传图片测试：</p> <p>如果所有文件都存储到shop下，不容易区分，我们可以根据不同文件，创建不同目录，例如<code>shop/items/</code>存储所有商品静态页，多级路径创建：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399946932-9f2a53ed-1891-424a-91cc-c66b3833a491.png" alt="img"></p> <p>选择<code>Upload</code>上传文件：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399958118-caa96a53-215e-4963-88d9-993e2c0a9ff1.png" alt="img"></p> <p>文件访问：http://192.168.211.130:9000/shop/items/002.jpg</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399969184-b805d8cd-95d1-43c5-98f1-9943dd56eb89.png" alt="img"></p> <p>效果如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399980440-11b0f034-d6fb-4b75-98fe-522b5c8791d3.png" alt="img"></p> <p>如果是java程序抛出异常，主要是时间不同步问题：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">The</span> difference between the request time and the server's time is too large<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>解决方案如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#安装ntp ntpdate</span>
<span class="token key attr-name">yum</span> <span class="token value attr-value">-y install ntp ntpdate</span>

<span class="token comment">#与时间服务器同步时间</span>
<span class="token key attr-name">ntpdate</span> <span class="token value attr-value">cn.pool.ntp.org</span>

<span class="token comment">#将系统时间写入硬件时间</span>
<span class="token key attr-name">hwclock</span> <span class="token value attr-value">--systohc</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="fastdfs安装"><a href="#fastdfs安装" class="header-anchor">#</a> FastDFS安装</h2> <p>安装FastDFS需要安装Tracker和Storage：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#Tracker安装</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">run -d --name tracker --restart=always \
--net=host morunchang/fastdfs \
sh tracker.sh</span>

<span class="token comment">#Storage安装</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">run -d --name storage \
--restart=always --net=host -e \
TRACKER_IP=192.168.211.130:22122 \
-e GROUP_NAME=group1 morunchang/fastdfs \
sh storage.sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="canal安装"><a href="#canal安装" class="header-anchor">#</a> Canal安装</h2> <p><code>canal 1.1.4</code>版本，迎来最重要的<code>WebUI</code>能力，引入<code>canal-admin</code>工程，支持面向<code>WebUI</code>的<code>canal</code>动态管理能力，支持配置、任务、日志等在线白屏运维能力。</p> <p>不过当前已经更新到了最新版本1.1.6,但1.1.6属于测试版，1.1.5属于稳定版，所以我们安装1.1.5。</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -p 11111:11111 --name=canal \
--restart=always -d \
canal/canal-server:v1.1.5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="git安装"><a href="#git安装" class="header-anchor">#</a> Git安装</h2> <p>安装命令：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 1. 卸载旧版本</span>
<span class="token key attr-name">yum</span> <span class="token value attr-value">remove git</span>

<span class="token comment"># 2. 安装 yum 源的 Git 版本</span>
<span class="token key attr-name">yum</span> <span class="token value attr-value">install -y git</span>

<span class="token comment"># 3. 查看版本</span>
<span class="token key attr-name">git</span> <span class="token value attr-value">version </span>
<span class="token comment"># 输出 git version 1.8.3.1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="seata1-4-2安装"><a href="#seata1-4-2安装" class="header-anchor">#</a> Seata1.4.2安装</h2> <h3 id="_1-单机"><a href="#_1-单机" class="header-anchor">#</a> 1）单机</h3> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run --name seata1 -d \
-p 8091:8091 -e SEATA_PORT=8091 \
--privileged=true -e SEATA_IP=192.168.211.131  \
-v /usr/local/server/seata1/conf:/root/seata-config \
-v /usr/local/server/seata1/logs:/root/logs/seata \
seataio/seata-server:1.4.2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改注册中心</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#1）进入容器</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">exec -it seata1 sh</span>


<span class="token comment">#2）进入resources</span>
<span class="token key attr-name">cd</span> <span class="token value attr-value">resources/</span>


<span class="token comment">#3）修改配置中心和注册中心</span>
<span class="token key attr-name">registry</span> <span class="token value attr-value">{</span>
<span class="token comment">  # file ...nacos ...eureka...redis...zk...consul...etcd3...sofa</span>
<span class="token key attr-name">  type</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;nacos&quot;</span>

<span class="token key attr-name">  nacos</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    application</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;seata-tc-server&quot;</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;192.168.211.131:8848&quot;</span>
<span class="token key attr-name">    group</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;SEATA_GROUP&quot;</span>
<span class="token key attr-name">    namespace</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;&quot;</span>
<span class="token key attr-name">    cluster</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;default&quot;</span>
<span class="token key attr-name">    username</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;nacos&quot;</span>
<span class="token key attr-name">    password</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;nacos&quot;</span>
  }
}

<span class="token key attr-name">config</span> <span class="token value attr-value">{</span>
<span class="token comment">  # file...nacos ...apollo...zk...consul...etcd3</span>
<span class="token key attr-name">  type</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;nacos&quot;</span>

<span class="token key attr-name">  nacos</span> <span class="token value attr-value">{</span>
<span class="token key attr-name">    serverAddr</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;192.168.211.131:8848&quot;</span>
<span class="token key attr-name">    namespace</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;&quot;</span>
<span class="token key attr-name">    group</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;SEATA_GROUP&quot;</span>
<span class="token key attr-name">    username</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;nacos&quot;</span>
<span class="token key attr-name">    password</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;nacos&quot;</span>
<span class="token key attr-name">    dataId</span> <span class="token punctuation">=</span> <span class="token value attr-value">&quot;seataServer.properties&quot;</span>
  }
}


<span class="token comment">#4）退出，修改</span>
exit


<span class="token comment">#5）修改Nacos，添加seataServer.properties，内容如下：</span>
<span class="token comment"># 数据存储方式，db代表数据库</span>
<span class="token key attr-name">store.mode</span><span class="token punctuation">=</span><span class="token value attr-value">db</span>
<span class="token key attr-name">store.db.datasource</span><span class="token punctuation">=</span><span class="token value attr-value">druid</span>
<span class="token key attr-name">store.db.dbType</span><span class="token punctuation">=</span><span class="token value attr-value">mysql</span>
<span class="token key attr-name">store.db.driverClassName</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">store.db.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.211.131:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true</span>
<span class="token key attr-name">store.db.user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">store.db.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>
<span class="token key attr-name">store.db.minConn</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
<span class="token key attr-name">store.db.maxConn</span><span class="token punctuation">=</span><span class="token value attr-value">30</span>
<span class="token key attr-name">store.db.globalTable</span><span class="token punctuation">=</span><span class="token value attr-value">global_table</span>
<span class="token key attr-name">store.db.branchTable</span><span class="token punctuation">=</span><span class="token value attr-value">branch_table</span>
<span class="token key attr-name">store.db.queryLimit</span><span class="token punctuation">=</span><span class="token value attr-value">100</span>
<span class="token key attr-name">store.db.lockTable</span><span class="token punctuation">=</span><span class="token value attr-value">lock_table</span>
<span class="token key attr-name">store.db.maxWait</span><span class="token punctuation">=</span><span class="token value attr-value">5000</span>
<span class="token comment"># 事务、日志等配置</span>
<span class="token key attr-name">server.recovery.committingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">server.recovery.asynCommittingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">server.recovery.rollbackingRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">server.recovery.timeoutRetryPeriod</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">server.maxCommitRetryTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span>
<span class="token key attr-name">server.maxRollbackRetryTimeout</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span>
<span class="token key attr-name">server.rollbackRetryTimeoutUnlockEnable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">server.undo.logSaveDays</span><span class="token punctuation">=</span><span class="token value attr-value">7</span>
<span class="token key attr-name">server.undo.logDeletePeriod</span><span class="token punctuation">=</span><span class="token value attr-value">86400000</span>

<span class="token comment"># 客户端与服务端传输方式</span>
<span class="token key attr-name">transport.serialization</span><span class="token punctuation">=</span><span class="token value attr-value">seata</span>
<span class="token key attr-name">transport.compressor</span><span class="token punctuation">=</span><span class="token value attr-value">none</span>
<span class="token comment"># 关闭metrics功能，提高性能</span>
<span class="token key attr-name">metrics.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">metrics.registryType</span><span class="token punctuation">=</span><span class="token value attr-value">compact</span>
<span class="token key attr-name">metrics.exporterList</span><span class="token punctuation">=</span><span class="token value attr-value">prometheus</span>
<span class="token key attr-name">metrics.exporterPrometheusPort</span><span class="token punctuation">=</span><span class="token value attr-value">9898</span>


<span class="token comment">#6）创建seata数据库，并将如下脚本导入到数据库中</span>
<span class="token key attr-name">SET</span> <span class="token value attr-value">NAMES utf8mb4;</span>
<span class="token key attr-name">SET</span> <span class="token value attr-value">FOREIGN_KEY_CHECKS = 0;</span>

<span class="token key attr-name">--</span> <span class="token value attr-value">----------------------------</span>
<span class="token key attr-name">--</span> <span class="token value attr-value">分支事务表</span>
<span class="token key attr-name">--</span> <span class="token value attr-value">----------------------------</span>
<span class="token key attr-name">DROP</span> <span class="token value attr-value">TABLE IF EXISTS `branch_table`;</span>
<span class="token key attr-name">CREATE</span> <span class="token value attr-value">TABLE `branch_table`  (</span>
<span class="token key attr-name">  `branch_id`</span> <span class="token value attr-value">bigint(20) NOT NULL,</span>
<span class="token key attr-name">  `xid`</span> <span class="token value attr-value">varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span>
<span class="token key attr-name">  `transaction_id`</span> <span class="token value attr-value">bigint(20) NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `resource_group_id`</span> <span class="token value attr-value">varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `resource_id`</span> <span class="token value attr-value">varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `branch_type`</span> <span class="token value attr-value">varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `status`</span> <span class="token value attr-value">tinyint(4) NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `client_id`</span> <span class="token value attr-value">varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `application_data`</span> <span class="token value attr-value">varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `gmt_create`</span> <span class="token value attr-value">datetime(6) NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `gmt_modified`</span> <span class="token value attr-value">datetime(6) NULL DEFAULT NULL,</span>
<span class="token key attr-name">  PRIMARY</span> <span class="token value attr-value">KEY (`branch_id`) USING BTREE,</span>
<span class="token key attr-name">  INDEX</span> <span class="token value attr-value">`idx_xid`(`xid`) USING BTREE</span>
<span class="token key attr-name">)</span> <span class="token value attr-value">ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span>

<span class="token key attr-name">--</span> <span class="token value attr-value">----------------------------</span>
<span class="token key attr-name">--</span> <span class="token value attr-value">全局事务表</span>
<span class="token key attr-name">--</span> <span class="token value attr-value">----------------------------</span>
<span class="token key attr-name">DROP</span> <span class="token value attr-value">TABLE IF EXISTS `global_table`;</span>
<span class="token key attr-name">CREATE</span> <span class="token value attr-value">TABLE `global_table`  (</span>
<span class="token key attr-name">  `xid`</span> <span class="token value attr-value">varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span>
<span class="token key attr-name">  `transaction_id`</span> <span class="token value attr-value">bigint(20) NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `status`</span> <span class="token value attr-value">tinyint(4) NOT NULL,</span>
<span class="token key attr-name">  `application_id`</span> <span class="token value attr-value">varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `transaction_service_group`</span> <span class="token value attr-value">varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `transaction_name`</span> <span class="token value attr-value">varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `timeout`</span> <span class="token value attr-value">int(11) NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `begin_time`</span> <span class="token value attr-value">bigint(20) NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `application_data`</span> <span class="token value attr-value">varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `gmt_create`</span> <span class="token value attr-value">datetime NULL DEFAULT NULL,</span>
<span class="token key attr-name">  `gmt_modified`</span> <span class="token value attr-value">datetime NULL DEFAULT NULL,</span>
<span class="token key attr-name">  PRIMARY</span> <span class="token value attr-value">KEY (`xid`) USING BTREE,</span>
<span class="token key attr-name">  INDEX</span> <span class="token value attr-value">`idx_gmt_modified_status`(`gmt_modified`, `status`) USING BTREE,</span>
<span class="token key attr-name">  INDEX</span> <span class="token value attr-value">`idx_transaction_id`(`transaction_id`) USING BTREE</span>
<span class="token key attr-name">)</span> <span class="token value attr-value">ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span>

<span class="token key attr-name">SET</span> <span class="token value attr-value">FOREIGN_KEY_CHECKS = 1;</span>


<span class="token comment">#7）重启容器</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">restart seata1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br></div></div><p>此时查看Nacos中的服务注册数据，能看到seata服务注册数据：</p> <table><thead><tr><th>服务名</th> <th>分组名称</th> <th>集群数目</th> <th>实例数</th> <th>健康实例数</th></tr></thead> <tbody><tr><td>seata-tc-server</td> <td>SEATA_GROUP</td> <td>1</td> <td>1</td> <td>1</td></tr></tbody></table> <h2 id="mongodb安装"><a href="#mongodb安装" class="header-anchor">#</a> MongoDB安装</h2> <h3 id="_1-单机安装-不支持事务"><a href="#_1-单机安装-不支持事务" class="header-anchor">#</a> 1）单机安装-不支持事务</h3> <p>安装脚本</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -di --name \
mongo-service --restart=always \
-p 27017:27017 -v ~/data/mongodata:/data mongo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-mongodb多副本集-支持事务"><a href="#_2-mongodb多副本集-支持事务" class="header-anchor">#</a> 2）MongoDB多副本集-支持事务</h3> <p>安装3台节点：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run --name mongo1 -p 27024:27024 -d mongo mongod --replSet &quot;rs0&quot; --port 27024</span>

<span class="token key attr-name">docker</span> <span class="token value attr-value">run --name mongo2 -p 27025:27025 -d mongo mongod --replSet &quot;rs0&quot; --port 27025</span>

<span class="token key attr-name">docker</span> <span class="token value attr-value">run --name mongo3 -p 27026:27026 -d mongo mongod --replSet &quot;rs0&quot; --port 27026</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>初始化关联：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#进入容器</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">exec -it mongo1 mongo --port 27024</span>

<span class="token comment">#初始化</span>
<span class="token key attr-name">rs.initiate({&quot;_id&quot;</span><span class="token punctuation">:</span><span class="token value attr-value">&quot;rs0&quot;,&quot;members&quot;:[{&quot;_id&quot;:0,&quot;host&quot;:&quot;192.168.211.131:27024&quot;},{&quot;_id&quot;:1,&quot;host&quot;:&quot;192.168.211.131:27025&quot;},{&quot;_id&quot;:2,&quot;host&quot;:&quot;192.168.211.131:27026&quot;}]})</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>项目中链接配置如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring</span><span class="token punctuation">:</span>
<span class="token key attr-name">  data</span><span class="token punctuation">:</span>
<span class="token key attr-name">    mongodb</span><span class="token punctuation">:</span>
<span class="token key attr-name">      uri</span><span class="token punctuation">:</span> <span class="token value attr-value">mongodb://192.168.211.131:27024,192.168.211.131:27025,192.168.211.131:27026/test?replicaSet=rs0&amp;readPreference=secondaryPreferred&amp;connectTimeoutMS=300000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意：如果有密码，则按如下方式配置：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">uri</span><span class="token punctuation">:</span> <span class="token value attr-value">mongodb://userName:password@IP1:Port1,IP2:Port2,IP3:Port3/base?replicaSet=rs1&amp;readPreference=secondaryPreferred&amp;connectTimeoutMS=300000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>MongoDB分布式事务：</p> <p>1）创建事务管理器<code>MongoTransactionManager</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">MongoTransactionManager</span> <span class="token function">transactionManager</span><span class="token punctuation">(</span><span class="token class-name">MongoDatabaseFactory</span> factory<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MongoTransactionManager</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2)案例演示</p> <p>这里支持多文档事务;</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Card</span> card <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    card<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    card<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token string">&quot;55555&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    card<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token string">&quot;No001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>card<span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;执行成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//int q=10/0;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-mongodb关联查询"><a href="#_3-mongodb关联查询" class="header-anchor">#</a> 3）MongoDB关联查询</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/link/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span><span class="token punctuation">&gt;</span></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//关联查询</span>
    <span class="token class-name">Aggregation</span> aggregation <span class="token operator">=</span> <span class="token class-name">Aggregation</span><span class="token punctuation">.</span><span class="token function">newAggregation</span><span class="token punctuation">(</span>
            <span class="token comment">// 匹配条件</span>
            <span class="token class-name">Aggregation</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// from：class作为主collection，from字段表示需要链接的collection，不明白为啥命名个from</span>
            <span class="token comment">// localField：主collection里的外键字段</span>
            <span class="token comment">// foreignField：连接collection里对应外键的字段</span>
            <span class="token comment">// as：最终连接的部分输出的字段名称</span>
            <span class="token class-name">Aggregation</span><span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">AggregationResults</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>aggregation<span class="token punctuation">,</span> <span class="token string">&quot;card&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Card</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">getMappedResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>等同于：<code>select * from card inner join user on card.userId=user._id where card._id=?</code></p> <h2 id="rabbitmq安装"><a href="#rabbitmq安装" class="header-anchor">#</a> RabbitMQ安装</h2> <p>安装命令如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -d --hostname host130 \
--name rabbitMq \
-e RABBITMQ_DEFAULT_USER=admin \
-e RABBITMQ_DEFAULT_PASS=123456 \
-p 15672:15672 \
-p 5672:5672 \
--restart=always \
rabbitmq:3.8.2-management</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数说明：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">-d</span> <span class="token value attr-value">以守护进程方式在后台运行</span>
<span class="token key attr-name">-p</span> <span class="token value attr-value">15672:15672 management 界面管理访问端口</span>
<span class="token key attr-name">-p</span> <span class="token value attr-value">5672:5672 amqp 访问端口</span>
--name：指定容器名
<span class="token key attr-name">--hostname：设定容器的主机名，它会被写到容器内的</span> <span class="token value attr-value">/etc/hostname 和 /etc/hosts，作为容器主机IP的别名，并且将显示在容器的bash中，所以记得将host130添加到/etc/hosts下面，如下：</span>
<span class="token comment">#127.0.0.1 host130</span>

<span class="token key attr-name">-e</span> <span class="token value attr-value">参数</span>
<span class="token key attr-name">  RABBITMQ_DEFAULT_USER</span> <span class="token value attr-value">用户名</span>
<span class="token key attr-name">  RABBITMQ_DEFAULT_PASS</span> <span class="token value attr-value">密码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>输入http://192.168.211.130:15672/ 访问，账号admin，密码123456，或者guest/guest</p> <h2 id="rocketmq安装"><a href="#rocketmq安装" class="header-anchor">#</a> RocketMQ安装</h2> <p>安装RocketMQ需要安装mqnamesrv和broker，安装流程如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#创建存储日志目录</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p  /usr/local/server/rocketmq/data/namesrv/logs   /usr/local/server/rocketmq/data/namesrv/store</span>

<span class="token comment">#安装mqnamesrv</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">run -d \
--restart=always \
--name rmqnamesrv \
-p 9876:9876 \
-v /usr/local/server/rocketmq/data/namesrv/logs:/root/logs \
-v /usr/local/server/rocketmq/data/namesrv/store:/root/store \
-e &quot;MAX_POSSIBLE_HEAP=100000000&quot; \
rocketmqinc/rocketmq \
sh mqnamesrv</span>


<span class="token comment">#创建目录存储broker日志信息和配置文件</span>
<span class="token key attr-name">mkdir</span> <span class="token value attr-value">-p  /usr/local/server/rocketmq/data/broker/logs   /usr/local/server/rocketmq/data/broker/store /usr/local/server/rocketmq/conf</span>

<span class="token comment">#创建配置文件</span>
<span class="token key attr-name">vi</span> <span class="token value attr-value">/usr/local/server/rocketmq/conf/broker.conf</span>

<span class="token comment">#配置文件完整内容如下</span>
<span class="token comment"># 所属集群名称，如果节点较多可以配置多个</span>
<span class="token key attr-name">brokerClusterName</span> <span class="token punctuation">=</span> <span class="token value attr-value">DefaultCluster</span>
<span class="token comment">#broker名称，master和slave使用相同的名称，表明他们的主从关系</span>
<span class="token key attr-name">brokerName</span> <span class="token punctuation">=</span> <span class="token value attr-value">broker-a</span>
<span class="token comment">#0表示Master，大于0表示不同的slave</span>
<span class="token key attr-name">brokerId</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>
<span class="token comment">#表示几点做消息删除动作，默认是凌晨4点</span>
<span class="token key attr-name">deleteWhen</span> <span class="token punctuation">=</span> <span class="token value attr-value">04</span>
<span class="token comment">#在磁盘上保留消息的时长，单位是小时</span>
<span class="token key attr-name">fileReservedTime</span> <span class="token punctuation">=</span> <span class="token value attr-value">48</span>
<span class="token comment">#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；</span>
<span class="token key attr-name">brokerRole</span> <span class="token punctuation">=</span> <span class="token value attr-value">ASYNC_MASTER</span>
<span class="token comment">#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；</span>
<span class="token key attr-name">flushDiskType</span> <span class="token punctuation">=</span> <span class="token value attr-value">ASYNC_FLUSH</span>
<span class="token comment"># 设置broker节点所在服务器的ip地址</span>
<span class="token key attr-name">brokerIP1</span> <span class="token punctuation">=</span> <span class="token value attr-value">192.168.211.130</span>
<span class="token comment"># 磁盘使用达到95%之后,生产者再写入消息会报错 CODE: 14 DESC: service not available now, maybe disk full</span>
<span class="token key attr-name">diskMaxUsedSpaceRatio</span><span class="token punctuation">=</span><span class="token value attr-value">95</span>

<span class="token comment">#创建broker</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">run -d  \
--restart=always \
--name rmqbroker \
--link rmqnamesrv:namesrv \
-p 10911:10911 \
-p 10909:10909 \
-v  /usr/local/server/rocketmq/data/broker/logs:/root/logs \
-v  /usr/local/server/rocketmq/data/broker/store:/root/store \
-v /usr/local/server/rocketmq/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf \
-e &quot;NAMESRV_ADDR=namesrv:9876&quot; \
-e &quot;MAX_POSSIBLE_HEAP=200000000&quot; \
rocketmqinc/rocketmq \
sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf</span>

<span class="token comment">#创建控制台console</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">run -d \
--restart=always \
--name rmqadmin \
-e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.211.130:9876 \
-Dcom.rocketmq.sendMessageWithVIPChannel=false&quot; \
-p 9999:8080 \
pangliang/rocketmq-console-ng</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h2 id="dockerfile-springboot"><a href="#dockerfile-springboot" class="header-anchor">#</a> Dockerfile-SpringBoot</h2> <p>以IgeMonitor例，使用Dockerfile构建,Dockerfile文件如下：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">FROM</span> <span class="token value attr-value">openjdk:11-jre</span>
<span class="token key attr-name">LABEL</span> <span class="token value attr-value">maintainer=&quot;研究院研发组 shenkunlin@itcast.cn&quot;</span>
<span class="token key attr-name">RUN</span> <span class="token value attr-value">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone</span>
<span class="token key attr-name">ADD</span> <span class="token value attr-value">./ige-monitor-igem-1.0.jar /app.jar</span>
<span class="token key attr-name">ENV</span> <span class="token value attr-value">dbuname=&quot;root&quot;</span>
<span class="token key attr-name">ENV</span> <span class="token value attr-value">dbpwd=&quot;root&quot;</span>
<span class="token key attr-name">ENV</span> <span class="token value attr-value">dbname=&quot;ige_config&quot;</span>
<span class="token key attr-name">ENV</span> <span class="token value attr-value">dburl=&quot;localhost:3306&quot;</span>
<span class="token key attr-name">ENV</span> <span class="token value attr-value">iport=&quot;8085&quot;</span>
<span class="token key attr-name">WORKDIR</span> <span class="token value attr-value">/</span>
<span class="token key attr-name">ENTRYPOINT</span> <span class="token value attr-value">[&quot;sh&quot;,&quot;-c&quot;,&quot;java -jar -Ddbuname=$dbuname -Ddbpwd=$dbpwd -Ddbname=$dbname -Ddburl=$dburl -Diport=$iport -Xms512m -Xmx512m -XX:PermSize=512M -XX:MaxPermSize=512m /app.jar&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>构建镜像：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name"> docker</span> <span class="token value attr-value">build -t igemonitor:2.0 .</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装容器：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -it -d --name=igemonitor \
-p 8085:8085 -p 28888:28888 \
--restart=always \
-e dbuname=root \
-e dbpwd=123456 \
-e dburl=192.168.211.131:3306 \
dockershenkunlin/igemonitor:v2.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="镜像上传dockerhub"><a href="#镜像上传dockerhub" class="header-anchor">#</a> 镜像上传Dockerhub</h2> <p>Dockerhub地址：https://hub.docker.com/，如果想将自己制作的镜像发布上去，首先可以注册一个DockerHub账号：<code>dockershenkunlin</code>，密码：<code>***********</code></p> <p>1）创建仓库</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400011681-793e0087-c93c-4bd0-9af7-ee31e38c9c41.png" alt="img"></p> <p>2）镜像推送</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#查看本地容器</span>
<span class="token key attr-name">[root@localhost</span> <span class="token value attr-value">igemonitor]# docker ps</span>
<span class="token key attr-name">CONTAINER</span> <span class="token value attr-value">ID        IMAGE                  NAMES</span>
<span class="token key attr-name">4eecde9ee7f6</span> <span class="token value attr-value">       igemonitor:1.0        igemonitor</span>

<span class="token comment">#并提交容器制作成本地镜像</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">commit igemonitor dockershenkunlin/igemonitor:v1.0</span>

<span class="token comment">#登录dockerhub</span>
<span class="token key attr-name">[root@localhost</span> <span class="token value attr-value">igemonitor]# docker login</span>
<span class="token key attr-name">Login</span> <span class="token value attr-value">with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.</span>
<span class="token key attr-name">Username</span><span class="token punctuation">:</span> <span class="token value attr-value">dockershenkunlin</span>
<span class="token key attr-name">Password</span><span class="token punctuation">:</span>
<span class="token key attr-name">Login</span> <span class="token value attr-value">Succeeded</span>

<span class="token comment">#将本地镜像推送至Dockerhub</span>
<span class="token key attr-name">docker</span> <span class="token value attr-value">push dockershenkunlin/igemonitor:1.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>我们可以看到镜像已经推送至Dockerhub了，如下图：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400022700-5ce89bc1-8894-4547-9625-cf5cb8f0923f.png" alt="img"></p> <p>3）镜像下载安装测试</p> <p>记得先清除本地Docker镜像，再执行如下操作安装镜像：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">docker</span> <span class="token value attr-value">run -it -d --name=igemonitor \
-p 8085:8085 -p 28888:28888 \
--restart=always \
-e dbuname=root \
-e dbpwd=123456 \
-e dburl=192.168.211.130:3306 \
dockershenkunlin/igemonitor:v1.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>效果如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400033528-d67798dd-cd96-419b-84d4-b503c5ffeb69.png" alt="img"></p> <p>安装完成后，访问http://192.168.211.130:8085/效果如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400044548-d2c2d4a3-d35c-45c5-b65f-8fe7ae03cd9b.png" alt="img"></p> <h2 id="jar包安装到本地仓库"><a href="#jar包安装到本地仓库" class="header-anchor">#</a> jar包安装到本地仓库</h2> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">mvn</span> <span class="token value attr-value">install:install-file -Dfile=E:\ige-rpc-client-igem-1.0.jar -DgroupId=com.itheima -DartifactId=ige-rpc-client -Dversion=igem-1.0 -Dpackaging=jar</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>效果如下：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400055141-95734f88-0ab0-4ef8-9cb9-e0812b14422a.png" alt="img"></p> <h1 id="开发常见问题"><a href="#开发常见问题" class="header-anchor">#</a> 开发常见问题</h1> <h2 id="idea运行程序无法启动"><a href="#idea运行程序无法启动" class="header-anchor">#</a> Idea运行程序无法启动</h2> <p>运行程序出现如下错误：</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400064659-b511cb35-dc96-4916-a76a-975b2813fb82.png" alt="img"></p> <p>出现这个的原因一般是因为项目需要打印的环境变量太长，超过了限制，需要你缩短命令行来解决问题。解决这个问题，只需要修改工作空间中的配置即可。</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#在项目的.idea/workspace.xml文件中，找到</span>
<span class="token key attr-name">&lt;component</span> <span class="token value attr-value">name=&quot;PropertiesComponent&quot;&gt;</span>

<span class="token comment">#后面在添加下面一行配置即可,这种方式一次设置就行。</span>
<span class="token key attr-name">&lt;property</span> <span class="token value attr-value">name=&quot;dynamic.classpath&quot; value=&quot;true&quot; /&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2023/10/29</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Docker/Dockerfile自定义镜像.html" class="prev">
        Dockerfile自定义镜像
      </a></span> <span class="next"><a href="/Git/git常用命令.html">
        git常用命令
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a19eb3cb.js" defer></script><script src="/assets/js/2.34fff606.js" defer></script><script src="/assets/js/1.16393a26.js" defer></script><script src="/assets/js/32.ed5593a9.js" defer></script>
  </body>
</html>
