<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis相关面试题 | 周岐的个人博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="logo.jpg">
    <meta name="description" content="个人技术博客">
    
    <link rel="preload" href="/assets/css/0.styles.8c53e149.css" as="style"><link rel="preload" href="/assets/js/app.a19eb3cb.js" as="script"><link rel="preload" href="/assets/js/2.34fff606.js" as="script"><link rel="preload" href="/assets/js/1.16393a26.js" as="script"><link rel="preload" href="/assets/js/59.371bd0d7.js" as="script"><link rel="prefetch" href="/assets/js/10.717bd423.js"><link rel="prefetch" href="/assets/js/100.c5cd47b0.js"><link rel="prefetch" href="/assets/js/101.7151b423.js"><link rel="prefetch" href="/assets/js/102.6b36385a.js"><link rel="prefetch" href="/assets/js/103.d3861779.js"><link rel="prefetch" href="/assets/js/104.9578b311.js"><link rel="prefetch" href="/assets/js/105.aae477dc.js"><link rel="prefetch" href="/assets/js/106.1d5215a7.js"><link rel="prefetch" href="/assets/js/107.3c330c2f.js"><link rel="prefetch" href="/assets/js/108.cefc2802.js"><link rel="prefetch" href="/assets/js/109.541aa22e.js"><link rel="prefetch" href="/assets/js/11.e0bfb9a4.js"><link rel="prefetch" href="/assets/js/110.60e0b929.js"><link rel="prefetch" href="/assets/js/111.45058523.js"><link rel="prefetch" href="/assets/js/112.d10d50d0.js"><link rel="prefetch" href="/assets/js/113.4a3deb35.js"><link rel="prefetch" href="/assets/js/114.b917d1a1.js"><link rel="prefetch" href="/assets/js/115.50e3fa0f.js"><link rel="prefetch" href="/assets/js/116.78f04bf7.js"><link rel="prefetch" href="/assets/js/117.b5372645.js"><link rel="prefetch" href="/assets/js/118.f990eb5b.js"><link rel="prefetch" href="/assets/js/119.f178eabd.js"><link rel="prefetch" href="/assets/js/12.bdf46c02.js"><link rel="prefetch" href="/assets/js/120.d98a3aa8.js"><link rel="prefetch" href="/assets/js/121.abcdf60f.js"><link rel="prefetch" href="/assets/js/122.ed3550a9.js"><link rel="prefetch" href="/assets/js/123.8ef421f8.js"><link rel="prefetch" href="/assets/js/124.1adba2c7.js"><link rel="prefetch" href="/assets/js/125.6706c196.js"><link rel="prefetch" href="/assets/js/126.1e50c7b4.js"><link rel="prefetch" href="/assets/js/127.be9df6e0.js"><link rel="prefetch" href="/assets/js/128.9e68fe60.js"><link rel="prefetch" href="/assets/js/129.f9313e6a.js"><link rel="prefetch" href="/assets/js/13.05b00624.js"><link rel="prefetch" href="/assets/js/130.87d4d918.js"><link rel="prefetch" href="/assets/js/131.b7ab0bc3.js"><link rel="prefetch" href="/assets/js/132.4bf1103a.js"><link rel="prefetch" href="/assets/js/133.2bda9aa2.js"><link rel="prefetch" href="/assets/js/134.e6631028.js"><link rel="prefetch" href="/assets/js/135.5b78aed3.js"><link rel="prefetch" href="/assets/js/136.377fd687.js"><link rel="prefetch" href="/assets/js/137.623e1a9d.js"><link rel="prefetch" href="/assets/js/138.c2e1c9a1.js"><link rel="prefetch" href="/assets/js/139.6263f657.js"><link rel="prefetch" href="/assets/js/14.092a5584.js"><link rel="prefetch" href="/assets/js/140.a54c064d.js"><link rel="prefetch" href="/assets/js/141.0de2ed45.js"><link rel="prefetch" href="/assets/js/142.61ea0663.js"><link rel="prefetch" href="/assets/js/143.24d35022.js"><link rel="prefetch" href="/assets/js/144.196d7653.js"><link rel="prefetch" href="/assets/js/145.223f0fcf.js"><link rel="prefetch" href="/assets/js/146.a09f8d1b.js"><link rel="prefetch" href="/assets/js/147.62d69c7c.js"><link rel="prefetch" href="/assets/js/148.d46a05d0.js"><link rel="prefetch" href="/assets/js/149.467faf3d.js"><link rel="prefetch" href="/assets/js/15.758ee11b.js"><link rel="prefetch" href="/assets/js/150.0443932e.js"><link rel="prefetch" href="/assets/js/151.0879c074.js"><link rel="prefetch" href="/assets/js/152.4d08f8a9.js"><link rel="prefetch" href="/assets/js/153.ce46c4fa.js"><link rel="prefetch" href="/assets/js/154.fd65dd72.js"><link rel="prefetch" href="/assets/js/155.b975728f.js"><link rel="prefetch" href="/assets/js/156.61194924.js"><link rel="prefetch" href="/assets/js/157.97e4f54e.js"><link rel="prefetch" href="/assets/js/158.5290a2f0.js"><link rel="prefetch" href="/assets/js/159.3613e64b.js"><link rel="prefetch" href="/assets/js/16.2569be64.js"><link rel="prefetch" href="/assets/js/160.87d90e6b.js"><link rel="prefetch" href="/assets/js/161.a2a67f25.js"><link rel="prefetch" href="/assets/js/162.b51ccce1.js"><link rel="prefetch" href="/assets/js/163.85d33d23.js"><link rel="prefetch" href="/assets/js/164.5504b77f.js"><link rel="prefetch" href="/assets/js/165.be283131.js"><link rel="prefetch" href="/assets/js/166.8d0352c5.js"><link rel="prefetch" href="/assets/js/167.89c23a71.js"><link rel="prefetch" href="/assets/js/168.aa736b2c.js"><link rel="prefetch" href="/assets/js/169.296ccc1d.js"><link rel="prefetch" href="/assets/js/17.5b873df7.js"><link rel="prefetch" href="/assets/js/170.c706da49.js"><link rel="prefetch" href="/assets/js/171.6f79aeb1.js"><link rel="prefetch" href="/assets/js/172.ddcae302.js"><link rel="prefetch" href="/assets/js/173.f308eb43.js"><link rel="prefetch" href="/assets/js/174.b5ece966.js"><link rel="prefetch" href="/assets/js/175.538e3125.js"><link rel="prefetch" href="/assets/js/176.d54091dd.js"><link rel="prefetch" href="/assets/js/177.2ee0aa3d.js"><link rel="prefetch" href="/assets/js/178.667b3c59.js"><link rel="prefetch" href="/assets/js/179.07595c3e.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/180.300e0b70.js"><link rel="prefetch" href="/assets/js/181.89473dcd.js"><link rel="prefetch" href="/assets/js/182.ea6036d1.js"><link rel="prefetch" href="/assets/js/183.647f8d55.js"><link rel="prefetch" href="/assets/js/184.2e79dd55.js"><link rel="prefetch" href="/assets/js/185.bf4d6269.js"><link rel="prefetch" href="/assets/js/186.7a7ceaa7.js"><link rel="prefetch" href="/assets/js/187.09bb0f21.js"><link rel="prefetch" href="/assets/js/188.3604ce73.js"><link rel="prefetch" href="/assets/js/189.49b47b33.js"><link rel="prefetch" href="/assets/js/19.a45744ea.js"><link rel="prefetch" href="/assets/js/190.88e59ff4.js"><link rel="prefetch" href="/assets/js/191.a4b3e5c7.js"><link rel="prefetch" href="/assets/js/192.7527e6ed.js"><link rel="prefetch" href="/assets/js/193.c44a652d.js"><link rel="prefetch" href="/assets/js/194.6aaca2ce.js"><link rel="prefetch" href="/assets/js/195.64837df2.js"><link rel="prefetch" href="/assets/js/196.e1bd3d69.js"><link rel="prefetch" href="/assets/js/197.2b01de81.js"><link rel="prefetch" href="/assets/js/198.d1496fd2.js"><link rel="prefetch" href="/assets/js/199.27ab1442.js"><link rel="prefetch" href="/assets/js/20.4cb27e25.js"><link rel="prefetch" href="/assets/js/200.996d49f4.js"><link rel="prefetch" href="/assets/js/201.b71a4422.js"><link rel="prefetch" href="/assets/js/202.0ea49eaa.js"><link rel="prefetch" href="/assets/js/203.8ebb1f77.js"><link rel="prefetch" href="/assets/js/204.c8d10533.js"><link rel="prefetch" href="/assets/js/205.0b8c4d0d.js"><link rel="prefetch" href="/assets/js/206.cce9bcce.js"><link rel="prefetch" href="/assets/js/207.8130e9ba.js"><link rel="prefetch" href="/assets/js/208.871753be.js"><link rel="prefetch" href="/assets/js/209.757eda19.js"><link rel="prefetch" href="/assets/js/21.445690e6.js"><link rel="prefetch" href="/assets/js/210.983cae1d.js"><link rel="prefetch" href="/assets/js/211.8e4ddaf8.js"><link rel="prefetch" href="/assets/js/212.6412fc61.js"><link rel="prefetch" href="/assets/js/213.656a6a73.js"><link rel="prefetch" href="/assets/js/214.befcd199.js"><link rel="prefetch" href="/assets/js/215.2c292e81.js"><link rel="prefetch" href="/assets/js/216.78cc7e8b.js"><link rel="prefetch" href="/assets/js/217.4fa8b1da.js"><link rel="prefetch" href="/assets/js/218.4c8cce7c.js"><link rel="prefetch" href="/assets/js/219.d041d013.js"><link rel="prefetch" href="/assets/js/22.bc7c4cdb.js"><link rel="prefetch" href="/assets/js/220.10a9ed88.js"><link rel="prefetch" href="/assets/js/221.bc25f391.js"><link rel="prefetch" href="/assets/js/222.dfdd15b7.js"><link rel="prefetch" href="/assets/js/223.1afa90d8.js"><link rel="prefetch" href="/assets/js/224.69bb037f.js"><link rel="prefetch" href="/assets/js/225.94590311.js"><link rel="prefetch" href="/assets/js/226.d1818961.js"><link rel="prefetch" href="/assets/js/227.2a969459.js"><link rel="prefetch" href="/assets/js/228.e3f5706b.js"><link rel="prefetch" href="/assets/js/229.0e6df830.js"><link rel="prefetch" href="/assets/js/23.b7994ecf.js"><link rel="prefetch" href="/assets/js/230.6bc93aa6.js"><link rel="prefetch" href="/assets/js/231.9b7cc0ec.js"><link rel="prefetch" href="/assets/js/232.80b7488d.js"><link rel="prefetch" href="/assets/js/233.302790de.js"><link rel="prefetch" href="/assets/js/234.68b70723.js"><link rel="prefetch" href="/assets/js/235.1b3c3110.js"><link rel="prefetch" href="/assets/js/236.e536b7bb.js"><link rel="prefetch" href="/assets/js/237.cca351a3.js"><link rel="prefetch" href="/assets/js/238.f4d0edb0.js"><link rel="prefetch" href="/assets/js/239.4f57e73d.js"><link rel="prefetch" href="/assets/js/24.26e26a07.js"><link rel="prefetch" href="/assets/js/240.1e76f670.js"><link rel="prefetch" href="/assets/js/241.8795d427.js"><link rel="prefetch" href="/assets/js/242.c72205cb.js"><link rel="prefetch" href="/assets/js/243.d7105431.js"><link rel="prefetch" href="/assets/js/244.361b2ea5.js"><link rel="prefetch" href="/assets/js/245.055fa0a3.js"><link rel="prefetch" href="/assets/js/246.0dee7b05.js"><link rel="prefetch" href="/assets/js/247.c13fc7d7.js"><link rel="prefetch" href="/assets/js/248.4e481dba.js"><link rel="prefetch" href="/assets/js/25.626c2c33.js"><link rel="prefetch" href="/assets/js/26.c4aa6beb.js"><link rel="prefetch" href="/assets/js/27.b1a828b7.js"><link rel="prefetch" href="/assets/js/28.f9133ade.js"><link rel="prefetch" href="/assets/js/29.54e09df1.js"><link rel="prefetch" href="/assets/js/3.4db2e19a.js"><link rel="prefetch" href="/assets/js/30.d2654359.js"><link rel="prefetch" href="/assets/js/31.c57cf20e.js"><link rel="prefetch" href="/assets/js/32.ed5593a9.js"><link rel="prefetch" href="/assets/js/33.05f050d1.js"><link rel="prefetch" href="/assets/js/34.6d7f5b2f.js"><link rel="prefetch" href="/assets/js/35.67cc577c.js"><link rel="prefetch" href="/assets/js/36.0bbc204a.js"><link rel="prefetch" href="/assets/js/37.8ac35368.js"><link rel="prefetch" href="/assets/js/38.50bd8dba.js"><link rel="prefetch" href="/assets/js/39.38b783ce.js"><link rel="prefetch" href="/assets/js/4.66c035fd.js"><link rel="prefetch" href="/assets/js/40.cd3ee2ff.js"><link rel="prefetch" href="/assets/js/41.f4bec9a4.js"><link rel="prefetch" href="/assets/js/42.27fa7fec.js"><link rel="prefetch" href="/assets/js/43.2af4a015.js"><link rel="prefetch" href="/assets/js/44.8e48aaf4.js"><link rel="prefetch" href="/assets/js/45.d41c0319.js"><link rel="prefetch" href="/assets/js/46.de5cb880.js"><link rel="prefetch" href="/assets/js/47.cc7c8048.js"><link rel="prefetch" href="/assets/js/48.22c69558.js"><link rel="prefetch" href="/assets/js/49.cdd62276.js"><link rel="prefetch" href="/assets/js/5.632744e8.js"><link rel="prefetch" href="/assets/js/50.a7eebe42.js"><link rel="prefetch" href="/assets/js/51.a447aa90.js"><link rel="prefetch" href="/assets/js/52.c0f076a5.js"><link rel="prefetch" href="/assets/js/53.3564c5b0.js"><link rel="prefetch" href="/assets/js/54.c5c6e6be.js"><link rel="prefetch" href="/assets/js/55.0fcb916b.js"><link rel="prefetch" href="/assets/js/56.2812bd7d.js"><link rel="prefetch" href="/assets/js/57.4f95d22a.js"><link rel="prefetch" href="/assets/js/58.d9baba05.js"><link rel="prefetch" href="/assets/js/6.85f26be6.js"><link rel="prefetch" href="/assets/js/60.a715876a.js"><link rel="prefetch" href="/assets/js/61.6b1a782b.js"><link rel="prefetch" href="/assets/js/62.11484b5e.js"><link rel="prefetch" href="/assets/js/63.7b92573e.js"><link rel="prefetch" href="/assets/js/64.98aee69e.js"><link rel="prefetch" href="/assets/js/65.aa40eacd.js"><link rel="prefetch" href="/assets/js/66.67703170.js"><link rel="prefetch" href="/assets/js/67.392b86af.js"><link rel="prefetch" href="/assets/js/68.9610b8e9.js"><link rel="prefetch" href="/assets/js/69.6277fc7a.js"><link rel="prefetch" href="/assets/js/7.b775b056.js"><link rel="prefetch" href="/assets/js/70.b47adb04.js"><link rel="prefetch" href="/assets/js/71.0051199b.js"><link rel="prefetch" href="/assets/js/72.fa131834.js"><link rel="prefetch" href="/assets/js/73.fd8d275f.js"><link rel="prefetch" href="/assets/js/74.82095aed.js"><link rel="prefetch" href="/assets/js/75.41fad4ea.js"><link rel="prefetch" href="/assets/js/76.36bb1714.js"><link rel="prefetch" href="/assets/js/77.83c409c1.js"><link rel="prefetch" href="/assets/js/78.ca197ebf.js"><link rel="prefetch" href="/assets/js/79.9f0de524.js"><link rel="prefetch" href="/assets/js/80.7dd0f8a1.js"><link rel="prefetch" href="/assets/js/81.a5d44424.js"><link rel="prefetch" href="/assets/js/82.03d59f96.js"><link rel="prefetch" href="/assets/js/83.43da9399.js"><link rel="prefetch" href="/assets/js/84.e9ab171d.js"><link rel="prefetch" href="/assets/js/85.523fe07f.js"><link rel="prefetch" href="/assets/js/86.90aac9c6.js"><link rel="prefetch" href="/assets/js/87.1af6082d.js"><link rel="prefetch" href="/assets/js/88.3d7d10f0.js"><link rel="prefetch" href="/assets/js/89.69f4fbaf.js"><link rel="prefetch" href="/assets/js/90.30407e67.js"><link rel="prefetch" href="/assets/js/91.94355f67.js"><link rel="prefetch" href="/assets/js/92.8247a2fb.js"><link rel="prefetch" href="/assets/js/93.245ee436.js"><link rel="prefetch" href="/assets/js/94.a212b15e.js"><link rel="prefetch" href="/assets/js/95.dec85448.js"><link rel="prefetch" href="/assets/js/96.77ebb7ae.js"><link rel="prefetch" href="/assets/js/97.0a615ee3.js"><link rel="prefetch" href="/assets/js/98.9d539c75.js"><link rel="prefetch" href="/assets/js/99.270c2389.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.b7a3ab4f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8c53e149.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">周岐的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java SE/guide.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/项目总结/Mybatis使用/Mybatis分页实现.html" class="nav-link">
  项目总结
</a></div><div class="nav-item"><a href="/Java面试题/Java基础面试题/==和equals的区别.html" class="nav-link">
  Java面试题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/demo223" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/zhouqi-5zipq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java SE/guide.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/项目总结/Mybatis使用/Mybatis分页实现.html" class="nav-link">
  项目总结
</a></div><div class="nav-item"><a href="/Java面试题/Java基础面试题/==和equals的区别.html" class="nav-link">
  Java面试题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/demo223" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/zhouqi-5zipq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/java SE/guide" class="sidebar-heading clickable"><span>java SE</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>java web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mybatis-Plus</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用工具类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java面试题</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/Java基础面试题/==和equals的区别" class="sidebar-heading clickable"><span>Java基础面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/多线程面试题/多线程面试题" class="sidebar-heading clickable"><span>多线程面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/集合面试题/Java集合相关面试题" class="sidebar-heading clickable"><span>集合面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/Mybatis面试题/Mybatis面试题" class="sidebar-heading clickable"><span>Mybatis面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/SpringBoot面试题/SpringBoot面试题" class="sidebar-heading clickable"><span>SpringBoot面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/MySQL面试题/MySQL面试题" class="sidebar-heading clickable"><span>MySQL面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/Redis面试题/Redis面试题" class="sidebar-heading clickable open"><span>Redis面试题</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java面试题/Redis面试题/Redis面试题.html" class="sidebar-link">Redis面试题</a></li><li><a href="/Java面试题/Redis面试题/Redis相关面试题.html" class="active sidebar-link">Redis相关面试题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java面试题/Redis面试题/Redis相关面试题.html#_1-数据类型" class="sidebar-link">1.数据类型</a></li><li class="sidebar-sub-header"><a href="/Java面试题/Redis面试题/Redis相关面试题.html#_2-持久化" class="sidebar-link">2.持久化</a></li><li class="sidebar-sub-header"><a href="/Java面试题/Redis面试题/Redis相关面试题.html#_3-主从和集群" class="sidebar-link">3.主从和集群</a></li><li class="sidebar-sub-header"><a href="/Java面试题/Redis面试题/Redis相关面试题.html#_4-使用场景" class="sidebar-link">4.使用场景</a></li><li class="sidebar-sub-header"><a href="/Java面试题/Redis面试题/Redis相关面试题.html#_5-redis分布式锁" class="sidebar-link">5 Redis分布式锁</a></li><li class="sidebar-sub-header"><a href="/Java面试题/Redis面试题/Redis相关面试题.html#_6-其他" class="sidebar-link">6.其他</a></li><li class="sidebar-sub-header"><a href="/Java面试题/Redis面试题/Redis相关面试题.html#_7-面试现场" class="sidebar-link">7 面试现场</a></li></ul></li><li><a href="/Java面试题/Redis面试题/Redis复习.html" class="sidebar-link">Redis复习</a></li><li><a href="/Java面试题/Redis面试题/Redis如何与数据库保持双写一致性.html" class="sidebar-link">Redis如何与数据库保持双写一致性</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/微服务面试题/微服务面试题" class="sidebar-heading clickable"><span>微服务面试题</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/SpringBoot文档/01-Spring-IOC" class="sidebar-heading clickable"><span>SpringBoot文档</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/微服务文档/SpringCloud介绍" class="sidebar-heading clickable"><span>微服务文档</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis相关面试题"><a href="#redis相关面试题" class="header-anchor">#</a> Redis相关面试题</h1> <h2 id="_1-数据类型"><a href="#_1-数据类型" class="header-anchor">#</a> 1.数据类型</h2> <h3 id="_1-redis的常用数据类型有哪些"><a href="#_1-redis的常用数据类型有哪些" class="header-anchor">#</a> 1.Redis的常用数据类型有哪些 ?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>Redis是典型的“键值型”数据库，不同数据类型其key结构一致，value有所差异。常见的类型有：string、hash、list、set、SortedSet等。</p> <p>而基于以上5种基本数据类型，Redis又拓展了几种拓展类型，例如：BitMap、HyperLogLog、Geo等。</p> <ul><li><p>String类型是Redis中最常见的数据类型，value与key一样都是Redis自定义的字符串结构，称为SDS。不过在保存数字、小字符串时因为采用INT和EMBSTR编码，内存结构紧凑，只需要申请一次内存分配，效率更高，更节省内存。</p> <p>而超过44字节的大字符串时则需要采用RAW编码，申请额外的SDS空间，需要两次内存分配，效率较低，内存占用也较高，但最大不超过512mb，因此建议单个value尽量不要超过44字节。</p> <p>String类型常用来做计数器、简单数据存储等。复杂数据建议采用其它数据结构。</p></li> <li><p>Hash结构，其value与Java中的HashMap类似，有是一个key-value结构。如果有一个对象需要被Redis缓存，而且将来可能有部分修改。建议用hash结构来存储这个对象的每一个字段和字段值。而不是作为一个JSON字符串存储到String类型中。因为Hash结构的每一个字段都可以单独做修改，而String的JSON串必须整体覆盖。</p> <p>与Java中的hashMap不同的是，Redis中的Hash底层采用了渐进式rehash的算法，在做rehash时会创建一个新的hashtable，每次操作元素时移动一部分数据，只到所有数据迁移完成，再用新的HashTable来代替旧的，避免了因为rehash导致的阻塞，因此性能更高。</p></li> <li><p>List结构的value类型可以看做是一个双端链表，提供了一些命令便于我们从首尾操作元素。为了节省内存空间，底层采用了ZipList（压缩列表）来做基础存储。当压缩列表数据达到阈值（512）则会创建新的压缩列表。每个压缩列表作为一个双端链表的一个节点，最终形成一个QuickList结构。而且QuickList结构与一般的双端链表不同，他可以对中间不常用的ZipList节点做压缩以节省内存。</p> <p>List结构常用来模拟队列，实现任务排队这样的功能。</p></li> <li><p>Set结构的value与Java的Set类似，元素不可重复。Redis提供了求交集、并集等命令，可以帮助我们实现例如：好友列表、共同好友等功能。
当存储元素是整数时，其底层默认采用IntSet结构，可以看做是一个有序的数组，结构紧凑，效率较高。而元素如果不是整数，或者元素量超过512这个阈值时则会转为hash表结构，内存占用会有大的增加。因此我们在使用Set结构时尽量采用数组存储，例如数值类型的id。而且元素数量尽量不要超过512，避免出现BigKey。</p></li> <li><p>SortedSet，也叫ZSet。其value就是一个有序的Set集合，元素唯一，并且会按照一个指定的score值排序。因此常用来做排行榜功能。</p> <p>SortedSet底层的利用Hash表保证元素的唯一性。利用跳表（SkipList）来保证元素的有序性，因此数据会有重复存储，内存占用较高，是一种典型的以空间换时间的设计。不建议在SortedSet中放入过多数据。</p></li></ul> <h3 id="_2-跳表你了解吗"><a href="#_2-跳表你了解吗" class="header-anchor">#</a> 2.跳表你了解吗？</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆☆</p></blockquote> <p>跳表(SkipList)首先是链表，但与传统的链表相比有几点差异：</p> <ul><li><p>跳表结合了链表和二分查找的思想</p></li> <li><p>元素按照升序排列存储</p></li> <li><p>节点可能包含多个指针，指针跨度不同</p></li> <li><p>查找时从顶层向下，不断缩小搜索范围</p></li> <li><p>整个查询的复杂度为 O ( log ⁡ n )</p></li></ul> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220825104355442.png" alt="image-20220825104355442"></p> <p><strong>Redis数据类型Sorted Set使用了跳表作为其中一种数据结构</strong></p> <h2 id="_2-持久化"><a href="#_2-持久化" class="header-anchor">#</a> 2.持久化</h2> <h3 id="redis的数据持久化策略有哪些"><a href="#redis的数据持久化策略有哪些" class="header-anchor">#</a> Redis的数据持久化策略有哪些 ?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆</p></blockquote> <p>在Redis中提供了两种数据持久化的方式：1、RDB	2、AOF</p> <p><strong>RDB：</strong></p> <p>定期更新，定期将Redis中的数据生成的快照同步到磁盘等介质上，磁盘上保存的就是Redis的内存快照</p> <p>优点：数据文件的大小相比于AOF较小，使用RDB进行数据恢复速度较快</p> <p>缺点：比较耗时，存在丢失数据的风险</p> <p><strong>AOF：</strong></p> <p>将Redis所执行过的所有指令都记录下来，在下次Redis重启时，只需要执行指令就可以了</p> <p>优点：数据丢失的风险大大降低了</p> <p>缺点：数据文件的大小相比于RDB较大，使用AOF文件进行数据恢复的时候速度较慢</p> <blockquote><p>你们的项目中的持久化是如何配置选择的？</p> <p>RDB+AOF</p></blockquote> <h2 id="_3-主从和集群"><a href="#_3-主从和集群" class="header-anchor">#</a> 3.主从和集群</h2> <h3 id="_3-1-redis集群有哪些方案-知道嘛"><a href="#_3-1-redis集群有哪些方案-知道嘛" class="header-anchor">#</a> 3.1 Redis集群有哪些方案, 知道嘛 ?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆</p></blockquote> <p>在Redis中提供的集群方案总共有三种：</p> <p>1、主从复制</p> <ul><li>保证高可用性</li> <li>实现故障转移需要手动实现</li> <li>无法实现海量数据存储</li></ul> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220825235753402.png" alt="image-20220825235753402"></p> <p>2、哨兵模式</p> <ul><li>保证高可用性</li> <li>可以实现自动化的故障转移</li> <li>无法实现海量数据存储</li></ul> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220825235832242.png" alt="image-20220825235832242"></p> <p>3、Redis分片集群</p> <ul><li>保证高可用性</li> <li>可以实现自动化的故障转移</li> <li>可以实现海量数据存储</li></ul> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220825235913828.png" alt="image-20220825235913828"></p> <h3 id="_3-2-什么是-redis-主从同步"><a href="#_3-2-什么是-redis-主从同步" class="header-anchor">#</a> 3.2 什么是 Redis 主从同步？</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆☆☆</p></blockquote> <p>主从第一次同步是<strong>全量同步</strong></p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220826000009625.png" alt="image-20220826000009625"></p> <blockquote><p>第一阶段，全量同步流程
1.从节点执行replicaof命令，发送自己的replid和offset给主节点
2.主节点判断从节点的replid与自己的是否一致，
3.如果不一致说明是第一次来，需要做全量同步，主节点返回自己的replid给从节点
4.主节点开始执行bgsave，生成rdb文件
5.主节点发送rdb文件给从节点，再发送的过程中
6.从节点接收rdb文件，清空本地数据，加载rdb文件中的数据
7.同步过程中，主节点接收到的新命令写入从节点的写缓冲区(repl_buffer)
8.从节点接收到缓冲区数据后写入本地，并记录最新数据对应的offset
9.后期采用增量同步</p></blockquote> <p>后期数据变化后，则执行<strong>增量同步</strong></p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220826000106137.png" alt="image-20220826000106137"></p> <blockquote><p>1.主节点会不断把自己接收到的命令记录在repl_baklog中，并修改offset
2.从节点向主节点发送psync命令，发送自己的offset和replid
3.主节点判断replid和offset与从节点是否一致
4.如果replid一致，说明是增量同步。然后判断offset是否一致
5.如果从节点offset小于主节点offset，并且在repl_baklog中能找到对应数据
则将offset之间相差的数据发送给从节点
6.从节点接收到数据后写入本地，修改自己的offset与主节点一致</p></blockquote> <p>增量同步的风险</p> <blockquote><p>repl_baklog大小有上限，写满后会覆盖最早的数据。如果slave断开时间过久，导致尚未备份的数据被覆盖，则无法基于log做增量同步，只能再次全量同步。</p> <p>repl_baklog可以在配置文件中进行修改存储大小</p></blockquote> <h3 id="_3-3-你们使用redis是单点还是集群-哪种集群-说说你们生产环境redis部署情况"><a href="#_3-3-你们使用redis是单点还是集群-哪种集群-说说你们生产环境redis部署情况" class="header-anchor">#</a> 3.3 你们使用Redis是单点还是集群 ? 哪种集群 ?(说说你们生产环境redis部署情况？)</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆</p></blockquote> <p>一般部分服务做缓存用的Redis直接做主从（1主1从）加哨兵就可以了。单节点不超过10G内存，如果Redis内存不足则可以给不同服务分配独立的Redis主从节点。尽量不做分片集群。
原因：</p> <ul><li>维护起来比较麻烦</li> <li>集群之间的心跳检测和数据通信会消耗大量的网络带宽</li> <li>集群插槽分配不均和key的分批容易导致数据倾斜</li> <li>客户端的route会有性能损耗</li> <li>集群模式下无法使用lua脚本、事务</li></ul> <blockquote><p>其他扩展：</p> <ul><li>一般的企业中redis存储超过100GB就是极少见的，一般只存热点数据</li> <li>极端情况下，可以设置较大的内存。以阿里云为主，购买内存型服务器，目前最大的为：2048GB</li></ul> <p>https://www.aliyun.com/product/ebm?spm=5176.19720258.J_2686872250.8.328576f4mDkIu9&amp;scm=20140722.M_4603843.P_156.MO_871-ID_4603843-MID_4603843-CID_545-ST_5018-V_1</p></blockquote> <h3 id="_3-4-redis分片集群中数据是怎么存储和读取的"><a href="#_3-4-redis分片集群中数据是怎么存储和读取的" class="header-anchor">#</a> 3.4 Redis分片集群中数据是怎么存储和读取的 ?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆</p></blockquote> <p>Redis 集群引入了哈希槽的概念，Redis 集群有 16384 个哈希槽，每个 key通过 CRC16 校验后对 16384 取模来决定放置哪个槽，集群的每个节点负责一部分 hash 槽。</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/Redis%E9%9B%86%E7%BE%A4Hash%E6%A7%BD.jpg" alt=""></p> <p>上图是存值的流程，取值的流程类似</p> <blockquote><p>set {aaa}name zhangsan  计算hash是根据aaa计算的</p></blockquote> <h3 id="_3-5-redis集群脑裂"><a href="#_3-5-redis集群脑裂" class="header-anchor">#</a> 3.5 redis集群脑裂?</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆☆</p></blockquote> <p>关于reids集群会由于网络等原因出现脑裂的情况，所谓的集群脑裂就是，由于redis master节点和redis salve节点和sentinel处于不同的网络分区，使得sentinel没有能够心跳感知到master，所以通过选举的方式提升了一个salve为master，这样就存在了两个master，就像大脑分裂了一样，这样会导致客户端还在old master那里写入数据，新节点无法同步数据，当网络恢复后，sentinel会将old master降为salve，这时再从新master同步数据，这会导致大量数据丢失。</p> <p>正常情况：</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220826005227824.png" alt="image-20220826005227824"></p> <p>脑裂情况：</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220826005755464.png" alt="	"></p> <blockquote><p>当哨兵与主节点由于网络抖动原因断开了链接，哨兵监控到之后，则会从剩余的从节点中选出一个作为主节点</p> <p>redis的客户端这个时候并没有是可以正常链接之前的maser(主节点)，并且可以正常写入数据</p></blockquote> <p>假如现在网络恢复了，哨兵发现主从中有两个主节点，则会强制一个主节点变为从节点，看下图</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220826010517578.png" alt="image-20220826010517578"></p> <blockquote><p>由于原来的主节点变成了从节点，则需要执行主从同步流程，清理数据（之前的主节点），同步新主节点中的数据，<strong>在之前脑裂过程中，客户端写入的数据丢失</strong></p></blockquote> <p><strong>解决方案：</strong></p> <p>redis中有两个配置参数：</p> <ul><li><p>min-replicas-to-write 1   表示最少的salve节点为1个</p></li> <li><p>min-replicas-max-lag 5  表示数据复制和同步的延迟不能超过5秒</p></li></ul> <p>配置了这两个参数：如果发生脑裂：原master会在客户端写入操作的时候拒绝请求。这样可以避免大量数据丢失。</p> <h3 id="_3-6-怎么保证redis的高并发高可用"><a href="#_3-6-怎么保证redis的高并发高可用" class="header-anchor">#</a> 3.6 怎么保证redis的高并发高可用</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆</p></blockquote> <ul><li><p>主从+哨兵</p></li> <li><p>集群</p></li></ul> <h2 id="_4-使用场景"><a href="#_4-使用场景" class="header-anchor">#</a> 4.使用场景</h2> <h3 id="_4-1-项目中哪块使用了缓存"><a href="#_4-1-项目中哪块使用了缓存" class="header-anchor">#</a> 4.1 项目中哪块使用了缓存？</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>结合自己简历上写的项目模块说明这个问题，要陈述出当时的场景</p> <p>黑马头条：</p> <ul><li>用户行为数据</li> <li>热点文章</li></ul> <p>其他：</p> <ul><li>热点数据</li></ul> <h3 id="_4-2-什么是缓存穿透-怎么解决"><a href="#_4-2-什么是缓存穿透-怎么解决" class="header-anchor">#</a> 4.2 什么是缓存穿透 ? 怎么解决 ?</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>加入缓存以后的数据查询流程：</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220505084631909.png" alt="image-20220505084631909"></p> <p><strong>缓存穿透</strong>：</p> <p>概述：指查询一个一定<strong>不存在</strong>的数据，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到 DB 去查询，可能导致 DB 挂掉。</p> <blockquote><p>get请求：api/v1/news/13</p></blockquote> <p>解决方案：</p> <p>1、查询返回的数据为空，仍把这个空结果进行缓存，但过期时间会比较短</p> <p>2、布隆过滤器：将所有可能存在的数据哈希到一个足够大的 bitmap 中，一个一定不存在的数据会被这个 bitmap 拦截掉，从而避免了对DB的查询</p> <h3 id="_4-3-什么是缓存击穿-怎么解决"><a href="#_4-3-什么是缓存击穿-怎么解决" class="header-anchor">#</a> 4.3 什么是缓存击穿 ? 怎么解决 ?</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>概述：对于设置了过期时间的key，缓存在某个时间点过期的时候，恰好这时间点对这个Key有大量的并发请求过来，这些请求发现缓存过期一般都会从后端 DB 加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把 DB 压垮。</p> <p>解决方案：</p> <p>1、使用互斥锁：当缓存失效时，不立即去load db，先使用如 Redis 的 setnx 去设置一个互斥锁，当操作成功返回时再进行 load db的操作并回设缓存，否则重试get缓存的方法</p> <p>2、可以设置当前key逻辑过期，大概是思路如下：</p> <p>①：在设置key的时候，设置一个过期时间字段一块存入缓存中，不给当前key设置过期时间</p> <p>②：当查询的时候，从redis取出数据后判断时间是否过期</p> <p>③：如果过期则开通另外一个线程进行数据同步，当前线程正常返回数据，这个数据不是最新</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220911001815407.png" alt="image-20220911001815407"></p> <p>两种方案对比：</p> <table><thead><tr><th><strong>解决方案</strong></th> <th><strong>优点</strong></th> <th><strong>缺点</strong></th></tr></thead> <tbody><tr><td><strong>互斥锁</strong></td> <td>没有额外的内存消耗  <br>保证一致性  <br>实现简单</td> <td>线程需要等待，性能受影响  <br>可能有死锁风险</td></tr> <tr><td><strong>逻辑过期</strong></td> <td>线程无需等待，性能较好</td> <td>不保证一致性 <br>有额外内存消耗 <br>实现复杂</td></tr></tbody></table> <h3 id="_4-4-什么是缓存雪崩-怎么解决"><a href="#_4-4-什么是缓存雪崩-怎么解决" class="header-anchor">#</a> 4.4 什么是缓存雪崩 ? 怎么解决 ?</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>概述：设置缓存时采用了相同的过期时间，导致缓存在某一时刻同时失效，请求全部转发到DB，DB 瞬时压力过重雪崩。与缓存击穿的区别：雪崩是很多key，击穿是某一个key缓存。</p> <p>解决方案：</p> <p>将缓存失效时间分散开，比如可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。</p> <h3 id="_4-5-什么是布隆过滤器"><a href="#_4-5-什么是布隆过滤器" class="header-anchor">#</a> 4.5 什么是布隆过滤器？</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p><strong>概述</strong>：布隆过滤器（Bloom Filter）是1970年由布隆提出的。它实际上由一个很长的二进制向量(二进制数组)和一系列随机映射函数(hash函数)。</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220505124612288.png" alt="image-20220505124612288"></p> <p><strong>作用</strong>：布隆过滤器可以用于检索一个元素是否在一个集合中。</p> <p><strong>添加元素</strong>：将商品的id(id1)存储到布隆过滤器</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220505125247251.png" alt="image-20220505125247251"></p> <p>假设当前的布隆过滤器中提供了三个hash函数，此时就使用三个hash函数对id1进行哈希运算，运算结果分别为：1、4、9那么就会数组中对应的位置数据<strong>更改为1</strong>。</p> <p><strong>判断数据是否存在</strong>：使用相同的hash函数对数据进行哈希运算，得到哈希值。然后判断该哈希值所对应的数组位置是否都为1，如果不都是则说明该数据<strong>肯定不存在</strong>。如果是说明该数据<strong>可能</strong>存在，因为哈希运算可能就会存在重复的情况。如下图所示：</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220505130720532.png" alt="image-20220505130720532"></p> <p>假设添加完id1和id2数据以后，布隆过滤器中数据的存储方式如上图所示，那么此时要判断id3对应的数据在布隆过滤器中是否存在，按照上述的判断规则应该是存在，但是id3这个数据在布隆过滤器中压根就不存在，这种情况就属于误判。</p> <p><strong>误判率</strong>：数组越小误判率就越大，数组越大误判率就越小，但是同时带来了更多的内存消耗。</p> <p><strong>删除元素</strong>：布隆布隆器不支持数据的删除操作，因为如果支持删除那么此时就会影响判断不存在的结果。</p> <p>使用布隆过滤器：在redis的框架redisson中提供了布隆过滤器的实现，使用方式如下所示：</p> <p>pom.xml文件</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.13.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>测试代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span></span><span class="token class-name">Redisson</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RBloomFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RedissonClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Config</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//链接redis，</span>
        <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis://192.168.200.130:6379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;leadnews&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建redisson客户端</span>
        <span class="token class-name">RedissonClient</span> redissonClient <span class="token operator">=</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建布隆过滤器</span>
        <span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bloomFilter <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getBloomFilter</span><span class="token punctuation">(</span><span class="token string">&quot;bloom-filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>

        <span class="token comment">//初始化数据</span>
<span class="token comment">//        initData(bloomFilter, size);</span>
        <span class="token comment">//测试误判率</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>bloomFilter<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;总的误判条数为：&quot;</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 测试误判率
     * @param bloomFilter
     * @param size
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bloomFilter<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>     <span class="token comment">// 记录误判的数据条数</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> size<span class="token punctuation">;</span> x <span class="token operator">&lt;</span> size <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>bloomFilter<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                count<span class="token operator">++</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 初始化数据
     * @param bloomFilter
     * @param size
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initData</span><span class="token punctuation">(</span><span class="token class-name">RBloomFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bloomFilter<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//第一个参数：布隆过滤器存储的元素个数</span>
        <span class="token comment">//第一个参数：误判率</span>
        bloomFilter<span class="token punctuation">.</span><span class="token function">tryInit</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//在布隆过滤器初始化数据</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bloomFilter<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span> <span class="token operator">+</span> x<span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;初始化完成...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>Redis中使用布隆过滤器防止缓存穿透流程图如下所示：</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220505134107303.png" alt="image-20220505134107303"></p> <h3 id="_4-6-redis双写问题"><a href="#_4-6-redis双写问题" class="header-anchor">#</a> 4.6 redis双写问题?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>同步方案：</p> <p>普通缓存，一般采用更新时删除缓存，查询时建立缓存的延迟更新方案。</p> <p>异步方案：</p> <p>1、使用消息队列进行缓存同步：更改代码加入异步操作缓存的逻辑代码(数据库操作完毕以后，将要同步的数据发送到MQ中，MQ的消费者从MQ中获取数据，然后更新缓存)</p> <p>2、使用阿里巴巴旗下的canal组件实现数据同步：不需要更改业务代码，部署一个canal服务。canal服务把自己伪装成mysql的一个从节点，当mysql数据更新以后，canal会读取binlog数据，然后在通过canal的客户端获取到数据，更新缓存即可。</p> <h2 id="_5-redis分布式锁"><a href="#_5-redis分布式锁" class="header-anchor">#</a> 5 Redis分布式锁</h2> <h3 id="_5-1-redis分布式锁如何实现"><a href="#_5-1-redis分布式锁如何实现" class="header-anchor">#</a> 5.1 Redis分布式锁如何实现 ?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>Redis实现分布式锁主要利用Redis的<strong>setnx</strong>命令。setnx是SET if not exists(如果不存在，则 SET)的简写。</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220825225528939.png" alt="image-20220825225528939"></p> <p>上面这几个命令就是最基本的用来完成分布式锁的命令。</p> <p><strong>加锁</strong>：使用<code>setnx key value</code>命令，如果key不存在，设置value(加锁成功)。如果已经存在lock(也就是有客户端持有锁了)，则设置失败(加锁失败)。</p> <p><strong>解锁</strong>：使用<code>del</code>命令，通过删除键值释放锁。释放锁之后，其他客户端可以通过<code>setnx</code>命令进行加锁。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeoutSec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取线程标示</span>
    <span class="token class-name">String</span> threadId <span class="token operator">=</span> <span class="token constant">ID_PREFIX</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取锁</span>
    <span class="token class-name">Boolean</span> success <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token constant">KEY_PREFIX</span> <span class="token operator">+</span> name<span class="token punctuation">,</span> threadId<span class="token punctuation">,</span> timeoutSec<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_5-2-redis实现分布式锁如何合理的控制锁的有效时长"><a href="#_5-2-redis实现分布式锁如何合理的控制锁的有效时长" class="header-anchor">#</a> 5.2 Redis实现分布式锁如何合理的控制锁的有效时长？</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>有效时间设置多长，假如我的业务操作比有效时间长？我的业务代码还没执行完就自动给我解锁了，不就完蛋了吗。</p> <p>解决方案：</p> <p>1、第一种：程序员自己去把握，预估一下业务代码需要执行的时间，然后设置有效期时间比执行时间长一些，保证不会因为自动解锁影响到客户端业务代码的执行。</p> <p>2、第二种：给锁续期。</p> <p>锁续期实现思路：当加锁成功后，同时开启守护线程，默认有效期是用户所设置的，然后每隔10秒就会给锁续期到用户所设置的有效期，只要持有锁的客户端没有宕机，就能保证一直持有锁，直到业务代码执行完毕由客户端自己解锁，如果宕机了自然就在有效期失效后自动解锁。</p> <p>上述的第二种解决方案可以使用redis官方所提供的Redisson进行实现。</p> <p>使用步骤如下：</p> <p>1、加入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.13.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>2、定义配置类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis://192.168.200.130:6379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;leadnews&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>3、业务代码加入分布式锁</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redisLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

    <span class="token class-name">RLock</span> lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;anyLock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//第一个参数30s:表示尝试获取分布式锁，并且最大的等待获取锁的时间为30s</span>
        <span class="token comment">//第二个参数10s:表示上锁之后，10s内操作完毕将自动释放锁</span>
        <span class="token keyword">boolean</span> isLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> num <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> intNum <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>intNum <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> intNum <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;商品已抢完&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>isLock<span class="token punctuation">)</span><span class="token punctuation">{</span>
            intNum <span class="token operator">=</span> intNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span> intNum<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">//释放锁</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>4、Jmeter测试</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220825230303894.png" alt="image-20220825230303894"></p> <p>5.Redisson分布式锁原理（重要）</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220825230509879.png" alt="image-20220825230509879"></p> <blockquote><p>注意：Redisson的watchDog不是每10秒做一次续期，而是每隔(releaseTime / 3)的时间做一次续期。也就是锁自动释放时间的1/3，默认的锁释放时间是30秒，因此默认每隔10秒续期。</p></blockquote> <p>redisson实现的分布式锁是可重入的</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">boolean</span> isLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//执行业务</span>
	<span class="token function">add2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//释放锁</span>
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">boolean</span> isLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//执行业务</span>
    
    <span class="token comment">//释放锁</span>
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_5-3-你的项目中哪里用到了分布式锁"><a href="#_5-3-你的项目中哪里用到了分布式锁" class="header-anchor">#</a> 5.3 你的项目中哪里用到了分布式锁 ？</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆☆</p></blockquote> <p>黑马头条：</p> <ul><li>集群情况下定时任务（分布式锁）</li></ul> <p>立可得项目：</p> <ul><li>下单（分布式锁）</li></ul> <p>其他情况：</p> <ul><li><p>缓存</p></li> <li><p>秒杀</p></li> <li><p>幂等性场景</p></li></ul> <h2 id="_6-其他"><a href="#_6-其他" class="header-anchor">#</a> 6.其他</h2> <h3 id="_6-1-redis的数据过期策略有哪些"><a href="#_6-1-redis的数据过期策略有哪些" class="header-anchor">#</a> 6.1 Redis的数据过期策略有哪些 ?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆</p></blockquote> <p>数据删除策略：Redis中可以对数据设置数据的有效时间，数据的有效时间到了以后，就需要将数据从内存中删除掉。而删除的时候就需要按照指定的规则进行删除，这种删除规则就被称之为数据的删除策略。</p> <p>==Redis的过期策略就是指当Redis中缓存的key过期了以后，Redis是如何处理的==。</p> <p>Redis中数据的删除策略：</p> <p>① 惰性删除</p> <p>概述：设置该key过期时间后，我们不去管它，当需要该key时，我们在检查其是否过期，如果过期，我们就删掉它，反之返回该key。</p> <ul><li>优点：对CPU友好，我们只会在使用该键时才会进行过期检查，对于很多用不到的key不用浪费时间进行过期检查。</li> <li>缺点：对内存不友好，如果一个键已经过期，但是一直没有使用，那么该键就会一直存在内存中，如果数据库中有很多这种使用不到的过期键，这些键便永远不会被删除，内存永远不会释放。</li></ul> <blockquote><p>set name zhangsan  10</p> <p>get name   发现name过期了，直接删除key</p></blockquote> <p>② 定期删除</p> <p>概述：每隔一段时间，我们就对一些key进行检查，删除里面过期的key(从一定数量的数据库中取出一定数量的随机键进行检查，并删除其中的过期键)。</p> <ul><li><p>优点：可以通过限制删除操作执行的时长和频率来减少删除操作对 CPU 的影响。另外定期删除，也能有效释放过期键占用的内存。</p></li> <li><p>缺点：难以确定删除操作执行的时长和频率。</p> <p>如果执行的太频繁，定期删除策略变得和定时删除策略一样，对CPU不友好。如果执行的太少，那又和惰性删除一样了，过期键占用的内存不会及时得到释放。</p></li></ul> <p>另外最重要的是，在获取某个键时，如果某个键的过期时间已经到了，但是还没执行定期删除，那么就会返回这个键的值，这是业务不能忍受的错误。</p> <p>定期清理的两种模式：</p> <ul><li>SLOW模式是定时任务，执行频率默认为10hz，每次不超过25ms，以通过修改配置文件redis.conf 的 <strong>hz</strong> 选项来调整这个次数</li> <li>FAST模式执行频率不固定，每次事件循环会尝试执行，但两次间隔不低于2ms，每次耗时不超过1ms</li></ul> <p>Redis的过期删除策略：<strong>惰性删除 + 定期删除</strong>两种策略进行配合使用定期删除函数的运行频率</p> <h3 id="_6-2-redis的数据淘汰策略有哪些"><a href="#_6-2-redis的数据淘汰策略有哪些" class="header-anchor">#</a> 6.2 Redis的数据淘汰策略有哪些 ?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆</p></blockquote> <p>数据的淘汰策略：当Redis中的内存不够用时，此时在向Redis中添加新的key，那么Redis就会按照某一种规则将内存中的数据删除掉，这种数据的删除规则被称之为内存的淘汰策略。</p> <p>常见的数据淘汰策略：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>noeviction							<span class="token comment"># 不删除任何数据，内存不足直接报错(默认策略)</span>
volatile-lru						<span class="token comment"># 挑选最近最久使用的数据淘汰(举例：key1是在3s之前访问的, key2是在9s之前访问的，删除的就是key2)</span>
volatile-lfu						<span class="token comment"># 挑选最近最少使用数据淘汰  (举例：key1最近5s访问了4次, key2最近5s访问了9次， 删除的就是key1)</span>
volatile-ttl						<span class="token comment"># 挑选将要过期的数据淘汰</span>
volatile-random						<span class="token comment"># 任意选择数据淘汰</span>
allkeys-lru							<span class="token comment"># 挑选最近最少使用的数据淘汰</span>
allkeys-lfu							<span class="token comment"># 挑选最近使用次数最少的数据淘汰</span>
allkeys-random						<span class="token comment"># 任意选择数据淘汰，相当于随机</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><ul><li><strong>LRU</strong>（<strong>L</strong>east <strong>R</strong>ecently <strong>U</strong>sed）最少最近使用。用当前时间减去最后一次访问时间，这个值越大则淘汰优先级越高。</li> <li><strong>LFU</strong>（<strong>L</strong>east <strong>F</strong>requently <strong>U</strong>sed）最少频率使用。会统计每个key的访问频率，值越小淘汰优先级越高。</li> <li><strong>volatile</strong>：表示设置了带过期时间的key</li> <li><strong>allkeys</strong>：表示所有的key</li></ul></blockquote> <p>缓存淘汰策略常见配置项</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>maxmemory-policy noeviction			<span class="token comment"># 配置淘汰策略</span>
maxmemory ?mb						<span class="token comment"># 最大可使用内存，即占用物理内存的比例，默认值为0，表示不限制。生产环境中根据需求设定，通常设置在50%以上。</span>
maxmemory-samples count				<span class="token comment"># 设置redis需要检查key的个数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="使用建议"><a href="#使用建议" class="header-anchor">#</a> 使用建议：</h4> <ol><li>优先使用 allkeys-lru 策略。充分利用 LRU 算法的优势，把最近最常访问的数据留在缓存中。如果业务有明显的冷热数据区分，建议使用。</li> <li>如果业务中数据访问频率差别不大，没有明显冷热数据区分，建议使用 allkeys-random，随机选择淘汰。</li> <li>如果业务中有置顶的需求，可以使用 volatile-lru 策略，同时置顶数据不设置过期时间，这些数据就一直不被删除，会淘汰其他设置过期时间的数据。</li> <li>如果业务中有短时高频访问的数据，可以使用 allkeys-lfu 或 volatile-lfu 策略。</li></ol> <h3 id="_6-3-数据库有1000万数据-redis只能缓存20w数据-如何保证redis中的数据都是热点数据"><a href="#_6-3-数据库有1000万数据-redis只能缓存20w数据-如何保证redis中的数据都是热点数据" class="header-anchor">#</a> 6.3 数据库有1000万数据 ,Redis只能缓存20w数据, 如何保证Redis中的数据都是热点数据 ?</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆</p></blockquote> <p>使用 allkeys-lru （挑选最近最少使用的数据淘汰）淘汰策略，那留下来的都是经常访问的热点数据</p> <h3 id="_6-4-redis的内存用完了会发生什么"><a href="#_6-4-redis的内存用完了会发生什么" class="header-anchor">#</a> 6.4 Redis的内存用完了会发生什么？</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆</p></blockquote> <p>主要看数据淘汰策略是什么？如果是默认的配置，则直接报错</p> <h3 id="_6-5-你们用过redis的事务吗-事务的命令有哪些"><a href="#_6-5-你们用过redis的事务吗-事务的命令有哪些" class="header-anchor">#</a> 6.5 你们用过Redis的事务吗 ? 事务的命令有哪些 ?</h3> <blockquote><p>难易程度：☆☆☆☆</p> <p>出现频率：☆☆</p></blockquote> <p>Redis的事务与传统事务不同。传统事务一般ACID事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</p> <p>Redis中的事务：Redis事务的本质是一组命令的集合。事务支持一次执行多个命令，一个事务中所有命令都会被序列化。在事务执行过程，会按照顺序串行化执行队列中的命令，其他客户端提交的命令请求不会插入到事务执行命令序列中。</p> <p>总结说：Redis事务就是一次性、顺序性、排他性的执行一个队列中的一系列命令。Reids中，单条命令式原子性执行的，但事务不保证原子性，且没有回滚。</p> <p>事务相关的命令：</p> <p>1、MULTI：用来组装一个事务</p> <p>2、EXEC：执行一个事物</p> <p>3、DISCARD：取消一个事务</p> <p>4、WATCH：用来监视一些key，一旦这些key在事务执行之前被改变，则取消事务的执行</p> <p>5、UNWATCH：取消 WATCH 命令对所有key的监视</p> <p>如下所示：</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20220225132328333.png" alt="image-20220225132328333"></p> <h3 id="_6-6-redis是单线程的-但是为什么还那么快"><a href="#_6-6-redis是单线程的-但是为什么还那么快" class="header-anchor">#</a> 6.6 Redis是单线程的，但是为什么还那么快？</h3> <blockquote><p>难易程度：☆☆☆</p> <p>出现频率：☆☆☆☆</p></blockquote> <p>Redis总体快的原因：</p> <p>1、完全基于内存的，C语言编写</p> <p>2、采用单线程，避免不必要的上下文切换可竞争条件</p> <p>3、数据简单，数据操作也相对简单</p> <p>4、使用多路I/O复用模型，非阻塞IO</p> <p>​	bgsave  在<strong>后台</strong>执行rdb的保存，不影响主线程的正常使用，不会产生阻塞</p> <p>​	bgrewriteaof  在<strong>后台</strong>执行aof文件的保存，不影响主线程的正常使用，不会产生阻塞</p> <h2 id="_7-面试现场"><a href="#_7-面试现场" class="header-anchor">#</a> 7 面试现场</h2> <h3 id="_7-1-数据类型"><a href="#_7-1-数据类型" class="header-anchor">#</a> 7.1 数据类型</h3> <blockquote><p><strong>面试官</strong>：Redis的常用数据类型有哪些 ?</p> <p><strong>候选人</strong>：</p> <p>嗯，这个有很多，不过我们开发比较常见的有5种，分别是：</p> <p>Redis是典型的“键值型”数据库，不同数据类型其key结构一致，value有所差异。常见的类型有：string、hash、list、set、SortedSet等。</p> <p>当然基于以上5种基本数据类型，Redis又拓展了几种拓展类型，例如：BitMap、HyperLogLog、Geo等。</p> <p>---------------增强回答--------------------------</p> <ul><li>String类型是Redis中最常见的数据类型，value与key一样都是Redis自定义的字符串结构，称为SDS。不过在保存数字、小字符串时因为采用INT和EMBSTR编码，内存结构紧凑，只需要申请一次内存分配，效率更高，更节省内存。</li></ul> <p>而超过44字节的大字符串时则需要采用RAW编码，申请额外的SDS空间，需要两次内存分配，效率较低，内存占用也较高，但最大不超过512mb，因此建议单个value尽量不要超过44字节。</p> <p>String类型常用来做计数器、简单数据存储等。复杂数据建议采用其它数据结构。</p> <ul><li>Hash结构，其value与Java中的HashMap类似，有是一个key-value结构。如果有一个对象需要被Redis缓存，而且将来可能有部分修改。建议用hash结构来存储这个对象的每一个字段和字段值。而不是作为一个JSON字符串存储到String类型中。因为Hash结构的每一个字段都可以单独做修改，而String的JSON串必须整体覆盖。</li></ul> <p>与Java中的hashMap不同的是，Redis中的Hash底层采用了渐进式rehash的算法，在做rehash时会创建一个新的hashtable，每次操作元素时移动一部分数据，只到所有数据迁移完成，再用新的HashTable来代替旧的，避免了因为rehash导致的阻塞，因此性能更高。</p> <ul><li>List结构的value类型可以看做是一个双端链表，提供了一些命令便于我们从首尾操作元素。为了节省内存空间，底层采用了ZipList（压缩列表）来做基础存储。当压缩列表数据达到阈值（512）则会创建新的压缩列表。每个压缩列表作为一个双端链表的一个节点，最终形成一个QuickList结构。而且QuickList结构与一般的双端链表不同，他可以对中间不常用的ZipList节点做压缩以节省内存。</li></ul> <p>List结构常用来模拟队列，实现任务排队这样的功能。</p> <ul><li><p>Set结构的value与Java的Set类似，元素不可重复。Redis提供了求交集、并集等命令，可以帮助我们实现例如：好友列表、共同好友等功能。
当存储元素是整数时，其底层默认采用IntSet结构，可以看做是一个有序的数组，结构紧凑，效率较高。而元素如果不是整数，或者元素量超过512这个阈值时则会转为hash表结构，内存占用会有大的增加。因此我们在使用Set结构时尽量采用数组存储，例如数值类型的id。而且元素数量尽量不要超过512，避免出现BigKey。</p></li> <li><p>SortedSet，也叫ZSet。其value就是一个有序的Set集合，元素唯一，并且会按照一个指定的score值排序。因此常用来做排行榜功能。</p></li></ul> <p>SortedSet底层的利用Hash表保证元素的唯一性。利用跳表（SkipList）来保证元素的有序性，因此数据会有重复存储，内存占用较高，是一种典型的以空间换时间的设计。不建议在SortedSet中放入过多数据。</p> <p><strong>面试官</strong>：跳表你了解吗？</p> <p><strong>候选人</strong>：</p> <p>嗯，这个知道一些~~</p> <p>Redis数据类型Sorted Set使用了跳表作为其中一种数据结构，跳表结合了链表和二分查找的思想</p> <p>它的底层是一个有序的双向列表，但不同于其他双向列表的是，它有多个指针，指针的跨度也不同，查找时从顶层向下，不断缩小范围。效率相对比较高，它的时间复杂度为 O ( log ⁡ n ) 。</p></blockquote> <h3 id="_7-2-持久化"><a href="#_7-2-持久化" class="header-anchor">#</a> 7.2 持久化</h3> <blockquote><p><strong>面试官</strong>：Redis的数据持久化策略有哪些 ?</p> <p><strong>候选人</strong>：</p> <p>嗯~~，在Redis中提供了两种数据持久化的方式：1、RDB	2、AOF</p> <p><strong>RDB：</strong></p> <p>定期更新，定期将Redis中的数据生成的快照同步到磁盘等介质上，磁盘上保存的就是Redis的内存快照</p> <p>优点：数据文件的大小相比于aof较小，使用rdb进行数据恢复速度较快</p> <p>缺点：比较耗时，存在丢失数据的风险</p> <p><strong>AOF：</strong></p> <p>将Redis所执行过的所有指令都记录下来，在下次Redis重启时，只需要执行指令就可以了</p> <p>优点：数据丢失的风险大大降低了</p> <p>缺点：数据文件的大小相比于rdb较大，使用aop文件进行数据恢复的时候速度较慢</p> <p><strong>面试官</strong>：好的，那在你们的项目中采用了哪种持久化策略？</p> <p><strong>候选人</strong>：</p> <p>嗯，是这样，我们项目中为了能够预防更少的数据丢失，两种方式都用了，RDB+AOF</p></blockquote> <h3 id="_7-3-主从和集群"><a href="#_7-3-主从和集群" class="header-anchor">#</a> 7.3 主从和集群</h3> <blockquote><p><strong>面试官</strong>：Redis集群有哪些方案, 知道嘛 ?</p> <p><strong>候选人</strong>：</p> <p>嗯~~，在Redis中提供的集群方案总共有三种：主从复制、哨兵模式、Redis分片集群</p> <p>1、主从复制</p> <ul><li>保证高可用性</li> <li>实现故障转移需要手动实现</li> <li>无法实现海量数据存储</li></ul> <p>2、哨兵模式</p> <ul><li>保证高可用性</li> <li>可以实现自动化的故障转移</li> <li>无法实现海量数据存储</li></ul> <p>3、Redis分片集群</p> <ul><li>保证高可用性</li> <li>可以实现自动化的故障转移</li> <li>可以实现海量数据存储</li></ul> <p><strong>面试官</strong>：什么是 Redis 主从同步？</p> <p><strong>候选人</strong>：</p> <p>这个主要指的是redis的主节点向从节点同步数据的过程。一共分为了两个阶段</p> <p>第一阶段，全量同步流程
1.从节点执行replicaof命令，发送自己的replid和offset给主节点
2.主节点判断从节点的replid与自己的是否一致，
3.如果不一致说明是第一次来，需要做全量同步，主节点返回自己的replid给从节点
4.主节点开始执行bgsave，生成rdb文件
5.主节点发送rdb文件给从节点，再发送的过程中
6.从节点接收rdb文件，清空本地数据，加载rdb文件中的数据
7.同步过程中，主节点接收到的新命令写入从节点的写缓冲区(repl_buffer)
8.从节点接收到缓冲区数据后写入本地，并记录最新数据对应的offset
9.后期采用增量同步</p> <p>第二阶段，增量同步数据</p> <p>1.主节点会不断把自己接收到的命令记录在repl_baklog中，并修改offset
2.从节点向主节点发送psync命令，发送自己的offset和replid
3.主节点判断replid和offset与从节点是否一致
4.如果replid一致，说明是增量同步。然后判断offset是否一致
5.如果从节点offset小于主节点offset，并且在repl_baklog中能找到对应数据
则将offset之间相差的数据发送给从节点
6.从节点接收到数据后写入本地，修改自己的offset与主节点一致</p> <p>当然repl_baklog的大小是有上限的，我们也可以通过配置修改大小</p> <p><strong>面试官</strong>：你们使用Redis是单点还是集群 ? 哪种集群 ?(说说你们生产环境redis部署情况？)</p> <p><strong>候选人</strong>：</p> <p>嗯~~，是这样的，因为我们项目使用缓存的业务量不是超级大，所以采用了哨兵模式，机器一共有5台，主从2台（1主1从），哨兵3台。</p> <p><strong>面试官</strong>：你感觉集群模式有什么问题吗？</p> <p><strong>候选人</strong>：</p> <p>嗯~~~，集群模式是可以解决大数据量的存储，但也存在一些问题，比如</p> <ul><li>维护起来比较麻烦</li> <li>集群之间的心跳检测和数据通信会消耗大量的网络带宽</li> <li>集群插槽分配不均和key的分批容易导致数据倾斜</li> <li>客户端的route会有性能损耗</li> <li>集群模式下无法使用lua脚本、事务</li></ul> <p><strong>面试官</strong>：Redis分片集群中数据是怎么存储和读取的 ?</p> <p><strong>候选人</strong>：</p> <p>嗯~，在redis集群中是这样的</p> <p>Redis 集群引入了哈希槽的概念，有 16384 个哈希槽，集群中每个主节点绑定了一定范围的哈希槽范围， key通过 CRC16 校验后对 16384 取模来决定放置哪个槽，通过槽找到对应的节点进行存储。</p> <p>取值的逻辑是一样的</p> <p><strong>面试官</strong>：redis集群脑裂?</p> <p><strong>候选人</strong>：</p> <p>嗯！ 这个在项目很少见，原因是这样的，我们现在用的是redis的哨兵模式集群的</p> <p>有的时候由于网络等原因可能会出现脑裂的情况，就是说，由于redis master节点和redis salve节点和sentinel处于不同的网络分区，使得sentinel没有能够心跳感知到master，所以通过选举的方式提升了一个salve为master，这样就存在了两个master，就像大脑分裂了一样，这样会导致客户端还在old master那里写入数据，新节点无法同步数据，当网络恢复后，sentinel会将old master降为salve，这时再从新master同步数据，这会导致old master中的大量数据丢失。</p> <p>关于解决的话，我记得在redis的配置中可以设置</p> <p>第一可以设置最少的salve节点个数，</p> <p>第二可以设置数据复制和同步的延迟时间</p> <p><strong>面试官</strong>：怎么保证redis的高并发高可用</p> <p><strong>候选人</strong>：</p> <p>参考回答一：</p> <p>嗯，由于我们的存入redis的业务量是有限的，为了能够承受突发的高并发请求，我们公司采用的主从架构和哨兵模式</p> <p>参考回答二：</p> <p>嗯，由于我们的存入redis的业务量很大，为了能够承受住高并发请求，我们公司采用的集群模式</p></blockquote> <h3 id="_7-4使用场景"><a href="#_7-4使用场景" class="header-anchor">#</a> 7.4使用场景</h3> <blockquote><p><strong>面试官</strong>：项目中哪块使用了缓存？</p> <p><strong>本文作者</strong>：结合自己简历上写的项目模块说明这个问题，要陈述出当时的场景</p> <p><strong>候选人</strong>：</p> <p>嗯，有很多的~~</p> <p>我负责的黑马头条项目（你不能写），在app端的用户的行为数据我们是存储到了缓存中的，就是redis。</p> <p>还有就是在自媒体端，自媒体人发布文章的时候可以设置一个未来时间定时发布文章，我们采用的redis的zset作为延迟队列用的。</p> <p>还有一块是，在app端的热点文章，因为这块内容相对请求数量比较多，我们会把一些热点数据缓存到redis。减轻一大部分访问的压力。</p> <p>我们的很多的定时任务，都是晚上自动跑，但是我们的服务都是集群，为了防止每个集群都执行这个定时任务，我们当时使用了redis实现的分布式来限制的（setnx）</p> <p>立可得项目使用场景：</p> <ul><li>工单排行榜</li> <li>下单（分布式锁）</li></ul> <p><strong>面试官</strong>：什么是缓存穿透 ? 怎么解决 ?</p> <p><strong>候选人</strong>：</p> <p>嗯~~，我想一下</p> <p>缓存穿透是指查询一个一定<strong>不存在</strong>的数据，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到 DB 去查询，可能导致 DB 挂掉。这种情况大概率是遭到了攻击。</p> <p>解决方案的话，我们通常都会用布隆过滤器来解决它</p> <p><strong>面试官</strong>：好的，你能介绍一下布隆过滤器吗？</p> <p><strong>候选人</strong>：</p> <p>嗯，是这样~</p> <p>布隆过滤器主要是用于检索一个元素是否在一个集合中。我们当时使用的是redisson实现的布隆过滤器。</p> <p>它的底层主要是先去初始化一个比较大数组，里面存放的二进制0或1。在一开始都是0，当一个key来了之后经过3次hash计算，模于数组长度找到数据的下标然后把数组中原来的0改为1，这样的话，三个数组的位置就能标明一个key的存在。查找的过程也是一样的。</p> <p>当然是有缺点的，布隆过滤器有可能会产生一定的误判，我们一般可以设置这个误判率，大概不会超过5%，其实这个误判是必然存在的，要不就得增加数组的长度，其实已经算是很划分了，5%以内的误判率一般的项目也能接受，不至于高并发下压倒数据库。</p> <p><strong>面试官</strong>：什么是缓存击穿 ? 怎么解决 ?</p> <p><strong>候选人</strong>：</p> <p>嗯！！</p> <p>缓存击穿的意思是对于设置了过期时间的key，缓存在某个时间点过期的时候，恰好这时间点对这个Key有大量的并发请求过来，这些请求发现缓存过期一般都会从后端 DB 加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把 DB 压垮。</p> <p>解决方案有两种方式：</p> <p>第一可以使用互斥锁：当缓存失效时，不立即去load db，先使用如 Redis 的 setnx 去设置一个互斥锁，当操作成功返回时再进行 load db的操作并回设缓存，否则重试get缓存的方法</p> <p>第二种方案可以设置当前key逻辑过期，大概是思路如下：</p> <p>①：在设置key的时候，设置一个过期时间字段一块存入缓存中，不给当前key设置过期时间</p> <p>②：当查询的时候，从redis取出数据后判断时间是否过期</p> <p>③：如果过期则开通另外一个线程进行数据同步，当前线程正常返回数据，这个数据不是最新</p> <p>当然两种方案各有利弊：</p> <p>如果选择数据的强一致性，建议使用分布式锁的方案，性能上可能没那么高，锁需要等，也有可能产生死锁的问题</p> <p>如果选择key的逻辑删除，则优先考虑的高可用性，性能比较高，但是数据同步这块做不到强一致。</p> <p><strong>面试官</strong>：什么是缓存雪崩 ? 怎么解决 ?</p> <p><strong>候选人</strong>：</p> <p>嗯！！</p> <p>缓存雪崩意思是设置缓存时采用了相同的过期时间，导致缓存在某一时刻同时失效，请求全部转发到DB，DB 瞬时压力过重雪崩。与缓存击穿的区别：雪崩是很多key，击穿是某一个key缓存。</p> <p>解决方案主要是可以将缓存失效时间分散开，比如可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。</p> <p><strong>面试官</strong>：redis双写问题?</p> <p><strong>候选人</strong>：</p> <p>嗯！我们当时采用的阿里巴巴旗下的canal组件实现数据同步：不需要更改业务代码，部署一个canal服务。canal服务把自己伪装成mysql的一个从节点，当mysql数据更新以后，canal会读取binlog数据，然后在通过canal的客户端获取到数据，更新缓存即可。</p></blockquote> <h3 id="_7-5-redis分布式锁"><a href="#_7-5-redis分布式锁" class="header-anchor">#</a> 7.5 Redis分布式锁</h3> <blockquote><p><strong>面试官</strong>：Redis分布式锁如何实现 ?</p> <p><strong>候选人</strong>：</p> <p>嗯，在redis中提供了一个命令setnx(SET if not exists)</p> <p>由于redis的单线程的，用了命令之后，只能有一个客户端对某一个key设置值，在没有过期或删除key的时候是其他客户端是不能设置这个key的</p> <p><strong>面试官</strong>：好的，那你如何控制Redis实现分布式锁有效时长呢？</p> <p><strong>候选人</strong>：</p> <p>嗯，的确，redis的setnx指令不好控制这个问题，我们当时采用的redis的一个框架redisson实现的。</p> <p>在redisson中需要手动加锁，并且可以控制锁的失效时间和等待时间，当锁住的一个业务还没有执行完成的时候，在redisson中引入了一个看门狗机制，就是说每隔一段时间就检查当前业务是否还持有锁，如果持有就增加加锁的持有时间，当业务执行完成之后需要使用释放锁就可以了</p> <p>还有一个好处就是，在高并发下，一个业务有可能会执行很快，先客户1持有锁的时候，客户2来了以后并不会马上拒绝，它会自选不断尝试获取锁，如果客户1释放之后，客户2就可以马上持有锁，性能也得到了提升。</p> <p><strong>面试官</strong>：好的，redisson实现的分布式锁是可重入的吗？</p> <p><strong>候选人</strong>：</p> <p>嗯，是可以重入的。这样做是为了避免死锁的产生。这个重入其实在内部就是判断是否是当前线程持有的锁，如果是当前线程持有的锁就会计数，如果释放锁就会在计算上减一。</p> <p><strong>面试官</strong>：你的项目中哪里用到了分布式锁 ？</p> <p><strong>候选人</strong>：</p> <p><strong>本文作者</strong>：这个也要根据自己简历上的项目进行描述</p> <p>常见的业务：集群情况下定时任务（分布式锁）、秒杀、幂等性场景</p></blockquote> <h3 id="_7-6-其他"><a href="#_7-6-其他" class="header-anchor">#</a> 7.6 其他</h3> <blockquote><p><strong>面试官</strong>：Redis的数据过期策略有哪些 ?</p> <p><strong>候选人</strong>：</p> <p>嗯~，在redis中提供了两种数据过期删除策略</p> <p>第一种是惰性删除，在设置该key过期时间后，我们不去管它，当需要该key时，我们在检查其是否过期，如果过期，我们就删掉它，反之返回该key。</p> <p>第二种是 定期删除，就是说每隔一段时间，我们就对一些key进行检查，删除里面过期的key</p> <p>定期清理的两种模式：</p> <ul><li>SLOW模式是定时任务，执行频率默认为10hz，每次不超过25ms，以通过修改配置文件redis.conf 的 <strong>hz</strong> 选项来调整这个次数</li> <li>FAST模式执行频率不固定，每次事件循环会尝试执行，但两次间隔不低于2ms，每次耗时不超过1ms</li></ul> <p>Redis的过期删除策略：<strong>惰性删除 + 定期删除</strong>两种策略进行配合使用定期删除函数的运行频率。</p> <p><strong>面试官</strong>：Redis的数据淘汰策略有哪些 ?</p> <p><strong>候选人</strong>：</p> <p>嗯，这个在redis中提供了很多种，默认是noeviction，不上任何数据，内部不足直接报错</p> <p>当然在线上的redis都会进行设置数据淘汰策略：比较常见是</p> <p>对有所key的操作有三个：</p> <ul><li><p>allkeys-lru 挑选最近最少使用的数据淘汰</p></li> <li><p>allkeys-lfu 挑选最近使用次数最少的数据淘汰</p></li> <li><p>allkeys-random 随机选择数据淘汰</p></li></ul> <p>对设置了过期key的操作有四个：</p> <ul><li><p>volatile-lru  挑选最近最久使用的数据淘汰</p></li> <li><p>volatile-lfu 挑选最近最少使用数据淘汰</p></li> <li><p>volatile-ttl  挑选将要过期的数据淘汰</p></li> <li><p>volatile-random 任意选择数据淘汰</p></li></ul> <p>我们在项目通常设置的allkeys-lru，挑选最近最少使用的数据淘汰，把一些经常访问的key留在redis中</p> <p><strong>面试官</strong>：数据库有1000万数据 ,Redis只能缓存20w数据, 如何保证Redis中的数据都是热点数据 ?</p> <p><strong>候选人</strong>：</p> <p>嗯，我想一下~~</p> <p>可以使用 allkeys-lru （挑选最近最少使用的数据淘汰）淘汰策略，那留下来的都是经常访问的热点数据</p> <p><strong>面试官</strong>：Redis的内存用完了会发生什么？</p> <p><strong>候选人</strong>：</p> <p>嗯~，这个要看redis的数据淘汰策略是什么，如果是默认的配置，redis内存用完以后则直接报错。我们当时设置的 allkeys-lru 策略。把最近最常访问的数据留在缓存中。</p> <p><strong>面试官</strong>：你们用过Redis的事务吗 ? 事务的命令有哪些 ?</p> <p><strong>候选人</strong>：</p> <p>嗯，这个没在项目中用过，不过我知道一些。</p> <p>Redis的事务与传统事务不同。传统事务一般ACID事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行</p> <p>Redis事务的本质是一组命令的集合。事务支持一次执行多个命令，一个事务中所有命令都会被序列化。在事务执行过程，会按照顺序串行化执行队列中的命令，其他客户端提交的命令请求不会插入到事务执行命令序列中。单条命令式原子性执行的，但事务不保证原子性，且没有回滚。</p> <p>关于事务的命令有：</p> <p>1、MULTI：用来组装一个事务</p> <p>2、EXEC：执行一个事物</p> <p>3、DISCARD：取消一个事务</p> <p>4、WATCH：用来监视一些key，一旦这些key在事务执行之前被改变，则取消事务的执行</p> <p>5、UNWATCH：取消 WATCH 命令对所有key的监视</p> <p><strong>面试官</strong>：Redis是单线程的，但是为什么还那么快？</p> <p><strong>候选人</strong>：</p> <p>嗯，这个有几个原因吧~~~</p> <p>1、完全基于内存的，C语言编写</p> <p>2、采用单线程，避免不必要的上下文切换可竞争条件</p> <p>3、使用多路I/O复用模型，非阻塞IO</p> <p>例如：bgsave 和 bgrewriteaof  都是在<strong>后台</strong>执行操作，不影响主线程的正常使用，不会产生阻塞</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2023/10/29</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Java面试题/Redis面试题/Redis面试题.html" class="prev">
        Redis面试题
      </a></span> <span class="next"><a href="/Java面试题/Redis面试题/Redis复习.html">
        Redis复习
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a19eb3cb.js" defer></script><script src="/assets/js/2.34fff606.js" defer></script><script src="/assets/js/1.16393a26.js" defer></script><script src="/assets/js/59.371bd0d7.js" defer></script>
  </body>
</html>
