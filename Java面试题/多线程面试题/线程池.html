<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>线程池 | 周岐的个人博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="logo.jpg">
    <meta name="description" content="个人技术博客">
    
    <link rel="preload" href="/assets/css/0.styles.8c53e149.css" as="style"><link rel="preload" href="/assets/js/app.a19eb3cb.js" as="script"><link rel="preload" href="/assets/js/2.34fff606.js" as="script"><link rel="preload" href="/assets/js/1.16393a26.js" as="script"><link rel="preload" href="/assets/js/66.67703170.js" as="script"><link rel="prefetch" href="/assets/js/10.717bd423.js"><link rel="prefetch" href="/assets/js/100.c5cd47b0.js"><link rel="prefetch" href="/assets/js/101.7151b423.js"><link rel="prefetch" href="/assets/js/102.6b36385a.js"><link rel="prefetch" href="/assets/js/103.d3861779.js"><link rel="prefetch" href="/assets/js/104.9578b311.js"><link rel="prefetch" href="/assets/js/105.aae477dc.js"><link rel="prefetch" href="/assets/js/106.1d5215a7.js"><link rel="prefetch" href="/assets/js/107.3c330c2f.js"><link rel="prefetch" href="/assets/js/108.cefc2802.js"><link rel="prefetch" href="/assets/js/109.541aa22e.js"><link rel="prefetch" href="/assets/js/11.e0bfb9a4.js"><link rel="prefetch" href="/assets/js/110.60e0b929.js"><link rel="prefetch" href="/assets/js/111.45058523.js"><link rel="prefetch" href="/assets/js/112.d10d50d0.js"><link rel="prefetch" href="/assets/js/113.4a3deb35.js"><link rel="prefetch" href="/assets/js/114.b917d1a1.js"><link rel="prefetch" href="/assets/js/115.50e3fa0f.js"><link rel="prefetch" href="/assets/js/116.78f04bf7.js"><link rel="prefetch" href="/assets/js/117.b5372645.js"><link rel="prefetch" href="/assets/js/118.f990eb5b.js"><link rel="prefetch" href="/assets/js/119.f178eabd.js"><link rel="prefetch" href="/assets/js/12.bdf46c02.js"><link rel="prefetch" href="/assets/js/120.d98a3aa8.js"><link rel="prefetch" href="/assets/js/121.abcdf60f.js"><link rel="prefetch" href="/assets/js/122.ed3550a9.js"><link rel="prefetch" href="/assets/js/123.8ef421f8.js"><link rel="prefetch" href="/assets/js/124.1adba2c7.js"><link rel="prefetch" href="/assets/js/125.6706c196.js"><link rel="prefetch" href="/assets/js/126.1e50c7b4.js"><link rel="prefetch" href="/assets/js/127.be9df6e0.js"><link rel="prefetch" href="/assets/js/128.9e68fe60.js"><link rel="prefetch" href="/assets/js/129.f9313e6a.js"><link rel="prefetch" href="/assets/js/13.05b00624.js"><link rel="prefetch" href="/assets/js/130.87d4d918.js"><link rel="prefetch" href="/assets/js/131.b7ab0bc3.js"><link rel="prefetch" href="/assets/js/132.4bf1103a.js"><link rel="prefetch" href="/assets/js/133.2bda9aa2.js"><link rel="prefetch" href="/assets/js/134.e6631028.js"><link rel="prefetch" href="/assets/js/135.5b78aed3.js"><link rel="prefetch" href="/assets/js/136.377fd687.js"><link rel="prefetch" href="/assets/js/137.623e1a9d.js"><link rel="prefetch" href="/assets/js/138.c2e1c9a1.js"><link rel="prefetch" href="/assets/js/139.6263f657.js"><link rel="prefetch" href="/assets/js/14.092a5584.js"><link rel="prefetch" href="/assets/js/140.a54c064d.js"><link rel="prefetch" href="/assets/js/141.0de2ed45.js"><link rel="prefetch" href="/assets/js/142.61ea0663.js"><link rel="prefetch" href="/assets/js/143.24d35022.js"><link rel="prefetch" href="/assets/js/144.196d7653.js"><link rel="prefetch" href="/assets/js/145.223f0fcf.js"><link rel="prefetch" href="/assets/js/146.a09f8d1b.js"><link rel="prefetch" href="/assets/js/147.62d69c7c.js"><link rel="prefetch" href="/assets/js/148.d46a05d0.js"><link rel="prefetch" href="/assets/js/149.467faf3d.js"><link rel="prefetch" href="/assets/js/15.758ee11b.js"><link rel="prefetch" href="/assets/js/150.0443932e.js"><link rel="prefetch" href="/assets/js/151.0879c074.js"><link rel="prefetch" href="/assets/js/152.4d08f8a9.js"><link rel="prefetch" href="/assets/js/153.ce46c4fa.js"><link rel="prefetch" href="/assets/js/154.fd65dd72.js"><link rel="prefetch" href="/assets/js/155.b975728f.js"><link rel="prefetch" href="/assets/js/156.61194924.js"><link rel="prefetch" href="/assets/js/157.97e4f54e.js"><link rel="prefetch" href="/assets/js/158.5290a2f0.js"><link rel="prefetch" href="/assets/js/159.3613e64b.js"><link rel="prefetch" href="/assets/js/16.2569be64.js"><link rel="prefetch" href="/assets/js/160.87d90e6b.js"><link rel="prefetch" href="/assets/js/161.a2a67f25.js"><link rel="prefetch" href="/assets/js/162.b51ccce1.js"><link rel="prefetch" href="/assets/js/163.85d33d23.js"><link rel="prefetch" href="/assets/js/164.5504b77f.js"><link rel="prefetch" href="/assets/js/165.be283131.js"><link rel="prefetch" href="/assets/js/166.8d0352c5.js"><link rel="prefetch" href="/assets/js/167.89c23a71.js"><link rel="prefetch" href="/assets/js/168.aa736b2c.js"><link rel="prefetch" href="/assets/js/169.296ccc1d.js"><link rel="prefetch" href="/assets/js/17.5b873df7.js"><link rel="prefetch" href="/assets/js/170.c706da49.js"><link rel="prefetch" href="/assets/js/171.6f79aeb1.js"><link rel="prefetch" href="/assets/js/172.ddcae302.js"><link rel="prefetch" href="/assets/js/173.f308eb43.js"><link rel="prefetch" href="/assets/js/174.b5ece966.js"><link rel="prefetch" href="/assets/js/175.538e3125.js"><link rel="prefetch" href="/assets/js/176.d54091dd.js"><link rel="prefetch" href="/assets/js/177.2ee0aa3d.js"><link rel="prefetch" href="/assets/js/178.667b3c59.js"><link rel="prefetch" href="/assets/js/179.07595c3e.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/180.300e0b70.js"><link rel="prefetch" href="/assets/js/181.89473dcd.js"><link rel="prefetch" href="/assets/js/182.ea6036d1.js"><link rel="prefetch" href="/assets/js/183.647f8d55.js"><link rel="prefetch" href="/assets/js/184.2e79dd55.js"><link rel="prefetch" href="/assets/js/185.bf4d6269.js"><link rel="prefetch" href="/assets/js/186.7a7ceaa7.js"><link rel="prefetch" href="/assets/js/187.09bb0f21.js"><link rel="prefetch" href="/assets/js/188.3604ce73.js"><link rel="prefetch" href="/assets/js/189.49b47b33.js"><link rel="prefetch" href="/assets/js/19.a45744ea.js"><link rel="prefetch" href="/assets/js/190.88e59ff4.js"><link rel="prefetch" href="/assets/js/191.a4b3e5c7.js"><link rel="prefetch" href="/assets/js/192.7527e6ed.js"><link rel="prefetch" href="/assets/js/193.c44a652d.js"><link rel="prefetch" href="/assets/js/194.6aaca2ce.js"><link rel="prefetch" href="/assets/js/195.64837df2.js"><link rel="prefetch" href="/assets/js/196.e1bd3d69.js"><link rel="prefetch" href="/assets/js/197.2b01de81.js"><link rel="prefetch" href="/assets/js/198.d1496fd2.js"><link rel="prefetch" href="/assets/js/199.27ab1442.js"><link rel="prefetch" href="/assets/js/20.4cb27e25.js"><link rel="prefetch" href="/assets/js/200.996d49f4.js"><link rel="prefetch" href="/assets/js/201.b71a4422.js"><link rel="prefetch" href="/assets/js/202.0ea49eaa.js"><link rel="prefetch" href="/assets/js/203.8ebb1f77.js"><link rel="prefetch" href="/assets/js/204.c8d10533.js"><link rel="prefetch" href="/assets/js/205.0b8c4d0d.js"><link rel="prefetch" href="/assets/js/206.cce9bcce.js"><link rel="prefetch" href="/assets/js/207.8130e9ba.js"><link rel="prefetch" href="/assets/js/208.871753be.js"><link rel="prefetch" href="/assets/js/209.757eda19.js"><link rel="prefetch" href="/assets/js/21.445690e6.js"><link rel="prefetch" href="/assets/js/210.983cae1d.js"><link rel="prefetch" href="/assets/js/211.8e4ddaf8.js"><link rel="prefetch" href="/assets/js/212.6412fc61.js"><link rel="prefetch" href="/assets/js/213.656a6a73.js"><link rel="prefetch" href="/assets/js/214.befcd199.js"><link rel="prefetch" href="/assets/js/215.2c292e81.js"><link rel="prefetch" href="/assets/js/216.78cc7e8b.js"><link rel="prefetch" href="/assets/js/217.4fa8b1da.js"><link rel="prefetch" href="/assets/js/218.4c8cce7c.js"><link rel="prefetch" href="/assets/js/219.d041d013.js"><link rel="prefetch" href="/assets/js/22.bc7c4cdb.js"><link rel="prefetch" href="/assets/js/220.10a9ed88.js"><link rel="prefetch" href="/assets/js/221.bc25f391.js"><link rel="prefetch" href="/assets/js/222.dfdd15b7.js"><link rel="prefetch" href="/assets/js/223.1afa90d8.js"><link rel="prefetch" href="/assets/js/224.69bb037f.js"><link rel="prefetch" href="/assets/js/225.94590311.js"><link rel="prefetch" href="/assets/js/226.d1818961.js"><link rel="prefetch" href="/assets/js/227.2a969459.js"><link rel="prefetch" href="/assets/js/228.e3f5706b.js"><link rel="prefetch" href="/assets/js/229.0e6df830.js"><link rel="prefetch" href="/assets/js/23.b7994ecf.js"><link rel="prefetch" href="/assets/js/230.6bc93aa6.js"><link rel="prefetch" href="/assets/js/231.9b7cc0ec.js"><link rel="prefetch" href="/assets/js/232.80b7488d.js"><link rel="prefetch" href="/assets/js/233.302790de.js"><link rel="prefetch" href="/assets/js/234.68b70723.js"><link rel="prefetch" href="/assets/js/235.1b3c3110.js"><link rel="prefetch" href="/assets/js/236.e536b7bb.js"><link rel="prefetch" href="/assets/js/237.cca351a3.js"><link rel="prefetch" href="/assets/js/238.f4d0edb0.js"><link rel="prefetch" href="/assets/js/239.4f57e73d.js"><link rel="prefetch" href="/assets/js/24.26e26a07.js"><link rel="prefetch" href="/assets/js/240.1e76f670.js"><link rel="prefetch" href="/assets/js/241.8795d427.js"><link rel="prefetch" href="/assets/js/242.c72205cb.js"><link rel="prefetch" href="/assets/js/243.d7105431.js"><link rel="prefetch" href="/assets/js/244.361b2ea5.js"><link rel="prefetch" href="/assets/js/245.055fa0a3.js"><link rel="prefetch" href="/assets/js/246.0dee7b05.js"><link rel="prefetch" href="/assets/js/247.c13fc7d7.js"><link rel="prefetch" href="/assets/js/248.4e481dba.js"><link rel="prefetch" href="/assets/js/25.626c2c33.js"><link rel="prefetch" href="/assets/js/26.c4aa6beb.js"><link rel="prefetch" href="/assets/js/27.b1a828b7.js"><link rel="prefetch" href="/assets/js/28.f9133ade.js"><link rel="prefetch" href="/assets/js/29.54e09df1.js"><link rel="prefetch" href="/assets/js/3.4db2e19a.js"><link rel="prefetch" href="/assets/js/30.d2654359.js"><link rel="prefetch" href="/assets/js/31.c57cf20e.js"><link rel="prefetch" href="/assets/js/32.ed5593a9.js"><link rel="prefetch" href="/assets/js/33.05f050d1.js"><link rel="prefetch" href="/assets/js/34.6d7f5b2f.js"><link rel="prefetch" href="/assets/js/35.67cc577c.js"><link rel="prefetch" href="/assets/js/36.0bbc204a.js"><link rel="prefetch" href="/assets/js/37.8ac35368.js"><link rel="prefetch" href="/assets/js/38.50bd8dba.js"><link rel="prefetch" href="/assets/js/39.38b783ce.js"><link rel="prefetch" href="/assets/js/4.66c035fd.js"><link rel="prefetch" href="/assets/js/40.cd3ee2ff.js"><link rel="prefetch" href="/assets/js/41.f4bec9a4.js"><link rel="prefetch" href="/assets/js/42.27fa7fec.js"><link rel="prefetch" href="/assets/js/43.2af4a015.js"><link rel="prefetch" href="/assets/js/44.8e48aaf4.js"><link rel="prefetch" href="/assets/js/45.d41c0319.js"><link rel="prefetch" href="/assets/js/46.de5cb880.js"><link rel="prefetch" href="/assets/js/47.cc7c8048.js"><link rel="prefetch" href="/assets/js/48.22c69558.js"><link rel="prefetch" href="/assets/js/49.cdd62276.js"><link rel="prefetch" href="/assets/js/5.632744e8.js"><link rel="prefetch" href="/assets/js/50.a7eebe42.js"><link rel="prefetch" href="/assets/js/51.a447aa90.js"><link rel="prefetch" href="/assets/js/52.c0f076a5.js"><link rel="prefetch" href="/assets/js/53.3564c5b0.js"><link rel="prefetch" href="/assets/js/54.c5c6e6be.js"><link rel="prefetch" href="/assets/js/55.0fcb916b.js"><link rel="prefetch" href="/assets/js/56.2812bd7d.js"><link rel="prefetch" href="/assets/js/57.4f95d22a.js"><link rel="prefetch" href="/assets/js/58.d9baba05.js"><link rel="prefetch" href="/assets/js/59.371bd0d7.js"><link rel="prefetch" href="/assets/js/6.85f26be6.js"><link rel="prefetch" href="/assets/js/60.a715876a.js"><link rel="prefetch" href="/assets/js/61.6b1a782b.js"><link rel="prefetch" href="/assets/js/62.11484b5e.js"><link rel="prefetch" href="/assets/js/63.7b92573e.js"><link rel="prefetch" href="/assets/js/64.98aee69e.js"><link rel="prefetch" href="/assets/js/65.aa40eacd.js"><link rel="prefetch" href="/assets/js/67.392b86af.js"><link rel="prefetch" href="/assets/js/68.9610b8e9.js"><link rel="prefetch" href="/assets/js/69.6277fc7a.js"><link rel="prefetch" href="/assets/js/7.b775b056.js"><link rel="prefetch" href="/assets/js/70.b47adb04.js"><link rel="prefetch" href="/assets/js/71.0051199b.js"><link rel="prefetch" href="/assets/js/72.fa131834.js"><link rel="prefetch" href="/assets/js/73.fd8d275f.js"><link rel="prefetch" href="/assets/js/74.82095aed.js"><link rel="prefetch" href="/assets/js/75.41fad4ea.js"><link rel="prefetch" href="/assets/js/76.36bb1714.js"><link rel="prefetch" href="/assets/js/77.83c409c1.js"><link rel="prefetch" href="/assets/js/78.ca197ebf.js"><link rel="prefetch" href="/assets/js/79.9f0de524.js"><link rel="prefetch" href="/assets/js/80.7dd0f8a1.js"><link rel="prefetch" href="/assets/js/81.a5d44424.js"><link rel="prefetch" href="/assets/js/82.03d59f96.js"><link rel="prefetch" href="/assets/js/83.43da9399.js"><link rel="prefetch" href="/assets/js/84.e9ab171d.js"><link rel="prefetch" href="/assets/js/85.523fe07f.js"><link rel="prefetch" href="/assets/js/86.90aac9c6.js"><link rel="prefetch" href="/assets/js/87.1af6082d.js"><link rel="prefetch" href="/assets/js/88.3d7d10f0.js"><link rel="prefetch" href="/assets/js/89.69f4fbaf.js"><link rel="prefetch" href="/assets/js/90.30407e67.js"><link rel="prefetch" href="/assets/js/91.94355f67.js"><link rel="prefetch" href="/assets/js/92.8247a2fb.js"><link rel="prefetch" href="/assets/js/93.245ee436.js"><link rel="prefetch" href="/assets/js/94.a212b15e.js"><link rel="prefetch" href="/assets/js/95.dec85448.js"><link rel="prefetch" href="/assets/js/96.77ebb7ae.js"><link rel="prefetch" href="/assets/js/97.0a615ee3.js"><link rel="prefetch" href="/assets/js/98.9d539c75.js"><link rel="prefetch" href="/assets/js/99.270c2389.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.b7a3ab4f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8c53e149.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">周岐的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java SE/guide.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/项目总结/Mybatis使用/Mybatis分页实现.html" class="nav-link">
  项目总结
</a></div><div class="nav-item"><a href="/Java面试题/Java基础面试题/==和equals的区别.html" class="nav-link">
  Java面试题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/demo223" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/zhouqi-5zipq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java SE/guide.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/项目总结/Mybatis使用/Mybatis分页实现.html" class="nav-link">
  项目总结
</a></div><div class="nav-item"><a href="/Java面试题/Java基础面试题/==和equals的区别.html" class="nav-link">
  Java面试题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/demo223" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/zhouqi-5zipq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/java SE/guide" class="sidebar-heading clickable"><span>java SE</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>java web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mybatis-Plus</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用工具类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java面试题</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/Java基础面试题/==和equals的区别" class="sidebar-heading clickable"><span>Java基础面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/多线程面试题/多线程面试题" class="sidebar-heading clickable open"><span>多线程面试题</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java面试题/多线程面试题/多线程面试题.html" class="sidebar-link">多线程面试题</a></li><li><a href="/Java面试题/多线程面试题/线程池.html" class="active sidebar-link">线程池</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#一-、为什么要使用线程池" class="sidebar-link">一 、为什么要使用线程池？</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#二、如何创建线程池对象" class="sidebar-link">二、如何创建线程池对象？</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#三、线程池的种类" class="sidebar-link">三、线程池的种类</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#四、线程池的核心参数" class="sidebar-link">四、线程池的核心参数</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#五、线程池的生命周期" class="sidebar-link">五、线程池的生命周期</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#六、线程池的拒绝策略" class="sidebar-link">六、线程池的拒绝策略</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#七、如何确定核心线程数" class="sidebar-link">七、如何确定核心线程数</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#八、如何控制某个方法允许并发访问线程的数量" class="sidebar-link">八、如何控制某个方法允许并发访问线程的数量？</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#九、导致并发程序出现问题的根本原因是什么" class="sidebar-link">九、导致并发程序出现问题的根本原因是什么？</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#十、java程序中怎么保证多线程的执行安全" class="sidebar-link">十、Java程序中怎么保证多线程的执行安全</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#十一、线程池使用场景-countdownlatch、future等" class="sidebar-link">十一、线程池使用场景（CountDownLatch、Future等）</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#十二、谈谈你对threadlocal的理解" class="sidebar-link">十二、谈谈你对ThreadLocal的理解</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#十三、completablefuture的使用" class="sidebar-link">十三、CompletableFuture的使用</a></li><li class="sidebar-sub-header"><a href="/Java面试题/多线程面试题/线程池.html#十四、volatile" class="sidebar-link">十四、volatile</a></li></ul></li><li><a href="/Java面试题/多线程面试题/锁.html" class="sidebar-link">锁</a></li><li><a href="/Java面试题/多线程面试题/多线程相关面试题.html" class="sidebar-link">多线程相关面试题</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/集合面试题/Java集合相关面试题" class="sidebar-heading clickable"><span>集合面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/Mybatis面试题/Mybatis面试题" class="sidebar-heading clickable"><span>Mybatis面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/SpringBoot面试题/SpringBoot面试题" class="sidebar-heading clickable"><span>SpringBoot面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/MySQL面试题/MySQL面试题" class="sidebar-heading clickable"><span>MySQL面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/Redis面试题/Redis面试题" class="sidebar-heading clickable"><span>Redis面试题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Java面试题/微服务面试题/微服务面试题" class="sidebar-heading clickable"><span>微服务面试题</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/SpringBoot文档/01-Spring-IOC" class="sidebar-heading clickable"><span>SpringBoot文档</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/微服务文档/SpringCloud介绍" class="sidebar-heading clickable"><span>微服务文档</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h1> <h2 id="一-、为什么要使用线程池"><a href="#一-、为什么要使用线程池" class="header-anchor">#</a> 一 、为什么要使用线程池？</h2> <p>如果用户每发起一个请求，后台就创建一个新线程来处理，下次新任务来了又要创建新线程，而<strong>创建新线程的开销是很大的</strong>，这样会严重影响系统的性能。</p> <p><strong>使用线程池的好处</strong>：</p> <p>线程池的好处是<strong>减少在创建和销毁线程上所消耗的时间以及系统资源的开销，解决资源不足的问题</strong>。</p> <p>如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者&quot;过度切换&quot;的问题。</p> <blockquote><p>在 Java 中，使用线程池能够带来以下几个好处：</p> <ol><li><strong>减少线程创建和销毁的开销</strong>：创建线程和销毁线程都需要消耗一定的系统资源，如果任务量较大且频繁地创建和销毁线程会导致系统开销加大。而使用线程池可以在应用启动时预先创建多个线程，并重复使用这些线程来执行任务，从而减少线程的创建和销毁开销。</li> <li><strong>限制并发数量</strong>：线程池可以根据实际情况调整最大并发数量，避免过多的线程竞争导致系统性能下降或者崩溃。</li> <li><strong>提高响应速度</strong>：当有新的任务需要执行时，线程池中已经存在的线程可以立即开始执行任务，从而提高任务的响应速度。</li> <li><strong>提高线程的可管理性</strong>：通过线程池可以统一管理线程的状态、生命周期和资源占用情况，从而更加方便和可靠地控制多线程程序。</li> <li><strong>提供更强大的功能</strong>：线程池还提供了很多额外的功能，如定时执行任务、周期性执行任务、异步执行任务等，让多线程编程变得更加灵活和高效。</li></ol> <p>综上所述，使用线程池可以有效地提高多线程程序的性能和可靠性，使程序更加高效、健壮和易于维护。</p></blockquote> <h2 id="二、如何创建线程池对象"><a href="#二、如何创建线程池对象" class="header-anchor">#</a> 二、如何创建线程池对象？</h2> <p><strong>方式一：使用<code>Executors</code>（线程池的工具类）调用方法返回不同特点的线程池对象</strong></p> <p>线程池的工具类通过调用方法返回不同类型的线程池对象</p> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20221028185141274.png" alt="image-20221028185141274"></p> <blockquote><p>根据阿里巴巴开发手册规定</p> <p>线程池不允许使用 <code>Executors</code> 去创建，而是通过 <code>ThreadPoolExecutor</code> 的方式，这 样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</p> <p>说明：<code>Executors</code> 返回的线程池对象的弊端如下：</p> <ol><li><code>FixedThreadPool</code> 和 <code>SingleThreadPool</code>： 允许的请求队列长度为 <code>Integer.MAX_VALUE</code>，可能会堆积大量的请求，从而导致 <code>OOM</code>。</li> <li><code>CachedThreadPool</code>： 允许的创建线程数量为 <code>Integer.MAX_VALUE</code>，可能会创建大量的线程，从而导致 <code>OOM(OutOfMemoryError)</code>(也就是内存不足)。</li></ol></blockquote> <p><code>Executors</code> 并不适合做大型互联网场景的线程池方案，否则可能会出现<code>OOM</code>(内存不足)问题❌</p> <p><strong>方式二：使用<code>ExecutorService</code>的实现类<code>ThreadPoolExecutor</code>自创建一个线程池对象</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
    <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
    <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
    <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
    <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
    <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
    <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>建议使用<code>ThreadPoolExecutor</code>来指定线程池参数，这样可以明确线程池的运行规则，规避资源耗尽的风险。✅</p> <blockquote><p>在 Java 中，可以通过 <code>ThreadPoolExecutor</code> 类或者 <code>Executors</code> 工厂类来创建线程池对象。其中，<code>ThreadPoolExecutor</code> 类提供了更加灵活和丰富的线程池配置选项，而 <code>Executors</code> 工厂类则提供了一些常用的线程池配置模板，用于快速创建线程池对象。</p> <p>以下是一个示例代码，展示了如何使用 <code>ThreadPoolExecutor</code> 类和 <code>Executors</code> 工厂类来创建线程池对象：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 使用 ThreadPoolExecutor 创建线程池对象</span>
<span class="token keyword">int</span> corePoolSize <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 线程池中核心线程数</span>
<span class="token keyword">int</span> maximumPoolSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 线程池中最大线程数</span>
<span class="token keyword">long</span> keepAliveTime <span class="token operator">=</span> <span class="token number">60L</span><span class="token punctuation">;</span> <span class="token comment">// 线程空闲时间（单位为秒）</span>
<span class="token class-name">TimeUnit</span> unit <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">;</span> <span class="token comment">// 空闲时间的时间单位</span>
<span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任务队列</span>
<span class="token class-name">ThreadPoolExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> maximumPoolSize<span class="token punctuation">,</span> keepAliveTime<span class="token punctuation">,</span> unit<span class="token punctuation">,</span> workQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 Executors 工厂类创建线程池对象</span>
<span class="token class-name">ExecutorService</span> fixedThreadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 固定大小线程池</span>
<span class="token class-name">ExecutorService</span> cachedThreadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 缓存线程池（自动调整线程数量）</span>
<span class="token class-name">ScheduledExecutorService</span> scheduledThreadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可定时执行任务的线程池</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在上述代码中，我们首先使用 <code>ThreadPoolExecutor</code> 类来创建一个线程池对象，并指定了线程池中的核心线程数、最大线程数、空闲时间、任务队列等参数。然后，我们使用 <code>Executors</code> 工厂类来创建几个常用的线程池对象，包括固定大小线程池、缓存线程池和可定时执行任务的线程池。</p> <p>需要注意的是，线程池使用完毕后应该及时关闭，以避免线程资源的浪费和占用。可以使用 <code>shutdown()</code> 方法或者 <code>shutdownNow()</code> 方法来关闭线程池，具体方法根据需要选择。</p></blockquote> <h2 id="三、线程池的种类"><a href="#三、线程池的种类" class="header-anchor">#</a> 三、线程池的种类</h2> <p>参考回答：</p> <ol><li><p><code>newCachedThreadPool</code>创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若无可回收，则新建线程。</p></li> <li><p><code>newFixedThreadPool</code>创建一个定长线程池，可控制线程最大并发数，超出的线程会在队列中等待。</p></li> <li><p><code>newScheduledThreadPool</code>创建一个定长线程池，支持定时及周期性任务执行。</p></li> <li><p><code>newSingleThreadExecutor</code>创建一个单线程化的线程池，它只会用唯一的工作线程来执行任 务，保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行。</p></li></ol> <p><img src="https://raw.githubusercontent.com/demo223/pictures/master/img/image-20221028185141274.png" alt="image-20221028185141274"></p> <h2 id="四、线程池的核心参数"><a href="#四、线程池的核心参数" class="header-anchor">#</a> 四、线程池的核心参数</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
    <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
    <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
    <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
    <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
    <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
    <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><table><thead><tr><th style="text-align:center;">参数</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;"><code>corePoolSize</code></td> <td style="text-align:center;">核心线程数的最大值</td></tr> <tr><td style="text-align:center;"><code>maximumPoolSize</code></td> <td style="text-align:center;">线程数最大值(核心线程 + 临时线程)</td></tr> <tr><td style="text-align:center;"><code>keepAliveTime</code></td> <td style="text-align:center;">临时线程的存活时间</td></tr> <tr><td style="text-align:center;"><code>unit</code>(<code>TimeUnit.SECONDS</code>表示秒)</td> <td style="text-align:center;"><code>keepAliveTime</code>的单位</td></tr> <tr><td style="text-align:center;"><code>workQueue</code></td> <td style="text-align:center;">任务(阻塞)队列，用来储存等待执行的任务数量</td></tr> <tr><td style="text-align:center;"><code>threadFactory</code></td> <td style="text-align:center;">线程工厂(用来创建线程)</td></tr> <tr><td style="text-align:center;"><code>handler</code></td> <td style="text-align:center;">拒绝策略</td></tr></tbody></table> <ol><li><p>当线程数小于==核心线程数==时，创建线程。</p></li> <li><p>当线程数大于等于==核心线程数==，且==任务队列==未满时，将任务放入==任务队列==。</p></li> <li><p>当线程数大于等于==核心线程数==，且==任务队列==已满：</p> <p>若线程数小于==最大线程数==，创建线程。</p> <p>若线程数等于==最大线程数==，抛出异常，拒绝任务。</p></li></ol> <p><strong>什么时候创建临时线程？</strong></p> <p>当任务提交的时候核心线程都在忙，任务队列也满了，此时还可以创建临时线程的时候，才会创建临时线程。</p> <p><strong>什么时候执行拒绝策略？</strong></p> <p>核心线程和临时线程都在忙，任务队列也满了，还有新的任务过来时会拒绝任务。</p> <p>使用<code>ThreadPoolExecutor</code>创建线程池示例</p> <h2 id="五、线程池的生命周期"><a href="#五、线程池的生命周期" class="header-anchor">#</a> 五、线程池的生命周期</h2> <p>线程池的生命周期包含5个状态：<code>RUNNING</code>、<code>SHUTDOWN</code>、<code>STOP</code>、<code>TIDING</code>、<code>TERMINATED</code>。</p> <p>这5种状态的状态值分别是：<code>-1</code>、<code>0</code>、<code>1</code>、<code>2</code>、<code>3</code>。</p> <p>在线程池的生命周期中，它的状态只能由小到大迁移，是不可逆的。</p> <ol><li><code>RUNNING</code>：表示线程池正在运行。</li> <li><code>SHUTDOWN</code>：执行<code>shutdown</code>()时进入该状态，此时队列不会清空，线程池会等待任务执行完毕。</li> <li><code>STOP</code>：执行<code>stop</code>()时进入该状态，此时现线程池会清空队列，不再等待任务的执行。</li> <li><code>TIDING</code>：当线程池及队列为空时进入该状态，此时线程池会执行钩子函数，目前该函数是一个空的实现。</li> <li><code>TERMINATED</code>：钩子函数执行完毕后，线程进入该状态，表示线程池已经死亡。</li></ol> <hr> <p>线程池的状态有以下 5 种：</p> <ol><li><code>running</code>：运行状态，线程池创建好之后就会进入此状态，如果不手动调用关闭方法，那么线程池在整个程序运行期间都是此状态。</li> <li><code>shutdown</code>：关闭状态，不再接受新任务提交，但是会将已保存在任务队列中的任务处理完。</li> <li><code>stop</code>：停止状态，不再接受新任务提交，并且会中断当前正在执行的任务、放弃任务队列中已有的任务。</li> <li><code>tidying</code>：整理状态，所有的任务都执行完毕后（也包括任务队列中的任务执行完），当前线程池中的活动线程数降为 0 时的状态。到此状态之后，会调用线程池的 terminated() 方法。</li> <li><code>terminated</code>：销毁状态，当执行完线程池的 terminated() 方法之后就会变为此状态。</li></ol> <h2 id="六、线程池的拒绝策略"><a href="#六、线程池的拒绝策略" class="header-anchor">#</a> 六、线程池的拒绝策略</h2> <p>拒绝策略主要有4个：</p> <p>让调用者自己执行任务、直接抛出异常、丢弃任务不做任何处理、删除队列中最老的任务并把当前任务加入队列。这4个拒绝策略分别对应着<code>RejectedExecutionHandler</code>接口的4个实现类，我们也可以基于这个接口实现自己的拒绝策略。</p> <table><thead><tr><th style="text-align:left;">参数</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong><code>AbortPolicy</code>(默认拒绝策略)</strong></td> <td style="text-align:left;"><strong>拒绝任务并抛出异常</strong></td></tr> <tr><td style="text-align:left;"><code>CallerRunsPolicy</code></td> <td style="text-align:left;">重试提交当前的任务，即再次调用运行该任务的execute()方法。</td></tr> <tr><td style="text-align:left;"><code>DiscardOldestPolicy</code></td> <td style="text-align:left;">抛弃队列头部（最旧）的一个任务，并执行当前任务。</td></tr> <tr><td style="text-align:left;"><code>DiscardPolicy</code></td> <td style="text-align:left;">丢弃新来的任务，但是不抛出异常</td></tr></tbody></table> <h2 id="七、如何确定核心线程数"><a href="#七、如何确定核心线程数" class="header-anchor">#</a> 七、如何确定核心线程数</h2> <p>① 高并发、任务执行时间短的业务，线程池程数可以设置为CPU核数+1，减少线程上下文的切换</p> <p>② 并发不高、任务执行时间长的业务要区分开看</p> <ul><li><p>假如是业务时间长集中在IO操作上，也就是IO密集型的任务，因为IO操作并不占用CPU，所以不要让所有的CPU闲下来，可以加大线程池中的线程数目，让CPU处理更多的业务</p></li> <li><p>假如是业务时间长集中在计算操作上，也就是计算密集型任务，这个就没办法了，和（1）一样吧，线程池中的线程数设置得少一些，减少线程上下文的切换</p></li></ul> <p>③ 并发高、业务执行时间长，解决这种类型任务的关键不在于线程池而在于整体架构的设计，看看这些业务里面某些数据是否能做缓存是第一步，增加服务器是第二步，至于线程池的设置，设置参考（2）。最后，业务执行时间长的问题，也可能需要分析一下，看看能不能使用中间件对任务进行拆分和解耦。</p> <blockquote><p>参考回答：是这样的，我们公司当时有一些规范，为了减少线程上下文的切换，要根据当时部署的服务器的CPU核数来决定，我们规则是：CPU核数+1就是最终的核心线程数。</p></blockquote> <h2 id="八、如何控制某个方法允许并发访问线程的数量"><a href="#八、如何控制某个方法允许并发访问线程的数量" class="header-anchor">#</a> 八、如何控制某个方法允许并发访问线程的数量？</h2> <p>Semaphore两个重要的方法就是semaphore.acquire() 请求一个信号量，这时候的信号量个数-1（一旦没有可使用的信号量，也即信号量个数变为负数时，再次请求的时候就会阻塞，直到其他线程释放了信号量）semaphore.release()释放一个信号量，此时信号量个数+1</p> <h2 id="九、导致并发程序出现问题的根本原因是什么"><a href="#九、导致并发程序出现问题的根本原因是什么" class="header-anchor">#</a> 九、导致并发程序出现问题的根本原因是什么？</h2> <p>CPU、内存、IO 设备的读写速度差异巨大，表现为 <strong>CPU 的速度 &gt; 内存的速度 &gt; IO 设备</strong>的速度。
程序的性能瓶颈在于速度最慢的 IO 设备的读写，也就是说当涉及到 IO 设备的读写，再怎么提升CPU 和内存的速度也是起不到提升性能的作用。</p> <p>为了更好地利用 CPU 的高性能计算机体系结构，给 CPU 增加了缓存，均衡 CPU 和内存的速度差异操作系统，增加了进程与线程，分时复用 CPU，均衡 CPU 和 IO 设备的速度差异编译器，增加了指令执行重排序，更好地利用缓存，提高程序的执行速度</p> <p>基于以上原因：</p> <p>1、 CPU 缓存，在多核 CPU 的情况下，带来了可见性问题</p> <p>可见性：一个线程对共享变量的修改，另一个线程能够立刻看到修改后的值</p> <p>2、操作系统对当前执行线程的切换，带来了原子性问题</p> <p>原子性：一个或多个指令在 CPU 执行的过程中不被中断的特性</p> <p>3、编译器指令重排优化，带来了有序性问题</p> <p>有序性：程序按照代码执行的先后顺序</p> <blockquote><ol><li>原子性指的是一个操作要么全部执行完毕，要么就不执行。如果在执行过程中发生了中断或者异常，那么就会回滚到操作之前的状态。在并发环境中，如果没有保证原子性，多个线程同时对共享资源进行修改时就可能会出现竞态条件，从而导致数据不一致问题。</li> <li>可见性指的是当一个线程对共享变量进行修改后，其他线程可以立即看到这个修改。在并发环境中，如果没有保证可见性，就可能会导致其他线程读取到的值与预期不符。</li> <li>有序性指的是程序执行时的指令顺序要与代码中的顺序一致。在编写代码时，我们通常会按照自己的逻辑顺序来编写程序，但是在编译器和处理器执行时，可能会对指令进行重新排序，以优化程序的执行效率。如果没有保证有序性，可能会导致程序出现意想不到的结果。</li></ol> <p>综上所述，原子性、可见性和有序性都是导致并发程序出现问题的根本原因。为了避免这些问题，需要采用合适的并发控制方式，例如锁、信号量、原子变量等来保证线程安全。同时，还需要注意Java内存模型中的规范和约束，避免出现意外的结果。</p></blockquote> <h2 id="十、java程序中怎么保证多线程的执行安全"><a href="#十、java程序中怎么保证多线程的执行安全" class="header-anchor">#</a> 十、Java程序中怎么保证多线程的执行安全</h2> <p>线程的安全性问题体现在：</p> <ul><li><strong>原子性</strong>：一个或者多个操作在 CPU 执行的过程中不被中断的特性</li> <li><strong>可见性</strong>：一个线程对共享变量的修改，另外一个线程能够立刻看到</li> <li><strong>有序性</strong>：程序执行的顺序按照代码的先后顺序执行</li></ul> <p><strong>导致原因：</strong></p> <ul><li><p>线程切换带来的原子性问题</p></li> <li><p>cpu缓存导致的可见性问题</p></li> <li><p>编译优化带来的有序性问题</p></li></ul> <p><strong>解决办法：</strong></p> <ul><li>JDK Atomic开头的原子类、synchronized、LOCK，可以解决原子性问题</li> <li>synchronized、volatile、LOCK，可以解决可见性问题</li> <li>Happens-Before 规则可以解决有序性问题</li></ul> <h2 id="十一、线程池使用场景-countdownlatch、future等"><a href="#十一、线程池使用场景-countdownlatch、future等" class="header-anchor">#</a> 十一、线程池使用场景（CountDownLatch、Future等）</h2> <p>用来进行线程同步协作，等待所有线程完成倒计时。
其中构造参数用来初始化等待计数值，await() 用来等待计数归零，countDown() 用来让计数减一</p> <p>Future</p> <p>Futrue可以监视目标线程调用call的情况，当你调用Future的get()方法以获得结果时，当前线程就开始阻塞，直接call方法结束返回结果</p> <p>举个例子</p> <p>在一个电商网站，当用户下单之后，我们一般会有一些后续操作，比如，需要查询订单，需要获得订单中的商品详细信息（可能是多个），需要查看物流发货信息</p> <p>这三个操作，分别是不同的微服务中实现的，我们正常情况是，先调用查询订单，然后分别调用商品和物流，但这样的性能是不高的，因为接口需要等待所有调用成功之后才能返回数据，我们可以使用多线程解决这个性能问题，想要获取返回值，则需要使用Future</p> <h2 id="十二、谈谈你对threadlocal的理解"><a href="#十二、谈谈你对threadlocal的理解" class="header-anchor">#</a> 十二、谈谈你对ThreadLocal的理解</h2> <blockquote><p><strong>面试官</strong>：好的，那你知道<code>ThreadLocal</code>的底层原理实现吗？</p> <p><strong>候选人</strong>：</p> <p>嗯，知道一些~</p> <p>在<code>ThreadLocal</code>内部维护了一个一个 <code>ThreadLocalMap</code>类型的成员变量，用来存储资源对象</p> <p>当我们调用 <code>set</code>方法，就是以 <code>ThreadLocal</code>自己作为 <code>key</code>，资源对象作为 <code>value</code>，放入当前线程的 <code>ThreadLocalMap</code>集合中</p> <p>当调用 <code>get</code>方法，就是以 <code>ThreadLocal</code>自己作为 <code>key</code>，到当前线程中查找关联的资源值</p> <p>当调用 <code>remove</code>方法，就是以 <code>ThreadLocal</code>自己作为 <code>key</code>，移除当前线程关联的资源值</p> <p><strong>面试官</strong>：好的，那关于<code>ThreadLocal</code>会导致内存溢出这个事情，了解吗？</p> <p><strong>候选人</strong>：</p> <p>嗯，我之前看过源码，我想一下~~</p> <p>是因为<code>ThreadLocalMap</code>中的 <code>key</code>被设计为==弱引用==，它是被动的被<code>GC</code>调用释放<code>key</code>，不过关键的是只有key可以得到内存释放，而<code>value</code>不会，因为<code>value</code>是一个强引用。</p> <p>在使用<code>ThreadLocal</code>时都把它作为静态变量（即强引用），因此无法被动依靠 <code>GC</code>回收，建议主动的<code>remove</code>释放 <code>key</code>，这样就能避免内存溢出。</p></blockquote> <blockquote><p><code>ThreadLocal</code>会为每个线程创建一个副本变量，并将这个变量存储在线程的<code>ThreadLocalMap</code>中。如果没有适时地清除这些副本变量，就可能会导致内存泄漏。</p> <p>例如，在Web应用程序中，如果每个请求对应的线程都存储了一些数据，并且这些数据没有及时清理，那么随着请求的增加，可能会导致大量的内存被占用，最终导致内存溢出。</p> <p>此外，在一些高并发的场景下，如果频繁地创建和销毁 <code>ThreadLocal</code>变量，也可能会影响系统的性能。因此，在使用 <code>ThreadLocal</code>时需要注意控制变量的生命周期，并及时清除无用的副本，避免出现内存泄漏和性能问题。</p></blockquote> <h2 id="十三、completablefuture的使用"><a href="#十三、completablefuture的使用" class="header-anchor">#</a> 十三、CompletableFuture的使用</h2> <p><code>CompletableFuture</code>是 Java 8 引入的一个异步编程工具，它主要用于在多线程环境下方便地执行异步操作、组合多个异步操作以及处理异步操作的结果。</p> <blockquote><p>下面是<code>CompletableFuture</code>的基本使用方法：</p> <ol><li>创建<code>CompletableFuture</code>对象</li></ol> <p>可以通过<code>CompletableFuture</code>类的静态方法来创建一个新的<code>CompletableFuture</code>对象，例如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li><strong>异步执行任务</strong></li></ol> <p>可以使用<code>CompletableFuture</code>的<code>supplyAsync()</code>方法或<code>runAsync()</code>方法来异步执行任务。其中，<code>supplyAsync()</code>方法用于执行有返回值的任务，而<code>runAsync()</code>方法用于执行没有返回值的任务。</p> <p>例如，下面是一个使用<code>supplyAsync()</code>方法异步执行任务的例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行耗时的操作，例如查询数据库、调用远程接口等</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li><strong>处理任务结果</strong></li></ol> <p>可以通过<code>CompletableFuture</code>的<code>thenApply()</code>、<code>thenAccept()</code>和<code>thenRun()</code>等方法来处理任务的结果。其中，<code>thenApply()</code>方法用于处理==有返回值==的任务的结果，<code>thenAccept()</code>方法用于处理==没有返回值==的任务的结果，而<code>thenRun()</code>方法则不关心任务的结果，只关心任务执行完毕后需要执行的操作。</p> <p>例如，下面是一个使用<code>thenApply()</code>方法处理任务结果的例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行耗时的操作，例如查询数据库、调用远程接口等</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>result <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对任务结果进行处理，例如字符串拼接等</span>
    <span class="token keyword">return</span> result <span class="token operator">+</span> <span class="token string">&quot; world&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li><strong>组合多个任务</strong></li></ol> <p>可以使用<code>CompletableFuture</code>的<code>thenCombine()</code>、<code>thenCompose()</code>和<code>thenAcceptBoth()</code>等方法来组合多个任务。其中，<code>thenCombine()</code>方法用于将两个有返回值的任务的结果进行合并，<code>thenCompose()</code>方法用于将一个有返回值的任务的结果作为另一个任务的输入，而<code>thenAcceptBoth()</code>方法则用于处理两个没有返回值的任务的结果。</p> <p>例如，下面是一个使用<code>thenCompose()</code>方法组合多个任务的例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行耗时的操作，例如查询数据库、调用远程接口等</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">thenCompose</span><span class="token punctuation">(</span>result <span class="token operator">-&gt;</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对任务结果进行处理，并返回一个新的CompletableFuture对象</span>
    <span class="token keyword">return</span> result <span class="token operator">+</span> <span class="token string">&quot; world&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></blockquote> <p>以下是一些使用 <code>CompletableFuture</code>的场景：</p> <ol><li>异步执行任务并返回结果，避免阻塞主线程。</li> <li>处理多个异步任务的结果，例如等待所有任务完成后进行汇总处理。</li> <li>使用回调函数处理异步操作的结果，例如将结果写入数据库或发送到远程服务。</li> <li>超时处理，当异步操作超时后，可以取消任务并返回默认值或者抛出异常。</li> <li>并发处理多个请求，例如从不同的数据源获取数据并聚合结果。</li></ol> <p>下面是一个使用 <code>CompletableFuture</code>的例子，假设我们需要从不同的数据源获取今天的收入和订单数量，并将它们显示在智慧大屏上。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletableFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureExample</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> incomeFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">getIncomeToday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> orderCountFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">getOrderCountToday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>incomeFuture<span class="token punctuation">,</span> orderCountFuture<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待所有任务完成</span>

        <span class="token keyword">double</span> income <span class="token operator">=</span> incomeFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> orderCount <span class="token operator">=</span> orderCountFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将收入和订单数量显示在智慧大屏上</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;今日收入：&quot;</span> <span class="token operator">+</span> income<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;今日订单数量：&quot;</span> <span class="token operator">+</span> orderCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Double</span> <span class="token function">getIncomeToday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// TODO: 实际业务逻辑中，从数据库或者其他数据源中查询今天的收入数据</span>
        <span class="token keyword">return</span> <span class="token number">5000.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">getOrderCountToday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// TODO: 实际业务逻辑中，从数据库或者其他数据源中查询今天的订单数量数据</span>
        <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>在上面的代码中，我们使用了 <code>CompletableFuture.supplyAsync()</code> 方法来异步地获取今天的收入和订单数量。因为这两个操作互不依赖，所以我们可以分别使用两个 <code>CompletableFuture</code>来执行它们。</p> <p>接着，在主线程中使用 <code>CompletableFuture.allOf()</code> 方法等待两个 <code>CompletableFuture</code>都完成，然后分别调用它们的 <code>get()</code> 方法获取结果。</p> <p>最后，我们将收入和订单数量显示在智慧大屏上。</p> <p>当然，在实际业务中，可能会有更多的异步操作和处理逻辑，但核心思想是相同的：使用 <code>CompletableFuture</code>来执行异步操作，并在必要时组合、转换、处理异步操作的结果。</p> <h2 id="十四、volatile"><a href="#十四、volatile" class="header-anchor">#</a> 十四、volatile</h2> <p><code>volatile</code>是 Java 中的一个关键字，用于修饰变量。它主要有以下两个作用：</p> <ol><li>保证可见性：使用 <code>volatile</code>关键字修饰的变量在多线程环境中发生修改后可以立即被其他线程看到，从而保证了该变量的可见性。这是由于 <code>volatile</code>变量的值会直接存储在==主内存==中，每次读取时都会从主内存中获取最新的值。</li> <li>禁止指令重排序优化：在不影响单线程程序执行结果的前提下，编译器和处理器可能对指令进行重排序等优化操作以提高程序的执行效率。但是这种优化可能会对多线程并发访问造成问题，因此使用 <code>volatile</code>关键字可以禁止指令重排序优化，保证多线程环境下程序的正确性。</li></ol> <p>需要注意的是，<code>volatile</code>关键字不能保证多个线程共同修改变量时所带来的不一致问题，因此在涉及到多个线程同时修改变量时，仍然需要使用锁或其他并发控制工具来确保数据的正确性。</p> <blockquote><p>虽然使用 <code>volatile</code>关键字可以保证共享变量的可见性，但是它并不能保证对共享变量的操作具备原子性。</p> <p><code>volatile</code>关键字只能确保对单个 <code>volatile</code>变量的读写操作具备原子性，即在线程中读取和修改 <code>volatile</code>变量时，会从主内存中读取最新的值，并且在修改后立即刷新到主内存中。因此，当多个线程同时对同一个 <code>volatile</code>变量进行修改时，仍然可能会出现竞争条件，导致数据不一致或者错误的结果。</p> <p>例如，假设有一个计数器变量 <code>count</code>，多个线程同时对该变量进行自增操作：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>尽管在 <code>count</code>变量上使用了 <code>volatile</code>关键字，但是在多线程并发执行时仍然可能导致计数器值不正确的问题，因为 <code>count++</code>操作实际上包含了<strong>读取</strong>、<strong>增加</strong>和<strong>写回</strong>三个步骤，而==这三个步骤并不具备原子性==。</p> <p>如果需要对多个操作作为一个整体来处理，必须使用锁或者其他并发控制工具来确保操作的原子性。</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2023/10/29</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Java面试题/多线程面试题/多线程面试题.html" class="prev">
        多线程面试题
      </a></span> <span class="next"><a href="/Java面试题/多线程面试题/锁.html">
        锁
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a19eb3cb.js" defer></script><script src="/assets/js/2.34fff606.js" defer></script><script src="/assets/js/1.16393a26.js" defer></script><script src="/assets/js/66.67703170.js" defer></script>
  </body>
</html>
