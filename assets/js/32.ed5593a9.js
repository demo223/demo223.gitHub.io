(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{314:function(a,s,t){"use strict";t.r(s);var e=t(14),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"软件安装文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#软件安装文档"}},[a._v("#")]),a._v(" 软件安装文档")]),a._v(" "),s("h2",{attrs:{id:"虚拟机安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#虚拟机安装"}},[a._v("#")]),a._v(" 虚拟机安装")]),a._v(" "),s("p",[a._v("虚拟机账号root密码123456")]),a._v(" "),s("p",[a._v("安装完成后，我们把IP设置为"),s("code",[a._v("192.168.211.130")]),a._v("，此时需要修改网卡配置：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#编辑文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vi")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/sysconfig/network-scripts/ifcfg-ens33")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#修改配置如下：")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("TYPE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Ethernet")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("PROXY_METHOD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("none")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("BROWSER_ONLY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("no")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("BOOTPROTO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("static")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("DEFROUTE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yes")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("IPV4_FAILURE_FATAL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("no")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("IPV6INIT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yes")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("IPV6_AUTOCONF")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yes")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("IPV6_DEFROUTE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yes")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("IPV6_FAILURE_FATAL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("no")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("IPV6_ADDR_GEN_MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("stable-privacy")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ens33")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("UUID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("17a66726-0303-4d70-bf76-545ff501191b")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("DEVICE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ens33")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ONBOOT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yes")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("IPADDR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("GATEWAY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("DNS1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("114.114.114.114")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重启服务或者重启网卡")]),a._v("\nreboot\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br")])]),s("p",[a._v("开发环境一般建议关闭防火墙：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#关闭防火墙")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("stop firewalld.service")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#禁止防火墙开机启动")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("disable firewalld.service")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h2",{attrs:{id:"系统死锁问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统死锁问题"}},[a._v("#")]),a._v(" 系统死锁问题")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("kernel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("NMI watchdog: BUG: soft lockup - CPU#4 stuck for 35s! [kworker/4:2:530]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("出现如上问题，其实是一种死锁问题，大概是这个意思：这个bug没有让系统彻底死机，但是若干个进程(或者kernel thread)被锁死在了某个状态(一般在内核区域)，很多情况下这个是由于内核锁的使用的问题。")]),a._v(" "),s("p",[a._v("这个会导致系统卡顿甚至连不上，这个问题解决也简单，执行如下命令即可解决：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("30 > /proc/sys/kernel/watchdog_thresh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"kernel.watchdog_thresh=30" >> /etc/sysctl.conf')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sysctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-w kernel.watchdog_thresh=30")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sysctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-q vm.swappiness")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sysctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h2",{attrs:{id:"jdk11安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jdk11安装"}},[a._v("#")]),a._v(" JDK11安装")]),a._v(" "),s("p",[a._v("下载地址：https://www.oracle.com/java/technologies/downloads/#java11")]),a._v(" "),s("p",[a._v("安装包："),s("code",[a._v("jdk-11.0.15.1_linux-x64_bin.tar.gz")]),a._v("上传至虚拟机"),s("code",[a._v("/usr/local/server")]),a._v("目录下，并解压，改名为jdk即可。")]),a._v(" "),s("p",[a._v("修改配置文件/etc/profile添加环境变量配置：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#修改")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vi")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/profile")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#添加配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("JAVA_HOME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/jdk")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("CLASSPATH")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v(".:$JAVA_HOME/lib")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("PATH")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("$JAVA_HOME/bin:$PATH")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("JAVA_HOME CLASSPATH PATH")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#保存退出并让文件立即生效")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("source")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/profile")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看JDK版本")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("[root@localhost")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("server]# java --version")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("11.0.15.1 2022-04-22 LTS")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Java(TM)")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("SE Runtime Environment 18.9 (build 11.0.15.1+2-LTS-10)")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.15.1+2-LTS-10, mixed mode)")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br")])]),s("h2",{attrs:{id:"docker安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装"}},[a._v("#")]),a._v(" Docker安装")]),a._v(" "),s("p",[a._v("Docker安装:")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#更新至最新的库")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("yum")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("update")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#安装Docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("yum")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("install docker")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#启动Docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("start docker")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#开机启动Docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("enable docker")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[a._v("Docker默认镜像源下载太慢，可以调整为国内镜像源，")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#编辑配置文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vi")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/docker/daemon.json")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#添加镜像地址信息")]),a._v("\n{\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v('    "registry-mirrors"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("[")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v('        "http')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('//hub-mirror.c.163.com",')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v('        "https')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('//docker.mirrors.ustc.edu.cn",')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v('        "https')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('//registry.docker-cn.com"')]),a._v("\n    ]\n}\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重启Docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("restart docker")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("p",[a._v("为了验证是否切换成功，可以使用"),s("code",[a._v("docker info")]),a._v("查看，会显示如下信息：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Registry")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Mirrors:")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("//hub-mirror.c.163.com")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" https")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("//docker.mirrors.ustc.edu.cn")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" https")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("//registry.docker-cn.com")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h2",{attrs:{id:"docker-compose安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装"}},[a._v("#")]),a._v(" Docker-Compose安装")]),a._v(" "),s("p",[a._v("安装Docker-Compose，这里下载的是最新版本v2.5.0，安装流程如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#下载安装文件，其中uname -s是获取系统内核，uname -m获取系统版本，所以最后其实是下载docker-compose-Linux-x86_64")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("curl -L https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#添加可执行权限")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("chmod +x /usr/local/bin/docker-compose")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#检查版本，是否安装成功")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker-compose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("--version")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h2",{attrs:{id:"mysql安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql安装"}},[a._v("#")]),a._v(" MySQL安装")]),a._v(" "),s("p",[a._v("这里提供MySQL8安装、MySQL7安装，同时讲解基于Docker安装和Docker-Compose安装。")]),a._v(" "),s("h3",{attrs:{id:"mysql8安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql8安装"}},[a._v("#")]),a._v(" MySQL8安装")]),a._v(" "),s("p",[a._v("安装命令：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -d -i \\\n--name mysql \\\n-v /usr/local/server/mysql/datadir:/var/lib/mysql \\\n-v /usr/local/server/mysql/conf.d:/etc/mysql/conf.d \\\n-v /etc/localtime:/etc/localtime \\\n--privileged=true \\\n-p 3306:3306 \\\n-e MYSQL_ROOT_PASSWORD=123456 \\\n--restart=always \\\nmysql:8.0")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("修改密码:")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#进入容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec -it mysql /bin/bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#登录mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mysql")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-u root -p")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#修改登录权限")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ALTER")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("blockquote",[s("ul",[s("li",[s("code",[a._v("ALTER USER")]),a._v(": 这是用于修改用户属性的 MySQL 命令。")]),a._v(" "),s("li",[s("code",[a._v("'root'@'%'")]),a._v(": 这指定了要修改的用户，其中 'root' 是用户名，'%' 代表任意远程主机。")]),a._v(" "),s("li",[s("code",[a._v("IDENTIFIED WITH mysql_native_password")]),a._v(": 使用 mysql_native_password 身份验证插件进行用户身份验证。")]),a._v(" "),s("li",[s("code",[a._v("BY '123456'")]),a._v(": 设置新密码为 '123456'。")])])]),a._v(" "),s("p",[s("code",[a._v("select NOW()")]),a._v("时间如果小了8小时，执行如下操作同步时区即可：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("cp /usr/share/zoneinfo/Asia/Shanghai mysql:/usr/share/zoneinfo/Asia")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec -it mysql bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("cp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/share/zoneinfo/Asia/Shanghai /etc/localtime")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("restart mysql")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h3",{attrs:{id:"docker-compose安装mysql8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装mysql8"}},[a._v("#")]),a._v(" Docker-Compose安装MySQL8")]),a._v(" "),s("p",[a._v("创建mysql-compose.yml文件，配置如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("'3.0'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  mysql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql:8.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("      # 当您的配置需要文字美元符号时，您可以使用$$（双美元符号）。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("123456")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      --default-authentication-plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql_native_password")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      --character-set-server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("utf8mb4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      --collation-server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("utf8mb4_general_ci")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      --explicit_defaults_for_timestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      --lower_case_table_names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3306:3306")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/mysql:/var/lib/mysql")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br")])]),s("p",[a._v("参数说明：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("default-authentication-plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\tmysql8")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("版本默认的认证方式是 caching_sha2_password ，客户端不支持，之前是采用 mysql_native_password，可以在启动容器时添加参数")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("character-set-server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\t编码设置，mb4就是most")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("bytes 4的意思，专门用来兼容四字节的unicode。utf8mb4是utf8的超集，除了将编码改为utf8mb4外不需要做其他转换。")]),a._v("\n\ncollation-server：\n\t服务器的字符集设置。\n\nexplicit_defaults_for_timestamp：\n\t默认情况下，timestamp类型字段所在数据行被更新时，该字段会自动更新为当前时间，而参数explicit_defaults_for_timestamp控制这一种行为。\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\texplicit_defaults_for_timestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("false，数据行更新时，timestamp类型字段更新为当前时间。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\texplicit_defaults_for_timestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true，数据行更新时，timestamp类型字段不更新为当前时间。")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("lower_case_table_names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\tlower_case_table_names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("0 表名存储为给定的大小和比较是区分大小写的")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\tlower_case_table_names")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1 表名存储在磁盘是小写的，但是比较的时候是不区分大小写")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\tlower_case_table_names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2 表名存储为给定的大小写但是比较的时候是小写的")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br")])]),s("p",[a._v("安装命令：docker-compose -f mysql-compose.yml up -d")]),a._v(" "),s("h3",{attrs:{id:"mysql5-7安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql5-7安装"}},[a._v("#")]),a._v(" MySQL5.7安装")]),a._v(" "),s("p",[a._v("如果要安装MySQL5.7，可按照如下安装流程执行：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -it --name mysql -d \\\n-p 3306:3306 --restart=always \\\n-e MYSQL_ROOT_PASSWORD=123456 \\\nmysql:5.7")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("MySQL修改权限：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("GRANT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ALL")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PRIVILEGES")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ON")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("* "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TO")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token char"}},[a._v("'root'")]),a._v("@'localhost' "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("IDENTIFIED")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("BY")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token char"}},[a._v("'123456'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"nacos安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos安装"}},[a._v("#")]),a._v(" Nacos安装")]),a._v(" "),s("p",[a._v("这里讲解Docker安装Nacos单节点，同时讲解基于Docker-Compose安装Nacos集群。")]),a._v(" "),s("h3",{attrs:{id:"docker安装nacos单机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装nacos单机"}},[a._v("#")]),a._v(" Docker安装Nacos单机")]),a._v(" "),s("p",[a._v("安装Nacos，默认采用的是Derby数据库存储，如果想用MySQL存储，需要先获取SQL脚本，并创建数据库，我们可以下载安装包获取SQL脚本,将"),s("code",[a._v("conf/nacos_config.sql")]),a._v("导入数据库即可。")]),a._v(" "),s("p",[s("img",{attrs:{src:"C:%5CUsers%5CASUS%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20230203200105255.png",alt:"image-20230203200105255"}})]),a._v(" "),s("p",[a._v("下载地址：https://github.com/alibaba/nacos/releases")]),a._v(" "),s("p",[a._v("安装脚本：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -d \\\n-e MODE=standalone \\\n-e SPRING_DATASOURCE_PLATFORM=mysql \\\n-e MYSQL_SERVICE_HOST=192.168.33.31 \\\n-e MYSQL_SERVICE_PORT=3306 \\\n-e MYSQL_SERVICE_USER=root \\\n-e MYSQL_SERVICE_PASSWORD=123456 \\\n-e MYSQL_SERVICE_DB_NAME=nacos_config \\\n-p 8848:8848 \\\n--restart=always \\\n--name nacos nacos/nacos-server:v2.1.0")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[a._v("参数说明：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("SPRING_DATASOURCE_PLATFORM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql   使用MySQL存储数据")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("MYSQL_SERVICE_HOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.33.31   存储数据的MySQL的IP")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("MYSQL_SERVICE_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3306            MySQL的端口号")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("MYSQL_SERVICE_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("root            MySQL的账号")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("MYSQL_SERVICE_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("123456      MySQL的密码")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("MYSQL_SERVICE_DB_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos_config 存储数据的数据库名字")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"docker-compose安装nacos集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装nacos集群"}},[a._v("#")]),a._v(" Docker-Compose安装Nacos集群")]),a._v(" "),s("p",[a._v("这里实现集群的节点如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("节点1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("        192.168.33.31          8818")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("节点2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("        192.168.33.31          8828")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("节点3")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("        192.168.33.31          8838")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("创建nacos-cluster.yml，配置如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"3"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  nacos1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos/nacos-server:v2.1.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      PREFER_HOST_MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ip")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("cluster")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      NACOS_SERVER_IP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.33.31")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      NACOS_SERVERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"192.168.33.31:8818 192.168.33.31:8828 192.168.33.31:8838"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      SPRING_DATASOURCE_PLATFORM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_HOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.33.31")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3306")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_DB_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos_config")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("root")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("123456")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("256m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("512m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("256m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      SERVER_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8818")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"8818:8818"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      network")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n \n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  nacos2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos/nacos-server:v2.1.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      PREFER_HOST_MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ip")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("cluster")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      NACOS_SERVER_IP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.33.31")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      NACOS_SERVERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"192.168.33.31:8818 192.168.33.31:8828 192.168.33.31:8838"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      SPRING_DATASOURCE_PLATFORM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_HOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.33.31")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3306")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_DB_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos_config")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("root")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("123456")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("256m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("512m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("256m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      SERVER_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8828")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"8828:8828"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      network")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n \n \n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  nacos3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos/nacos-server:v2.1.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      PREFER_HOST_MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ip")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("cluster")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      NACOS_SERVER_IP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.33.31")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      NACOS_SERVERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"192.168.33.31:8818 192.168.33.31:8828 192.168.33.31:8838"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      SPRING_DATASOURCE_PLATFORM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_HOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.33.31")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3306")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_DB_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nacos_config")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("root")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      MYSQL_SERVICE_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("123456")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("256m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("512m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JVM_XMN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("256m")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      SERVER_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8838")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"8838:8838"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      network")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br"),s("span",{staticClass:"line-number"},[a._v("51")]),s("br"),s("span",{staticClass:"line-number"},[a._v("52")]),s("br"),s("span",{staticClass:"line-number"},[a._v("53")]),s("br"),s("span",{staticClass:"line-number"},[a._v("54")]),s("br"),s("span",{staticClass:"line-number"},[a._v("55")]),s("br"),s("span",{staticClass:"line-number"},[a._v("56")]),s("br"),s("span",{staticClass:"line-number"},[a._v("57")]),s("br"),s("span",{staticClass:"line-number"},[a._v("58")]),s("br"),s("span",{staticClass:"line-number"},[a._v("59")]),s("br"),s("span",{staticClass:"line-number"},[a._v("60")]),s("br"),s("span",{staticClass:"line-number"},[a._v("61")]),s("br"),s("span",{staticClass:"line-number"},[a._v("62")]),s("br"),s("span",{staticClass:"line-number"},[a._v("63")]),s("br"),s("span",{staticClass:"line-number"},[a._v("64")]),s("br"),s("span",{staticClass:"line-number"},[a._v("65")]),s("br"),s("span",{staticClass:"line-number"},[a._v("66")]),s("br"),s("span",{staticClass:"line-number"},[a._v("67")]),s("br"),s("span",{staticClass:"line-number"},[a._v("68")]),s("br"),s("span",{staticClass:"line-number"},[a._v("69")]),s("br"),s("span",{staticClass:"line-number"},[a._v("70")]),s("br"),s("span",{staticClass:"line-number"},[a._v("71")]),s("br"),s("span",{staticClass:"line-number"},[a._v("72")]),s("br"),s("span",{staticClass:"line-number"},[a._v("73")]),s("br"),s("span",{staticClass:"line-number"},[a._v("74")]),s("br"),s("span",{staticClass:"line-number"},[a._v("75")]),s("br"),s("span",{staticClass:"line-number"},[a._v("76")]),s("br"),s("span",{staticClass:"line-number"},[a._v("77")]),s("br")])]),s("p",[a._v("参数列表说明：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("PREFER_HOST_MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Nacos会以什么方式来寻找自己的集群节点，一共有两种方式:")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\t1)如果指定为")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ip，那么 NACOS_SERVERS 也必须指定的是一组 ip（所有Nacos的集群节点）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("\t2)如果指定为")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hostname，那么 NACOS_SERVERS 也必须指定的是一组 hostname（所有Nacos的集群节点），所以还需要配置docker-compose中service的 hostname 用来显示指定主机名")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("NACOS_SERVERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("服务集群的节点列表，以IP1:Port1,IP2:Port2的方式编写")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("NACOS_SERVER_IP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.33.31   节点的IP，如果不指定，在多网卡环境下，会出现多IP问题")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("SERVER_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8838  每个节点的容器中Nacos的IP，如果是非8848端口，一定要指定，否则集群会多出一个无效的8848节点")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("安装命令：docker-compose -f nacos-cluster.yml up -d")]),a._v(" "),s("p",[a._v("访问任意一个节点，集群节点列表如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1670081125644-537350b3-2e58-4dd5-9a27-ba33b075cf53.png",alt:"img"}})]),a._v(" "),s("h2",{attrs:{id:"openresty安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#openresty安装"}},[a._v("#")]),a._v(" OpenResty安装")]),a._v(" "),s("p",[a._v("安装OpenResty需要先安装相关依赖库：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("yum")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("install libtermcap-devel ncurses-devel libevent-devel readline-devel pcre-devel gcc openssl openssl-devel per perl wget")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("安装OpenResty")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#下载OpenResty")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("wget")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("https://openresty.org/download/openresty-1.11.2.5.tar.gz")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#解压OpenResty")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-xf openresty-1.11.2.5.tar.gz")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#配置 OpenResty")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("./configure")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("--prefix=/usr/local/openresty --with-luajit --without-http_redis2_module --with-http_stub_status_module --with-http_v2_module --with-http_gzip_static_module --with-http_sub_module")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#编译安装")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("make")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("&& make install")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#在profile中添加环境配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vi")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/profile")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("p",[a._v("Nginx服务自启")]),a._v(" "),s("p",[a._v("创建"),s("code",[a._v("/etc/systemd/system/nginx.service")]),a._v("，添加如下配置：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[a._v("[Unit]\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" Description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nginx service")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" After")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("network.target")]),a._v("\n\n [Service]\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" Type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("forking")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" ExecStart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/openresty/nginx/sbin/nginx")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" ExecReload")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/openresty/nginx/sbin/nginx -s reload")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" ExecStop")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/openresty/nginx/sbin/nginx -s quit")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" PrivateTmp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n\n [Install]\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" WantedBy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("multi-user.target")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("p",[a._v("保存退出后，然后执行服务配置加载，并设置开机启动，同时可以验证一下命令是否生效，操作如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重新加载服务配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("daemon-reload")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#Nginx开机启动")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("enable nginx")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#nginx启动:")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("start nginx")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#nginx停止:")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("stop nginx")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重启 验证是否开机自启")]),a._v("\nreboot\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("h2",{attrs:{id:"redis安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis安装"}},[a._v("#")]),a._v(" Redis安装")]),a._v(" "),s("p",[a._v("这里将实现Docker安装单机版的Redis以及Docker-Compose安装Redis集群。")]),a._v(" "),s("h3",{attrs:{id:"docker安装单机redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装单机redis"}},[a._v("#")]),a._v(" Docker安装单机Redis")]),a._v(" "),s("p",[a._v("安装Redis，这里固定版本为6.2.4，操作如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -itd --name redis -p 6379:6379 \\\n--privileged=true \\\n-v /usr/local/docker/redis/data:/data \\\n-v /usr/local/docker/redis/conf/redis.conf:/usr/local/etc/redis/redis.conf \\\n--restart=always \\\nredis:6.2.4 --requirepass 123456")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"docker-compose安装redis集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装redis集群"}},[a._v("#")]),a._v(" Docker-Compose安装Redis集群")]),a._v(" "),s("p",[a._v("这里准备6个节点，节点信息如下：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("节点")]),a._v(" "),s("th",[a._v("IP")]),a._v(" "),s("th",[a._v("Port")]),a._v(" "),s("th",[a._v("类型")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("redis1")]),a._v(" "),s("td",[a._v("192.168.33.31")]),a._v(" "),s("td",[a._v("7001")]),a._v(" "),s("td",[a._v("Master")])]),a._v(" "),s("tr",[s("td",[a._v("redis2")]),a._v(" "),s("td",[a._v("192.168.33.31")]),a._v(" "),s("td",[a._v("7002")]),a._v(" "),s("td",[a._v("Master")])]),a._v(" "),s("tr",[s("td",[a._v("redis3")]),a._v(" "),s("td",[a._v("192.168.33.31")]),a._v(" "),s("td",[a._v("7003")]),a._v(" "),s("td",[a._v("Master")])]),a._v(" "),s("tr",[s("td",[a._v("redis4")]),a._v(" "),s("td",[a._v("192.168.33.31")]),a._v(" "),s("td",[a._v("7004")]),a._v(" "),s("td",[a._v("Slave")])]),a._v(" "),s("tr",[s("td",[a._v("redis5")]),a._v(" "),s("td",[a._v("192.168.33.31")]),a._v(" "),s("td",[a._v("7005")]),a._v(" "),s("td",[a._v("Slave")])]),a._v(" "),s("tr",[s("td",[a._v("redis6")]),a._v(" "),s("td",[a._v("192.168.33.31")]),a._v(" "),s("td",[a._v("7006")]),a._v(" "),s("td",[a._v("Slave")])])])]),a._v(" "),s("p",[a._v("创建6个目录存储每个节点的配置：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#创建文件目录，分别存储每个节点的配置和数据")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis1/conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis1/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis2/conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis2/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis3/conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis3/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis4/conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis4/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis5/conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis5/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis6/conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p /usr/local/server/redis-cluster/redis6/data")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("p",[a._v("为每个节点创建配置：/usr/local/server/redis-cluster/redis1/conf/redis.conf")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("7001")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("bind")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("0.0.0.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("databases")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#开启集群")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("cluster-enabled")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yes")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("cluster-config-file")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("nodes.conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("cluster-node-timeout")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("15000")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("这里要把redis1~redis6的conf目录下都创建该配置，端口修改成7001/7002/7003/7004/7005/7006即可。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1670082512855-eb414f16-42ee-42fd-9d95-34d339f6ed5b.png",alt:"img"}})]),a._v(" "),s("p",[a._v("创建redis-cluster.yml:")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"3"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  redis1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis:6.2.4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    network_mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis1/conf/redis.conf:/etc/redis/redis.conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis1/data:/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('[ "redis-server", /etc/redis/redis.conf ]')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  redis2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis:6.2.4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    network_mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis2/conf/redis.conf:/etc/redis/redis.conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis2/data:/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('[ "redis-server", /etc/redis/redis.conf ]')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  redis3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis:6.2.4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    network_mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis3/conf/redis.conf:/etc/redis/redis.conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis3/data:/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('[ "redis-server", /etc/redis/redis.conf ]')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  redis4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis:6.2.4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    network_mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis4/conf/redis.conf:/etc/redis/redis.conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis4/data:/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('[ "redis-server", /etc/redis/redis.conf ]')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  redis5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis5")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis:6.2.4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    network_mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis5/conf/redis.conf:/etc/redis/redis.conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis5/data:/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('[ "redis-server", /etc/redis/redis.conf ]')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  redis6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis6")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("redis:6.2.4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    network_mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis6/conf/redis.conf:/etc/redis/redis.conf")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/redis-cluster/redis6/data:/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('[ "redis-server", /etc/redis/redis.conf ]')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br"),s("span",{staticClass:"line-number"},[a._v("51")]),s("br"),s("span",{staticClass:"line-number"},[a._v("52")]),s("br"),s("span",{staticClass:"line-number"},[a._v("53")]),s("br"),s("span",{staticClass:"line-number"},[a._v("54")]),s("br"),s("span",{staticClass:"line-number"},[a._v("55")]),s("br"),s("span",{staticClass:"line-number"},[a._v("56")]),s("br"),s("span",{staticClass:"line-number"},[a._v("57")]),s("br"),s("span",{staticClass:"line-number"},[a._v("58")]),s("br"),s("span",{staticClass:"line-number"},[a._v("59")]),s("br"),s("span",{staticClass:"line-number"},[a._v("60")]),s("br"),s("span",{staticClass:"line-number"},[a._v("61")]),s("br"),s("span",{staticClass:"line-number"},[a._v("62")]),s("br")])]),s("p",[a._v("安装命令：docker-compose -f redis-cluster.yml up -d，效果如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1670082854512-4955162b-f0fd-4532-8608-07cf11822562.png",alt:"img"}})]),a._v(" "),s("p",[a._v("创建集群：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入容器内部")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec -it redis1 /bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#执行Redis集群创建命令，注意要修改所有的192.168.33.31为自己设备的实际IP，如果使用云服务器，则使用公网IP")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("redis-cli")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("--cluster create 192.168.33.31:7001 \\\n192.168.33.31:7002 192.168.33.31:7003 \\\n192.168.33.31:7004 192.168.33.31:7005 \\\n192.168.33.31:7006 --cluster-replicas 1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#集群节点信息")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("redis-cli")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p 7001 cluster nodes")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[a._v("效果如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1670083060408-6d5a9f36-d699-484d-bbc3-9bf012951925.png",alt:"img"}})]),a._v(" "),s("h2",{attrs:{id:"docker-compose安装kafka集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装kafka集群"}},[a._v("#")]),a._v(" Docker-Compose安装Kafka集群")]),a._v(" "),s("p",[a._v("Kafka集群需要使用Zookeeper实现分布式管理，我们先拉去Zookeeper镜像，再实现安装：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("pull zookeeper:3.7.0")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("创建脚本文件kafka.yml")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("'3.8'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  zookeeper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("zookeeper:3.7.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168。211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("zookeeper")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2181:2181")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/zookeeper/data/:/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      network")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("host")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  kafka1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("wurstmeister/kafka:2.12-2.5.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9092:9092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("19092:19092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_BROKER_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      HOST_IP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://0.0.0.0:9092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://192.168.211.130:9092    ## 宿主机IP")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ZOOKEEPER_CONNECT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130:2181")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("      #docker部署必须设置外部可访问ip和端口，否则注册进zk的地址将不可达造成外部无法连接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_HOST_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_delete_topic_enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("'true'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_JMX_OPTS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.211.130 -Dcom.sun.management.jmxremote.rmi.port=19092"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JMX_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("19092")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("        /etc/localtime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/localtime")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        zookeeper\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  kafka2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("wurstmeister/kafka:2.12-2.5.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9093:9093")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("19093:19093")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_BROKER_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      HOST_IP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://0.0.0.0:9093")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://192.168.211.130:9093    ## 宿主机IP")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ZOOKEEPER_CONNECT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130:2181")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("      #docker部署必须设置外部可访问ip和端口，否则注册进zk的地址将不可达造成外部无法连接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_HOST_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9093")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9093")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_delete_topic_enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("'true'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_JMX_OPTS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.211.130 -Dcom.sun.management.jmxremote.rmi.port=19093"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JMX_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("19093")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("        /etc/localtime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/localtime")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        zookeeper\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  kafka3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("wurstmeister/kafka:2.12-2.5.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9094:9094")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("19094:19094")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_BROKER_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      HOST_IP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://0.0.0.0:9094")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("PLAINTEXT://192.168.211.130:9094    ## 宿主机IP")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ZOOKEEPER_CONNECT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130:2181")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("      #docker部署必须设置外部可访问ip和端口，否则注册进zk的地址将不可达造成外部无法连接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_HOST_NAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_ADVERTISED_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9094")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9094")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_delete_topic_enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("'true'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      KAFKA_JMX_OPTS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.211.130 -Dcom.sun.management.jmxremote.rmi.port=19094"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      JMX_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("19094")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("        /etc/localtime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/localtime")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        zookeeper\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  eagle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("gui66497/kafka_eagle")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("eagle_monitor")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      -")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"8048:8048"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      ZKSERVER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"192.168.211.130:2181"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br"),s("span",{staticClass:"line-number"},[a._v("51")]),s("br"),s("span",{staticClass:"line-number"},[a._v("52")]),s("br"),s("span",{staticClass:"line-number"},[a._v("53")]),s("br"),s("span",{staticClass:"line-number"},[a._v("54")]),s("br"),s("span",{staticClass:"line-number"},[a._v("55")]),s("br"),s("span",{staticClass:"line-number"},[a._v("56")]),s("br"),s("span",{staticClass:"line-number"},[a._v("57")]),s("br"),s("span",{staticClass:"line-number"},[a._v("58")]),s("br"),s("span",{staticClass:"line-number"},[a._v("59")]),s("br"),s("span",{staticClass:"line-number"},[a._v("60")]),s("br"),s("span",{staticClass:"line-number"},[a._v("61")]),s("br"),s("span",{staticClass:"line-number"},[a._v("62")]),s("br"),s("span",{staticClass:"line-number"},[a._v("63")]),s("br"),s("span",{staticClass:"line-number"},[a._v("64")]),s("br"),s("span",{staticClass:"line-number"},[a._v("65")]),s("br"),s("span",{staticClass:"line-number"},[a._v("66")]),s("br"),s("span",{staticClass:"line-number"},[a._v("67")]),s("br"),s("span",{staticClass:"line-number"},[a._v("68")]),s("br"),s("span",{staticClass:"line-number"},[a._v("69")]),s("br"),s("span",{staticClass:"line-number"},[a._v("70")]),s("br"),s("span",{staticClass:"line-number"},[a._v("71")]),s("br"),s("span",{staticClass:"line-number"},[a._v("72")]),s("br"),s("span",{staticClass:"line-number"},[a._v("73")]),s("br"),s("span",{staticClass:"line-number"},[a._v("74")]),s("br"),s("span",{staticClass:"line-number"},[a._v("75")]),s("br"),s("span",{staticClass:"line-number"},[a._v("76")]),s("br"),s("span",{staticClass:"line-number"},[a._v("77")]),s("br"),s("span",{staticClass:"line-number"},[a._v("78")]),s("br"),s("span",{staticClass:"line-number"},[a._v("79")]),s("br"),s("span",{staticClass:"line-number"},[a._v("80")]),s("br"),s("span",{staticClass:"line-number"},[a._v("81")]),s("br"),s("span",{staticClass:"line-number"},[a._v("82")]),s("br"),s("span",{staticClass:"line-number"},[a._v("83")]),s("br"),s("span",{staticClass:"line-number"},[a._v("84")]),s("br"),s("span",{staticClass:"line-number"},[a._v("85")]),s("br"),s("span",{staticClass:"line-number"},[a._v("86")]),s("br"),s("span",{staticClass:"line-number"},[a._v("87")]),s("br"),s("span",{staticClass:"line-number"},[a._v("88")]),s("br"),s("span",{staticClass:"line-number"},[a._v("89")]),s("br"),s("span",{staticClass:"line-number"},[a._v("90")]),s("br"),s("span",{staticClass:"line-number"},[a._v("91")]),s("br"),s("span",{staticClass:"line-number"},[a._v("92")]),s("br"),s("span",{staticClass:"line-number"},[a._v("93")]),s("br"),s("span",{staticClass:"line-number"},[a._v("94")]),s("br"),s("span",{staticClass:"line-number"},[a._v("95")]),s("br"),s("span",{staticClass:"line-number"},[a._v("96")]),s("br"),s("span",{staticClass:"line-number"},[a._v("97")]),s("br"),s("span",{staticClass:"line-number"},[a._v("98")]),s("br"),s("span",{staticClass:"line-number"},[a._v("99")]),s("br"),s("span",{staticClass:"line-number"},[a._v("100")]),s("br"),s("span",{staticClass:"line-number"},[a._v("101")]),s("br"),s("span",{staticClass:"line-number"},[a._v("102")]),s("br"),s("span",{staticClass:"line-number"},[a._v("103")]),s("br"),s("span",{staticClass:"line-number"},[a._v("104")]),s("br")])]),s("p",[a._v("执行安装;")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#执行命令")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker-compose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-f kafka.yml up -d")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#效果如下")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("[root@localhost")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka]# docker-compose -f kafka.yml up -d")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("[+]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Running 5/5")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" ⠿")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Container kafka2         Started    1.1s")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" ⠿")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Container kafka3         Started    1.2s")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" ⠿")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Container zookeeper      Started    1.0s")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" ⠿")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Container kafka1         Started    1.1s")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" ⠿")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Container eagle_monitor  Started    3.0s")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("[root@localhost")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("kafka]#")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[a._v("访问控制台"),s("code",[a._v("http://192.168.211.130:8048/ke/")]),a._v("，输入账号密码"),s("code",[a._v("admin / 123456")]),a._v("登录，效果如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399836741-ed750ba2-82e7-48a5-b5f4-db0e6f8cc03c.png",alt:"img"}})]),a._v(" "),s("h2",{attrs:{id:"elasticsearch安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch安装"}},[a._v("#")]),a._v(" ElasticSearch安装")]),a._v(" "),s("p",[a._v("采用Docker方式安装ElasticSearch：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('run -i --name elasticsearch -d \\\n--restart=always -p 9200:9200 -p 9300:9300 \\\n--privileged=true \\\n-v /usr/local/server/elasticsearch/plugins:/usr/share/elasticsearch/plugins \\\n-e "discovery.type=single-node" \\\nelasticsearch:7.12.1')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("IK分词器安装，下载地址：https://github.com/medcl/elasticsearch-analysis-ik/releases?page=4 下载后，将压缩包拷贝到 "),s("code",[a._v("/usr/local/server/elasticsearch/plugins")]),a._v("目录下，在"),s("code",[a._v("资料\\软件\\elasticsearch-analysis-ik-7.12.1.zip")]),a._v("已经下载好了该文件，可以直接上传到服务器上，操作如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#解压需要用到unzip，如果没有安装它，可以先安装")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("yum")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("install unzip")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#解压文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("unzip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("elasticsearch-analysis-ik-7.12.1.zip -d ./ik")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重新启动elasticsearch，IK分词器就生效")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("restart elasticsearch")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[s("code",[a._v("elasticsearch-hq")]),a._v("是一个非常方便的Elasticsearch可视化管理工具，我们可以安装一个：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -id -p 5000:5000 --restart=always elastichq/elasticsearch-hq")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("安装完成后，访问http://192.168.211.130:5000/即可。")]),a._v(" "),s("p",[a._v("Kibana也是一款非常不错的Elasticsearch管理工具，我们也可以安装它：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -d \\\n--name kibana \\\n--restart=always \\\n-e ELASTICSEARCH_HOSTS=http://192.168.33.31:9200 \\\n-p 5601:5601  \\\nkibana:7.12.1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("安装完成后，界面都是英文，我们可以把它换成中文：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#进入容器 ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec -it kibana /bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#编辑config/kibana.yml，修改中文，添加下面配置即可")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("i18n.locale")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"zh-CN"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重启容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("restart kibana")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h2",{attrs:{id:"skywalking安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skywalking安装"}},[a._v("#")]),a._v(" Skywalking安装")]),a._v(" "),s("p",[a._v("安装OAP")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run \\\n--name skywalking-oap \\\n--restart always \\\n-p 11800:11800 \\\n-p 12800:12800 -d \\\n--privileged=true \\\n-e TZ=Asia/Shanghai \\\n-e SW_STORAGE=elasticsearch7 \\\n-e SW_STORAGE_ES_CLUSTER_NODES=192.168.211.131:9200 \\\n-v /etc/localtime:/etc/localtime:ro \\\napache/skywalking-oap-server:8.6.0-es7")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[a._v("安装Skywalking UI")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run \\\n--name skywalking-ui \\\n--restart always \\\n-p 8080:8080 -d \\\n--privileged=true \\\n--link skywalking-oap:skywalking-oap \\\n-e TZ=Asia/Shanghai \\\n-e SW_OAP_ADDRESS=192.168.211.131:12800 \\\n-v /etc/localtime:/etc/localtime:ro \\\napache/skywalking-ui:8.6.0")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("访问SkywalkingUI http://192.168.211.131:8080")]),a._v(" "),s("p",[s("strong",[a._v("1)ES分片数量上限")])]),a._v(" "),s("p",[a._v("如果此时访问http://192.168.211.136:8080/ 出现500错误，错误如下，此时其实是Elasticsearch出了问题：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v('"com.netflix.zuul.exception.ZuulException","message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"GENERAL"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("我们可以查看"),s("code",[a._v("skywalking")]),a._v("的日志"),s("code",[a._v("docker logs --since 30m skywalking")]),a._v("，会报如下错误：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Failed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1: this action would add [2] total shards, but this cluster currently has [1000]/[1000] maximum shards open;]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("这种错误一般是生产环境中Elasticsearch分片数量达到了峰值，es集群的默认最大分片数是1000，我们需要调整Elasticsearch的默认分片数量，修改方式有多种，最常用的是直接修改"),s("code",[a._v("elasticsearch.yml")]),a._v("配置文件：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#进入elasticsearch容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec -it elasticsearch /bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#编辑")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vi")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/share/elasticsearch/config/elasticsearch.yml")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#添加如下配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("cluster.max_shards_per_node")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10000000")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("保存配置后，记得删除"),s("code",[a._v("data/nodes")]),a._v("数据包，再重启elasticsearch，此时就可以正常访问了。")]),a._v(" "),s("p",[s("strong",[a._v("2)磁盘清理")])]),a._v(" "),s("p",[a._v("如果此时能打开"),s("code",[a._v("skywalking-ui")]),a._v("界面，但是没有数据，则需要清理磁盘空间，可能是磁盘空间满了，如果是docker容器，可以使用"),s("code",[a._v("docker system prune")]),a._v("命令实现清理，"),s("code",[a._v("docker system prune")]),a._v("命令可以用于清理磁盘，删除关闭的容器、无用的数据卷和网络，以及dangling镜像（即无tag的镜像）。"),s("code",[a._v("docker system prune -a")]),a._v("命令清理得更加彻底，可以将没有容器使用Docker镜像都删掉。")]),a._v(" "),s("p",[a._v("探针下载https://archive.apache.org/dist/skywalking/")]),a._v(" "),s("h2",{attrs:{id:"minio安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#minio安装"}},[a._v("#")]),a._v(" MinIO安装")]),a._v(" "),s("p",[a._v("MinIO基于Apache License v2.0开源协议的对象存储服务，可以做为云存储的解决方案用来保存海量的图片，视频，文档。由于采用Golang实现，服务端可以工作在Windows,Linux, OS X和FreeBSD上。配置简单，基本是复制可执行程序，单行命令可以运行起来。")]),a._v(" "),s("p",[a._v("关于MinIOn使用参考文档 http://docs.minio.org.cn/docs/")]),a._v(" "),s("p",[a._v("我们可以使用docker进行环境部署和启动")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('run -i -d \\\n  -p 9000:9000 \\\n  -p 9001:9001 \\\n  --restart=always \\\n  --name minio1 \\\n  --network=host \\\n  --privileged=true \\\n  -v /etc/localtime:/etc/localtime \\\n  -v ~/minio/data:/data \\\n  -e "MINIO_ROOT_USER=minio" \\\n  -e "MINIO_ROOT_PASSWORD=minio123" \\\n  quay.io/minio/minio server /data --console-address ":9001"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[a._v("访问：http://192.168.211.130:9000/login  输入账号  minio / minio123即可登录。")]),a._v(" "),s("p",[a._v("创建Buckets：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399871949-19ddf804-7f77-45d1-807a-9f9f3eb64a85.png",alt:"img"}})]),a._v(" "),s("p",[a._v("Buckets权限管理")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399888510-3b855faa-9e89-41b5-8d83-e59fb1acbf4b.png",alt:"img"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399932392-126d7c01-aa82-4859-bb09-ddcf60498602.png",alt:"img"}})]),a._v(" "),s("p",[a._v("上传图片测试：")]),a._v(" "),s("p",[a._v("如果所有文件都存储到shop下，不容易区分，我们可以根据不同文件，创建不同目录，例如"),s("code",[a._v("shop/items/")]),a._v("存储所有商品静态页，多级路径创建：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399946932-9f2a53ed-1891-424a-91cc-c66b3833a491.png",alt:"img"}})]),a._v(" "),s("p",[a._v("选择"),s("code",[a._v("Upload")]),a._v("上传文件：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399958118-caa96a53-215e-4963-88d9-993e2c0a9ff1.png",alt:"img"}})]),a._v(" "),s("p",[a._v("文件访问：http://192.168.211.130:9000/shop/items/002.jpg")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399969184-b805d8cd-95d1-43c5-98f1-9943dd56eb89.png",alt:"img"}})]),a._v(" "),s("p",[a._v("效果如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667399980440-11b0f034-d6fb-4b75-98fe-522b5c8791d3.png",alt:"img"}})]),a._v(" "),s("p",[a._v("如果是java程序抛出异常，主要是时间不同步问题：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("The")]),a._v(" difference between the request time and the server's time is too large"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("解决方案如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#安装ntp ntpdate")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("yum")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-y install ntp ntpdate")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#与时间服务器同步时间")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ntpdate")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("cn.pool.ntp.org")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#将系统时间写入硬件时间")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("hwclock")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("--systohc")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h2",{attrs:{id:"fastdfs安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fastdfs安装"}},[a._v("#")]),a._v(" FastDFS安装")]),a._v(" "),s("p",[a._v("安装FastDFS需要安装Tracker和Storage：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#Tracker安装")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -d --name tracker --restart=always \\\n--net=host morunchang/fastdfs \\\nsh tracker.sh")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#Storage安装")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -d --name storage \\\n--restart=always --net=host -e \\\nTRACKER_IP=192.168.211.130:22122 \\\n-e GROUP_NAME=group1 morunchang/fastdfs \\\nsh storage.sh")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("h2",{attrs:{id:"canal安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#canal安装"}},[a._v("#")]),a._v(" Canal安装")]),a._v(" "),s("p",[s("code",[a._v("canal 1.1.4")]),a._v("版本，迎来最重要的"),s("code",[a._v("WebUI")]),a._v("能力，引入"),s("code",[a._v("canal-admin")]),a._v("工程，支持面向"),s("code",[a._v("WebUI")]),a._v("的"),s("code",[a._v("canal")]),a._v("动态管理能力，支持配置、任务、日志等在线白屏运维能力。")]),a._v(" "),s("p",[a._v("不过当前已经更新到了最新版本1.1.6,但1.1.6属于测试版，1.1.5属于稳定版，所以我们安装1.1.5。")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -p 11111:11111 --name=canal \\\n--restart=always -d \\\ncanal/canal-server:v1.1.5")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h2",{attrs:{id:"git安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#git安装"}},[a._v("#")]),a._v(" Git安装")]),a._v(" "),s("p",[a._v("安装命令：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1. 卸载旧版本")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("yum")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("remove git")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2. 安装 yum 源的 Git 版本")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("yum")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("install -y git")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 3. 查看版本")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("git")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("version ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输出 git version 1.8.3.1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h2",{attrs:{id:"seata1-4-2安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#seata1-4-2安装"}},[a._v("#")]),a._v(" Seata1.4.2安装")]),a._v(" "),s("h3",{attrs:{id:"_1-单机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-单机"}},[a._v("#")]),a._v(" 1）单机")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run --name seata1 -d \\\n-p 8091:8091 -e SEATA_PORT=8091 \\\n--privileged=true -e SEATA_IP=192.168.211.131  \\\n-v /usr/local/server/seata1/conf:/root/seata-config \\\n-v /usr/local/server/seata1/logs:/root/logs/seata \\\nseataio/seata-server:1.4.2")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("修改注册中心")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#1）进入容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec -it seata1 sh")]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#2）进入resources")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("resources/")]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#3）修改配置中心和注册中心")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("registry")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("{")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("  # file ...nacos ...eureka...redis...zk...consul...etcd3...sofa")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"nacos"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  nacos")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("{")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    application")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"seata-tc-server"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    serverAddr")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"192.168.211.131:8848"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    group")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"SEATA_GROUP"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    namespace")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('""')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    cluster")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"default"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    username")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"nacos"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    password")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"nacos"')]),a._v("\n  }\n}\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("config")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("{")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("  # file...nacos ...apollo...zk...consul...etcd3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"nacos"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  nacos")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("{")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    serverAddr")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"192.168.211.131:8848"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    namespace")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('""')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    group")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"SEATA_GROUP"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    username")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"nacos"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    password")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"nacos"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    dataId")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"seataServer.properties"')]),a._v("\n  }\n}\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#4）退出，修改")]),a._v("\nexit\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#5）修改Nacos，添加seataServer.properties，内容如下：")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 数据存储方式，db代表数据库")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("db")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.datasource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("druid")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.dbType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.driverClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("com.mysql.jdbc.Driver")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("jdbc:mysql://192.168.211.131:3306/seata?useUnicode=true&rewriteBatchedStatements=true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("root")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("123456")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.minConn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("5")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.maxConn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("30")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.globalTable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("global_table")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.branchTable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("branch_table")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.queryLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("100")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.lockTable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("lock_table")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("store.db.maxWait")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("5000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 事务、日志等配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.recovery.committingRetryPeriod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.recovery.asynCommittingRetryPeriod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.recovery.rollbackingRetryPeriod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.recovery.timeoutRetryPeriod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.maxCommitRetryTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.maxRollbackRetryTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.rollbackRetryTimeoutUnlockEnable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("false")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.undo.logSaveDays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("7")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server.undo.logDeletePeriod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("86400000")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 客户端与服务端传输方式")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("transport.serialization")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("seata")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("transport.compressor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("none")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 关闭metrics功能，提高性能")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("metrics.enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("false")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("metrics.registryType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("compact")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("metrics.exporterList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("prometheus")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("metrics.exporterPrometheusPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("9898")]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#6）创建seata数据库，并将如下脚本导入到数据库中")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("SET")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("NAMES utf8mb4;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("SET")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("FOREIGN_KEY_CHECKS = 0;")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("--")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("----------------------------")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("--")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("分支事务表")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("--")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("----------------------------")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("DROP")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("TABLE IF EXISTS `branch_table`;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("TABLE `branch_table`  (")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `branch_id`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("bigint(20) NOT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `xid`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `transaction_id`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("bigint(20) NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `resource_group_id`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `resource_id`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `branch_type`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `status`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("tinyint(4) NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `client_id`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `application_data`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `gmt_create`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("datetime(6) NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `gmt_modified`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("datetime(6) NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  PRIMARY")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("KEY (`branch_id`) USING BTREE,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  INDEX")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("`idx_xid`(`xid`) USING BTREE")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("--")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("----------------------------")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("--")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("全局事务表")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("--")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("----------------------------")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("DROP")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("TABLE IF EXISTS `global_table`;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("TABLE `global_table`  (")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `xid`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `transaction_id`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("bigint(20) NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `status`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("tinyint(4) NOT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `application_id`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `transaction_service_group`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `transaction_name`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `timeout`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("int(11) NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `begin_time`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("bigint(20) NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `application_data`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `gmt_create`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("datetime NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  `gmt_modified`")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("datetime NULL DEFAULT NULL,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  PRIMARY")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("KEY (`xid`) USING BTREE,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  INDEX")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("`idx_gmt_modified_status`(`gmt_modified`, `status`) USING BTREE,")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  INDEX")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("`idx_transaction_id`(`transaction_id`) USING BTREE")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("SET")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("FOREIGN_KEY_CHECKS = 1;")]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#7）重启容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("restart seata1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br"),s("span",{staticClass:"line-number"},[a._v("51")]),s("br"),s("span",{staticClass:"line-number"},[a._v("52")]),s("br"),s("span",{staticClass:"line-number"},[a._v("53")]),s("br"),s("span",{staticClass:"line-number"},[a._v("54")]),s("br"),s("span",{staticClass:"line-number"},[a._v("55")]),s("br"),s("span",{staticClass:"line-number"},[a._v("56")]),s("br"),s("span",{staticClass:"line-number"},[a._v("57")]),s("br"),s("span",{staticClass:"line-number"},[a._v("58")]),s("br"),s("span",{staticClass:"line-number"},[a._v("59")]),s("br"),s("span",{staticClass:"line-number"},[a._v("60")]),s("br"),s("span",{staticClass:"line-number"},[a._v("61")]),s("br"),s("span",{staticClass:"line-number"},[a._v("62")]),s("br"),s("span",{staticClass:"line-number"},[a._v("63")]),s("br"),s("span",{staticClass:"line-number"},[a._v("64")]),s("br"),s("span",{staticClass:"line-number"},[a._v("65")]),s("br"),s("span",{staticClass:"line-number"},[a._v("66")]),s("br"),s("span",{staticClass:"line-number"},[a._v("67")]),s("br"),s("span",{staticClass:"line-number"},[a._v("68")]),s("br"),s("span",{staticClass:"line-number"},[a._v("69")]),s("br"),s("span",{staticClass:"line-number"},[a._v("70")]),s("br"),s("span",{staticClass:"line-number"},[a._v("71")]),s("br"),s("span",{staticClass:"line-number"},[a._v("72")]),s("br"),s("span",{staticClass:"line-number"},[a._v("73")]),s("br"),s("span",{staticClass:"line-number"},[a._v("74")]),s("br"),s("span",{staticClass:"line-number"},[a._v("75")]),s("br"),s("span",{staticClass:"line-number"},[a._v("76")]),s("br"),s("span",{staticClass:"line-number"},[a._v("77")]),s("br"),s("span",{staticClass:"line-number"},[a._v("78")]),s("br"),s("span",{staticClass:"line-number"},[a._v("79")]),s("br"),s("span",{staticClass:"line-number"},[a._v("80")]),s("br"),s("span",{staticClass:"line-number"},[a._v("81")]),s("br"),s("span",{staticClass:"line-number"},[a._v("82")]),s("br"),s("span",{staticClass:"line-number"},[a._v("83")]),s("br"),s("span",{staticClass:"line-number"},[a._v("84")]),s("br"),s("span",{staticClass:"line-number"},[a._v("85")]),s("br"),s("span",{staticClass:"line-number"},[a._v("86")]),s("br"),s("span",{staticClass:"line-number"},[a._v("87")]),s("br"),s("span",{staticClass:"line-number"},[a._v("88")]),s("br"),s("span",{staticClass:"line-number"},[a._v("89")]),s("br"),s("span",{staticClass:"line-number"},[a._v("90")]),s("br"),s("span",{staticClass:"line-number"},[a._v("91")]),s("br"),s("span",{staticClass:"line-number"},[a._v("92")]),s("br"),s("span",{staticClass:"line-number"},[a._v("93")]),s("br"),s("span",{staticClass:"line-number"},[a._v("94")]),s("br"),s("span",{staticClass:"line-number"},[a._v("95")]),s("br"),s("span",{staticClass:"line-number"},[a._v("96")]),s("br"),s("span",{staticClass:"line-number"},[a._v("97")]),s("br"),s("span",{staticClass:"line-number"},[a._v("98")]),s("br"),s("span",{staticClass:"line-number"},[a._v("99")]),s("br"),s("span",{staticClass:"line-number"},[a._v("100")]),s("br"),s("span",{staticClass:"line-number"},[a._v("101")]),s("br"),s("span",{staticClass:"line-number"},[a._v("102")]),s("br"),s("span",{staticClass:"line-number"},[a._v("103")]),s("br"),s("span",{staticClass:"line-number"},[a._v("104")]),s("br"),s("span",{staticClass:"line-number"},[a._v("105")]),s("br"),s("span",{staticClass:"line-number"},[a._v("106")]),s("br"),s("span",{staticClass:"line-number"},[a._v("107")]),s("br"),s("span",{staticClass:"line-number"},[a._v("108")]),s("br"),s("span",{staticClass:"line-number"},[a._v("109")]),s("br"),s("span",{staticClass:"line-number"},[a._v("110")]),s("br"),s("span",{staticClass:"line-number"},[a._v("111")]),s("br"),s("span",{staticClass:"line-number"},[a._v("112")]),s("br"),s("span",{staticClass:"line-number"},[a._v("113")]),s("br"),s("span",{staticClass:"line-number"},[a._v("114")]),s("br"),s("span",{staticClass:"line-number"},[a._v("115")]),s("br"),s("span",{staticClass:"line-number"},[a._v("116")]),s("br"),s("span",{staticClass:"line-number"},[a._v("117")]),s("br"),s("span",{staticClass:"line-number"},[a._v("118")]),s("br"),s("span",{staticClass:"line-number"},[a._v("119")]),s("br"),s("span",{staticClass:"line-number"},[a._v("120")]),s("br"),s("span",{staticClass:"line-number"},[a._v("121")]),s("br"),s("span",{staticClass:"line-number"},[a._v("122")]),s("br"),s("span",{staticClass:"line-number"},[a._v("123")]),s("br"),s("span",{staticClass:"line-number"},[a._v("124")]),s("br"),s("span",{staticClass:"line-number"},[a._v("125")]),s("br"),s("span",{staticClass:"line-number"},[a._v("126")]),s("br"),s("span",{staticClass:"line-number"},[a._v("127")]),s("br"),s("span",{staticClass:"line-number"},[a._v("128")]),s("br"),s("span",{staticClass:"line-number"},[a._v("129")]),s("br"),s("span",{staticClass:"line-number"},[a._v("130")]),s("br")])]),s("p",[a._v("此时查看Nacos中的服务注册数据，能看到seata服务注册数据：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("服务名")]),a._v(" "),s("th",[a._v("分组名称")]),a._v(" "),s("th",[a._v("集群数目")]),a._v(" "),s("th",[a._v("实例数")]),a._v(" "),s("th",[a._v("健康实例数")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("seata-tc-server")]),a._v(" "),s("td",[a._v("SEATA_GROUP")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")]),a._v(" "),s("td",[a._v("1")])])])]),a._v(" "),s("h2",{attrs:{id:"mongodb安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongodb安装"}},[a._v("#")]),a._v(" MongoDB安装")]),a._v(" "),s("h3",{attrs:{id:"_1-单机安装-不支持事务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-单机安装-不支持事务"}},[a._v("#")]),a._v(" 1）单机安装-不支持事务")]),a._v(" "),s("p",[a._v("安装脚本")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -di --name \\\nmongo-service --restart=always \\\n-p 27017:27017 -v ~/data/mongodata:/data mongo")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"_2-mongodb多副本集-支持事务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-mongodb多副本集-支持事务"}},[a._v("#")]),a._v(" 2）MongoDB多副本集-支持事务")]),a._v(" "),s("p",[a._v("安装3台节点：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('run --name mongo1 -p 27024:27024 -d mongo mongod --replSet "rs0" --port 27024')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('run --name mongo2 -p 27025:27025 -d mongo mongod --replSet "rs0" --port 27025')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('run --name mongo3 -p 27026:27026 -d mongo mongod --replSet "rs0" --port 27026')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("初始化关联：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#进入容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec -it mongo1 mongo --port 27024")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#初始化")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v('rs.initiate({"_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"rs0","members":[{"_id":0,"host":"192.168.211.131:27024"},{"_id":1,"host":"192.168.211.131:27025"},{"_id":2,"host":"192.168.211.131:27026"}]})')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("项目中链接配置如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("    mongodb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("      uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mongodb://192.168.211.131:27024,192.168.211.131:27025,192.168.211.131:27026/test?replicaSet=rs0&readPreference=secondaryPreferred&connectTimeoutMS=300000")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("注意：如果有密码，则按如下方式配置：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mongodb://userName:password@IP1:Port1,IP2:Port2,IP3:Port3/base?replicaSet=rs1&readPreference=secondaryPreferred&connectTimeoutMS=300000")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("MongoDB分布式事务：")]),a._v(" "),s("p",[a._v("1）创建事务管理器"),s("code",[a._v("MongoTransactionManager")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Bean")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MongoTransactionManager")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("transactionManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MongoDatabaseFactory")]),a._v(" factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MongoTransactionManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("2)案例演示")]),a._v(" "),s("p",[a._v("这里支持多文档事务;")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Transactional")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Card")]),a._v(" card "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Card")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    card"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    card"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setNumber")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"55555"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    card"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setUserId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"No001"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("card"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"执行成功！"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//int q=10/0;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("h3",{attrs:{id:"_3-mongodb关联查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-mongodb关联查询"}},[a._v("#")]),a._v(" 3）MongoDB关联查询")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/link/{id}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Card")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("load")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@PathVariable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//关联查询")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Aggregation")]),a._v(" aggregation "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Aggregation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newAggregation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 匹配条件")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Aggregation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Criteria")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("where")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("is")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// from：class作为主collection，from字段表示需要链接的collection，不明白为啥命名个from")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// localField：主collection里的外键字段")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// foreignField：连接collection里对应外键的字段")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// as：最终连接的部分输出的字段名称")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Aggregation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("lookup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"user"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"userId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"user"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AggregationResults")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Card")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mongoTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("aggregate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("aggregation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"card"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Card")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getMappedResults")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("p",[a._v("等同于："),s("code",[a._v("select * from card inner join user on card.userId=user._id where card._id=?")])]),a._v(" "),s("h2",{attrs:{id:"rabbitmq安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq安装"}},[a._v("#")]),a._v(" RabbitMQ安装")]),a._v(" "),s("p",[a._v("安装命令如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -d --hostname host130 \\\n--name rabbitMq \\\n-e RABBITMQ_DEFAULT_USER=admin \\\n-e RABBITMQ_DEFAULT_PASS=123456 \\\n-p 15672:15672 \\\n-p 5672:5672 \\\n--restart=always \\\nrabbitmq:3.8.2-management")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("参数说明：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("以守护进程方式在后台运行")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("15672:15672 management 界面管理访问端口")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("5672:5672 amqp 访问端口")]),a._v("\n--name：指定容器名\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("--hostname：设定容器的主机名，它会被写到容器内的")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/etc/hostname 和 /etc/hosts，作为容器主机IP的别名，并且将显示在容器的bash中，所以记得将host130添加到/etc/hosts下面，如下：")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#127.0.0.1 host130")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("参数")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  RABBITMQ_DEFAULT_USER")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("用户名")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("  RABBITMQ_DEFAULT_PASS")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("密码")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("输入http://192.168.211.130:15672/ 访问，账号admin，密码123456，或者guest/guest")]),a._v(" "),s("h2",{attrs:{id:"rocketmq安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq安装"}},[a._v("#")]),a._v(" RocketMQ安装")]),a._v(" "),s("p",[a._v("安装RocketMQ需要安装mqnamesrv和broker，安装流程如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#创建存储日志目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p  /usr/local/server/rocketmq/data/namesrv/logs   /usr/local/server/rocketmq/data/namesrv/store")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#安装mqnamesrv")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('run -d \\\n--restart=always \\\n--name rmqnamesrv \\\n-p 9876:9876 \\\n-v /usr/local/server/rocketmq/data/namesrv/logs:/root/logs \\\n-v /usr/local/server/rocketmq/data/namesrv/store:/root/store \\\n-e "MAX_POSSIBLE_HEAP=100000000" \\\nrocketmqinc/rocketmq \\\nsh mqnamesrv')]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#创建目录存储broker日志信息和配置文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-p  /usr/local/server/rocketmq/data/broker/logs   /usr/local/server/rocketmq/data/broker/store /usr/local/server/rocketmq/conf")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#创建配置文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vi")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/usr/local/server/rocketmq/conf/broker.conf")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#配置文件完整内容如下")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 所属集群名称，如果节点较多可以配置多个")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("brokerClusterName")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("DefaultCluster")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#broker名称，master和slave使用相同的名称，表明他们的主从关系")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("brokerName")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("broker-a")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#0表示Master，大于0表示不同的slave")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("brokerId")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#表示几点做消息删除动作，默认是凌晨4点")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("deleteWhen")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("04")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#在磁盘上保留消息的时长，单位是小时")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("fileReservedTime")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("48")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("brokerRole")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ASYNC_MASTER")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("flushDiskType")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ASYNC_FLUSH")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置broker节点所在服务器的ip地址")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("brokerIP1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("192.168.211.130")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 磁盘使用达到95%之后,生产者再写入消息会报错 CODE: 14 DESC: service not available now, maybe disk full")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("diskMaxUsedSpaceRatio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("95")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#创建broker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('run -d  \\\n--restart=always \\\n--name rmqbroker \\\n--link rmqnamesrv:namesrv \\\n-p 10911:10911 \\\n-p 10909:10909 \\\n-v  /usr/local/server/rocketmq/data/broker/logs:/root/logs \\\n-v  /usr/local/server/rocketmq/data/broker/store:/root/store \\\n-v /usr/local/server/rocketmq/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf \\\n-e "NAMESRV_ADDR=namesrv:9876" \\\n-e "MAX_POSSIBLE_HEAP=200000000" \\\nrocketmqinc/rocketmq \\\nsh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#创建控制台console")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('run -d \\\n--restart=always \\\n--name rmqadmin \\\n-e "JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.211.130:9876 \\\n-Dcom.rocketmq.sendMessageWithVIPChannel=false" \\\n-p 9999:8080 \\\npangliang/rocketmq-console-ng')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br"),s("span",{staticClass:"line-number"},[a._v("51")]),s("br"),s("span",{staticClass:"line-number"},[a._v("52")]),s("br"),s("span",{staticClass:"line-number"},[a._v("53")]),s("br"),s("span",{staticClass:"line-number"},[a._v("54")]),s("br"),s("span",{staticClass:"line-number"},[a._v("55")]),s("br"),s("span",{staticClass:"line-number"},[a._v("56")]),s("br"),s("span",{staticClass:"line-number"},[a._v("57")]),s("br"),s("span",{staticClass:"line-number"},[a._v("58")]),s("br"),s("span",{staticClass:"line-number"},[a._v("59")]),s("br"),s("span",{staticClass:"line-number"},[a._v("60")]),s("br"),s("span",{staticClass:"line-number"},[a._v("61")]),s("br"),s("span",{staticClass:"line-number"},[a._v("62")]),s("br"),s("span",{staticClass:"line-number"},[a._v("63")]),s("br"),s("span",{staticClass:"line-number"},[a._v("64")]),s("br")])]),s("h2",{attrs:{id:"dockerfile-springboot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-springboot"}},[a._v("#")]),a._v(" Dockerfile-SpringBoot")]),a._v(" "),s("p",[a._v("以IgeMonitor例，使用Dockerfile构建,Dockerfile文件如下：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("FROM")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("openjdk:11-jre")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("LABEL")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('maintainer="研究院研发组 shenkunlin@itcast.cn"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("RUN")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo "Asia/Shanghai" > /etc/timezone')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ADD")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("./ige-monitor-igem-1.0.jar /app.jar")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ENV")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('dbuname="root"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ENV")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('dbpwd="root"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ENV")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('dbname="ige_config"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ENV")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('dburl="localhost:3306"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ENV")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('iport="8085"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("WORKDIR")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ENTRYPOINT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('["sh","-c","java -jar -Ddbuname=$dbuname -Ddbpwd=$dbpwd -Ddbname=$dbname -Ddburl=$dburl -Diport=$iport -Xms512m -Xmx512m -XX:PermSize=512M -XX:MaxPermSize=512m /app.jar"]')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[a._v("构建镜像：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("build -t igemonitor:2.0 .")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("安装容器：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -it -d --name=igemonitor \\\n-p 8085:8085 -p 28888:28888 \\\n--restart=always \\\n-e dbuname=root \\\n-e dbpwd=123456 \\\n-e dburl=192.168.211.131:3306 \\\ndockershenkunlin/igemonitor:v2.0")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h2",{attrs:{id:"镜像上传dockerhub"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像上传dockerhub"}},[a._v("#")]),a._v(" 镜像上传Dockerhub")]),a._v(" "),s("p",[a._v("Dockerhub地址：https://hub.docker.com/，如果想将自己制作的镜像发布上去，首先可以注册一个DockerHub账号："),s("code",[a._v("dockershenkunlin")]),a._v("，密码："),s("code",[a._v("***********")])]),a._v(" "),s("p",[a._v("1）创建仓库")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400011681-793e0087-c93c-4bd0-9af7-ee31e38c9c41.png",alt:"img"}})]),a._v(" "),s("p",[a._v("2）镜像推送")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看本地容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("[root@localhost")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("igemonitor]# docker ps")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("CONTAINER")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ID        IMAGE                  NAMES")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("4eecde9ee7f6")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("       igemonitor:1.0        igemonitor")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#并提交容器制作成本地镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("commit igemonitor dockershenkunlin/igemonitor:v1.0")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#登录dockerhub")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("[root@localhost")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("igemonitor]# docker login")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Login")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("dockershenkunlin")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("Login")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Succeeded")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#将本地镜像推送至Dockerhub")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("push dockershenkunlin/igemonitor:1.0")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br")])]),s("p",[a._v("我们可以看到镜像已经推送至Dockerhub了，如下图：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400022700-5ce89bc1-8894-4547-9625-cf5cb8f0923f.png",alt:"img"}})]),a._v(" "),s("p",[a._v("3）镜像下载安装测试")]),a._v(" "),s("p",[a._v("记得先清除本地Docker镜像，再执行如下操作安装镜像：")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("run -it -d --name=igemonitor \\\n-p 8085:8085 -p 28888:28888 \\\n--restart=always \\\n-e dbuname=root \\\n-e dbpwd=123456 \\\n-e dburl=192.168.211.130:3306 \\\ndockershenkunlin/igemonitor:v1.0")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("效果如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400033528-d67798dd-cd96-419b-84d4-b503c5ffeb69.png",alt:"img"}})]),a._v(" "),s("p",[a._v("安装完成后，访问http://192.168.211.130:8085/效果如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400044548-d2c2d4a3-d35c-45c5-b65f-8fe7ae03cd9b.png",alt:"img"}})]),a._v(" "),s("h2",{attrs:{id:"jar包安装到本地仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jar包安装到本地仓库"}},[a._v("#")]),a._v(" jar包安装到本地仓库")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("mvn")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("install:install-file -Dfile=E:\\ige-rpc-client-igem-1.0.jar -DgroupId=com.itheima -DartifactId=ige-rpc-client -Dversion=igem-1.0 -Dpackaging=jar")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("效果如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400055141-95734f88-0ab0-4ef8-9cb9-e0812b14422a.png",alt:"img"}})]),a._v(" "),s("h1",{attrs:{id:"开发常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发常见问题"}},[a._v("#")]),a._v(" 开发常见问题")]),a._v(" "),s("h2",{attrs:{id:"idea运行程序无法启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#idea运行程序无法启动"}},[a._v("#")]),a._v(" Idea运行程序无法启动")]),a._v(" "),s("p",[a._v("运行程序出现如下错误：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2022/png/27966665/1667400064659-b511cb35-dc96-4916-a76a-975b2813fb82.png",alt:"img"}})]),a._v(" "),s("p",[a._v("出现这个的原因一般是因为项目需要打印的环境变量太长，超过了限制，需要你缩短命令行来解决问题。解决这个问题，只需要修改工作空间中的配置即可。")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#在项目的.idea/workspace.xml文件中，找到")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("<component")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('name="PropertiesComponent">')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#后面在添加下面一行配置即可,这种方式一次设置就行。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("<property")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('name="dynamic.classpath" value="true" />')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);